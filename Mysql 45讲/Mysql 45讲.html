<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Mysql 45è®²</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix foreignobject { font-size: var(--mermaid-font-zoom); }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 1000px;
  	margin: 0 auto;
  	padding: 30px!important;
    padding-bottom: 100px;
}
mark{
	background:none!important;
	color:#ff0000!important;
}
#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}


a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.85em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.6em;
    line-height: 1.43;
}
h4 {
    font-size: 1.35em;
}
h5 {
    font-size: 1.2em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}


.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}


strong .md-plain{font-size:17px!important;font-weight:bold!important;}
blockquote{border-left:4px solid #62ca38!important;background:#f8f8f8!important;padding:10px!important;}
.md-image  img {
    display: inline-block;
    background: #eee!important;
    border: 10px solid #eee!important;
    padding: 5px!important;
}
code{
    background-color: #0ea014!important;
    color: #fff!important;
    padding: 2px 10px!important;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}


</style>
</head>
<div>https://blog.csdn.net/qq_17164811/article/details/107141112</div>
<body class='typora-export os-windows'>
<div id='write'  class=' first-line-indent'><p>&nbsp;</p><h1><a name="01--åºç¡æ¶ææ¥è¯¢çæ§è¡" class="md-header-anchor"></a><span>01 | åºç¡æ¶æï¼æ¥è¯¢çæ§è¡</span></h1><p><img src="Mysql 45è®².assets/image-20200910112754326.png" referrerpolicy="no-referrer" alt="image-20200910112754326"></p><p><span>MySQLå¯ä»¥åä¸º</span><strong><span>Serverå±</span></strong><span>å</span><strong><span>å­å¨å¼æ</span></strong><span>å±ä¸¤é¨å</span></p><p><span>Serverå±åæ¬è¿æ¥å¨ãæ¥è¯¢ç¼å­ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­ï¼æ¶µçMySQLçå¤§å¤æ°æ ¸å¿æå¡ åè½ï¼ä»¥åææçåç½®å½æ°ï¼å¦æ¥æãæ¶é´ãæ°å­¦åå å¯å½æ°ç­ï¼ï¼ææè·¨å­å¨å¼æçåè½é½å¨è¿ä¸å±å®ç°ï¼æ¯å¦å­å¨è¿ç¨ãè§¦åå¨ãè§å¾ç­ã</span></p><h2><a name="è¿æ¥å¨" class="md-header-anchor"></a><span>è¿æ¥å¨   </span></h2><h3><a name="åå®¹" class="md-header-anchor"></a><span>åå®¹</span></h3><p><span>è´è´£è·å®¢æ·ç«¯</span><strong><span>å»ºç«è¿æ¥</span></strong><span>ãè·å</span><strong><span>æé</span></strong><span>ã</span><strong><span>ç»´æ</span></strong><span>å</span><strong><span>ç®¡ç</span></strong><span>è¿æ¥</span></p><p><span>æ·åå¯ç è®¤è¯éè¿ï¼è¿æ¥å¨ä¼å°æéè¡¨éé¢æ¥åºä½ </span><strong><span>æ¥æçæé</span></strong><span>ãä¹åï¼è¿ä¸ªè¿æ¥éé¢çæéå¤æ­é»è¾ï¼é½å°ä¾èµäºæ­¤æ¶</span><strong><span>è¯»</span></strong><span>	</span><span>æéã</span></p><p><span>ä¸ä¸ªç¨æ·æåå»ºç«è¿æ¥åï¼å³ä½¿ä½ ç¨ç®¡çåè´¦å·å¯¹è¿ä¸ªç¨æ·çæéåäºä¿®æ¹ï¼ä¹</span><strong><span>ä¸ä¼</span></strong><span>å½±åå·²ç»</span><strong><span>å­å¨è¿æ¥çæé</span></strong><span>ãä¿®æ¹å®æåï¼åªæåæ°å»ºçè¿æ¥æä¼ä½¿ç¨æ°çæéè®¾ç½®ã</span></p><h3><a name="show-processlistç©ºé²è¿æ¥" class="md-header-anchor"></a><span>show processlistï¼ç©ºé²è¿æ¥</span></h3><ul><li><span>å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼</span><strong><span>èªå¨</span></strong><span>å°å®</span><strong><span>æ­å¼</span></strong><span>,</span><code>wait_timeout</code><span>é»è®¤å¼æ¯8å°æ¶</span></li><li><span>è¢«æ­å¼ä¹åï¼åæ¬¡åéè¯·æ±ï¼æ¶å°ä¸ä¸ªéè¯¯æéï¼ Lost connection to MySQL server during queryãè¿æ¶åå¦æä½ è¦ç»§ç»­ï¼å°±éè¦</span><strong><span>éè¿</span></strong></li></ul><p><span>é¿è¿æ¥ï¼æ¯æè¿æ¥æååï¼å¦æå®¢æ·ç«¯æç»­æè¯·æ±ï¼åä¸ç´ä½¿ç¨åä¸ä¸ªè¿æ¥ã</span></p><p><span>ç­è¿æ¥ï¼åæ¯ææ¯æ¬¡æ§è¡å®å¾å°çå æ¬¡æ¥è¯¢å°±æ­å¼è¿æ¥ï¼ä¸æ¬¡æ¥è¯¢åéæ°å»ºç«ä¸ä¸ª</span></p><h3><a name="font-colorredå°½éä½¿ç¨é¿è¿æ¥font" class="md-header-anchor"></a><font color=red><span>å°½éä½¿ç¨é¿è¿æ¥</span></font></h3><p><span>	</span><span>ä½¿ç¨é¿è¿æ¥å¯è½ä¼åç°ï¼</span><strong><span>åå­æ¶¨å¾ç¹å«å¿«</span></strong><span>ï¼</span></p><p><span>		</span><span>MySQLå¨æ§è¡è¿ç¨ä¸­ä¸´æ¶ä½¿ç¨çåå­æ¯</span><strong><span>ç®¡çå¨è¿æ¥å¯¹è±¡</span></strong><span>éé¢</span><strong><span>ç</span></strong><span>ãè¿äºèµæºä¼å¨</span><strong><span>è¿æ¥æ­å¼</span></strong><span>çæ¶å</span><strong><span>æéæ¾</span></strong><span>ãæä»¥å¦æé¿è¿æ¥ç´¯ç§¯ä¸æ¥ï¼å¯è½å¯¼è´åå­å ç¨å¤ªå¤§ï¼è¢«ç³»ç»å¼ºè¡ææï¼OOMï¼ï¼ä»ç°è±¡çå°±æ¯MySQLå¼å¸¸éå¯äºã</span></p><p><strong><span>ä¸ä¸¤ç§æ¹æ¡</span></strong></p><ol start='' ><li><span>å®ææ­å¼é¿è¿æ¥</span></li><li><span>å¯ä»¥å¨æ¯æ¬¡æ§è¡ä¸ä¸ªæ¯è¾å¤§çæä½åï¼éè¿æ§è¡ </span><code>mysql_reset_connection</code><span>æ¥éæ°åå§åè¿æ¥èµæºï¼è¿ä¸ªè¿ç¨</span><strong><span>ä¸éè¦</span></strong><span>éè¿åéæ°åæééªè¯ï¼ ä½æ¯ä¼å°è¿æ¥æ¢å¤å°åååå»ºå®æ¶çç¶æ</span></li></ol><h3><a name="æ¥è¯¢ç¼å­" class="md-header-anchor"></a><span>æ¥è¯¢ç¼å­</span></h3><p><span>ä¸ä¸ªæ¥è¯¢è¯·æ±åï¼åå°æ¥è¯¢ç¼å­ãä¹åæ§è¡è¿ çè¯­å¥åå¶ç»æå¯è½ä¼ä»¥key-valueå¯¹çå½¢å¼ï¼è¢«ç´æ¥ç¼å­å¨</span><strong><span>åå­</span></strong><span>ä¸­ã</span></p><p><span>keyæ¯æ¥è¯¢çè¯­å¥ï¼valueæ¯ æ¥è¯¢çç»æã</span></p><p><strong><span>ä½æ¯å¤§å¤æ°æåµä¸æä¼å»ºè®®ä½ ä¸è¦ä½¿ç¨æ¥è¯¢ç¼å­ï¼ä¸ºä»ä¹å¢ï¼å ä¸ºæ¥è¯¢ç¼å­å¾å¾å¼å¤§äº ä½æ¯å¤§å¤æ°æåµä¸æä¼å»ºè®®ä½ ä¸è¦ä½¿ç¨æ¥è¯¢ç¼å­ï¼ä¸ºä»ä¹å¢ï¼å ä¸ºæ¥è¯¢ç¼å­å¾å¾å¼å¤§äºå©ã</span></strong><span> </span></p><p><span>æ¥è¯¢ç¼å­ç</span><strong><span>å¤±æ</span></strong><span>éå¸¸</span><strong><span>é¢ç¹</span></strong><span>(ä¸æ¡æ´æ°ï¼å¨è¡¨ç¼å­å¤±æ)</span></p><p><span>æéæ¥ç¼å­</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> <span class="cm-keyword">SQL_CACHE</span> * <span class="cm-keyword">from</span> T <span class="cm-keyword">where</span> ID=<span class="cm-number">10</span>ï¼</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h2><a name="åæå¨" class="md-header-anchor"></a><span>åæå¨ </span></h2><p><span>ä»ä½ è¾å¥ç&quot;select&quot;è¿ä¸ªå³é®å­è¯å«åºæ¥ï¼è¿æ¯ä¸ä¸ªæ¥è¯¢è¯­å¥ã</span></p><h2><a name="ä¼åå¨" class="md-header-anchor"></a><span>ä¼åå¨</span></h2><p><span>ä¼åå¨æ¯å¨è¡¨éé¢æå¤ä¸ªç´¢å¼çæ¶åï¼</span><strong><span>å³å®ä½¿ç¨åªä¸ªç´¢å¼</span></strong></p><p><span>æèå¨ä¸ä¸ªè¯­å¥æå¤è¡¨å³èï¼joinï¼ çæ¶åï¼</span><strong><span>å³å®åä¸ªè¡¨çè¿æ¥é¡ºåº</span></strong></p><h2><a name="æ§è¡å¨" class="md-header-anchor"></a><span>æ§è¡å¨</span></h2><p><span>åå¤æ­ä¸ä¸ä½ å¯¹è¿ä¸ªè¡¨Tææ²¡ææ§è¡æ¥è¯¢ç</span><strong><span>æé</span></strong><span>ï¼å¦æææéï¼å°±æå¼è¡¨ç»§ç»­æ§è¡ãæå¼è¡¨çæ¶åï¼æ§è¡å¨å°±ä¼</span><strong><span>æ ¹æ®è¡¨çå¼æå®ä¹</span></strong><span>ï¼å»ä½¿ç¨è¿ä¸ªå¼ææä¾ç</span><strong><span>æ¥å£</span></strong><span>ã</span></p><h2><a name="é®é¢" class="md-header-anchor"></a><span>é®é¢?</span></h2><p><span>å¦æè¡¨Tä¸­æ²¡æå­æ®µkï¼èä½ æ§è¡äºè¿ä¸ªè¯­å¥ select * from T where k=1, é£ è¯å®æ¯ä¼æ¥âä¸å­å¨è¿ä¸ªåâçéè¯¯ï¼ âUnknown column âkâ in âwhere clauseââãä½ è§å¾è¿ä¸ªéè¯¯æ¯ å¨æä»¬ä¸é¢æå°çåªä¸ªé¶æ®µæ¥åºæ¥çå¢ï¼</span></p><h1><a name="02--æ¥å¿ç³»ç»æ´æ°è¯­å¥æ¯å¦ä½æ§è¡" class="md-header-anchor"></a><span>02 | æ¥å¿ç³»ç»ï¼æ´æ°è¯­å¥æ¯å¦ä½æ§è¡</span><span>	</span></h1><p><span>MySQLå¯ä»¥æ¢å¤å°åä¸ªæåä»»æä¸ç§çç¶æ</span></p><p><span>å¨ä¸ä¸ªè¡¨ä¸ææ´æ°çæ¶åï¼è·è¿ä¸ªè¡¨æå³çæ¥è¯¢ç¼å­ä¼å¤±æï¼ä¸å»ºè®®ä½¿ç¨æ¥è¯¢ç¼å­çåå ã</span></p><p><span>ä¸æ¥è¯¢æµç¨ä¸ä¸æ ·çæ¯ï¼æ´æ°æµç¨è¿æ¶åä¸¤ä¸ªéè¦çæ¥å¿æ¨¡å</span></p><p><strong><span>redo logï¼éåæ¥å¿ï¼å binlogï¼å½æ¡£æ¥å¿ï¼</span></strong></p><h2><a name="éè¦çæ¥å¿æ¨¡åredo-log" class="md-header-anchor"></a><span>éè¦çæ¥å¿æ¨¡åï¼redo log</span></h2><p><img src="Mysql 45è®².assets/image-20200910141053475.png" referrerpolicy="no-referrer" alt="image-20200910141053475"></p><p><span>ç²æ¿åè´¦æ¬éåçæ´ä¸ªè¿ç¨ï¼å¶å®å°±æ¯MySQLéç»å¸¸è¯´å°ç</span><strong><span>WALææ¯</span></strong></p><p><span>InnoDBå¼æå°±ä¼åæè®°å½åå°redo logï¼ç²æ¿ï¼é é¢ï¼å¹¶</span><strong><span>æ´æ°åå­</span></strong><span>ï¼è¿ä¸ªæ¶åæ´æ°å°±ç®å®æäº</span></p><p><img src="Mysql 45è®².assets/image-20200911174039536.png" referrerpolicy="no-referrer" alt="image-20200911174039536"></p><p><span>write posæ¯å½å</span><strong><span>è®°å½</span></strong><span>çä½ç½®ï¼ä¸è¾¹åä¸è¾¹åç§»ï¼åå°ç¬¬3å·æä»¶æ«å°¾åå°±åå°0å·æä»¶å¼å¤´ã </span></p><p><span>checkpointæ¯å½åè¦</span><strong><span>æ¦é¤</span></strong><span>çä½ç½®ï¼ä¹æ¯å¾åæ¨ç§»å¹¶ä¸å¾ªç¯çï¼æ¦é¤è®°å½å</span><strong><span>è¦æè®°å½æ´æ°å°æ°æ®æä»¶</span></strong><span>ã</span></p><p><span>æäºredo logï¼InnoDBå°±å¯ä»¥ä¿è¯å³ä½¿æ°æ®åºåçå¼å¸¸éå¯ï¼</span><strong><span>ä¹åæäº¤çè®°å½é½ä¸ä¼ä¸¢å¤±</span></strong><span>ï¼è¿ä¸ª è½åç§°ä¸º</span><code>crash-safe</code><span> ã</span></p><h2><a name="éè¦çæ¥å¿æ¨¡åbinlog" class="md-header-anchor"></a><span>éè¦çæ¥å¿æ¨¡åï¼binlog</span></h2><p><span>redo logæ¯ InnoDBå¼æç¹æçæ¥å¿ï¼è</span><strong><span>Serverå±</span></strong><span>ä¹æèªå·±çæ¥å¿ï¼ç§°ä¸ºbinlogï¼å½æ¡£æ¥å¿ï¼ã</span></p><p><span>ä¸¤ç§æ¥å¿æä»¥ä¸ä¸ç¹ä¸å</span></p><ol start='' ><li><p><span>redo logæ¯InnoDBå¼æç¹æçï¼binlogæ¯MySQLç</span><strong><span>Serverå±</span></strong><span>å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã</span></p></li><li><p><span>redo logæ¯</span><strong><span>ç©çæ¥å¿</span></strong><span>ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âï¼binlogæ¯</span><strong><span>é»è¾æ¥å¿</span></strong><span>ï¼è®°å½ç æ¯è¿ä¸ªè¯­å¥çåå§é»è¾ï¼æ¯å¦âç»ID=2è¿ä¸è¡çcå­æ®µå 1 âã</span></p></li><li><p><span>redo logæ¯</span><strong><span>å¾ªç¯å</span></strong><span>çï¼ç©ºé´åºå®ä¼ç¨å®ï¼binlogæ¯å¯ä»¥è¿½å åå¥çãâè¿½å åâæ¯æbinlogæä»¶ åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã</span></p><p>&nbsp;</p></li></ol><h2><a name="updateè¯­-å¥æ¶çåé¨æµç¨" class="md-header-anchor"></a><span>updateè¯­ å¥æ¶çåé¨æµç¨</span></h2><p><img src="Mysql 45è®².assets/image-20200911175032011.png" referrerpolicy="no-referrer" alt="image-20200911175032011"></p><p><img src="Mysql 45è®².assets/image-20200911175103220.png" referrerpolicy="no-referrer" alt="image-20200911175103220"></p><p><span>å°redo logçåå¥ææäºä¸¤ä¸ªæ­¥éª¤ï¼prepareå commitï¼è¿å°±æ¯&quot;ä¸¤é¶æ®µæäº¤&quot;ã</span></p><h2><a name="ä¸¤é¶æ®µæäº¤" class="md-header-anchor"></a><span>ä¸¤é¶æ®µæäº¤</span></h2><p><span>binlogä¼è®°å½ææçé»è¾æä½ï¼å¹¶ä¸æ¯éç¨â</span><strong><span>è¿½å å</span></strong><span>âçå½¢å¼</span></p><p><span>ç³»ç»ä¼å®æåæ´åºå¤ä»½ã</span></p><p><span>å½éè¦æ¢å¤å°æå®çæä¸ç§æ¶ï¼æ¯å¦æå¤©ä¸åä¸¤ç¹åç°ä¸­ååäºç¹æä¸æ¬¡è¯¯å è¡¨ï¼éè¦æ¾åæ°æ®ï¼é£ä½ å¯ä»¥è¿ä¹åï¼</span></p><ul><li><span>é¦åï¼æ¾å°</span><strong><span>æè¿çä¸æ¬¡å¨éå¤ä»½</span></strong><span>ï¼å¦æä½ è¿æ°å¥½ï¼å¯è½å°±æ¯æ¨å¤©æä¸çä¸ä¸ªå¤ä»½ï¼ä»è¿ä¸ªå¤ä»½æ¢å¤å°ä¸´æ¶åºï¼ </span></li><li><span>ç¶åï¼ä»å¤ä»½çæ¶é´ç¹å¼å§ï¼å°</span><strong><span>å¤ä»½çbinlogä¾æ¬¡ååºæ¥</span></strong><span>ï¼éæ¾å°ä¸­åè¯¯å è¡¨ä¹åçé£ä¸ªæ¶ å»ã</span></li></ul><p><span>ä¸ºä»ä¹æ¥å¿éè¦âä¸¤é¶æ®µæäº¤âï¼</span></p><p><img src="Mysql 45è®².assets/image-20200914161150206.png" referrerpolicy="no-referrer" alt="image-20200914161150206"></p><p><span>å¯ä»¥çå°ï¼å¦æä¸ä½¿ç¨âä¸¤é¶æ®µæäº¤âï¼é£ä¹æ°æ®åºçç¶æå°±æå¯è½åç¨å®çæ¥å¿æ¢å¤åºæ¥çåºç </span><strong><span>ç¶æä¸ä¸è´</span></strong><span>ã</span></p><p><span>ç®åè¯´ï¼redo logåbinlogé½å¯ä»¥ç¨äºè¡¨ç¤ºäºå¡çæäº¤ç¶æï¼èä¸¤é¶æ®µæäº¤å°±æ¯è®©è¿ä¸¤ä¸ªç¶æä¿æé»è¾ä¸çä¸è´ã</span></p><h2><a name="å°ç»" class="md-header-anchor"></a><span>å°ç»</span></h2><p><img src="Mysql 45è®².assets/image-20200914161725823.png" referrerpolicy="no-referrer" alt="image-20200914161725823"></p><h2><a name="é®é¢-n88" class="md-header-anchor"></a><span>é®é¢ï¼</span></h2><p><span>åé¢æè¯´å°å®æå¨éå¤ä»½çå¨æâåå³äºç³»ç»éè¦æ§ï¼æ çæ¯ä¸å¤©ä¸å¤ï¼æçæ¯ä¸å¨ä¸å¤âãé£ä¹å¨ä»ä¹åºæ¯ä¸ï¼ä¸å¤©ä¸å¤ä¼æ¯ä¸å¨ä¸å¤æ´æä¼å¿å¢ï¼æ èè¯´ï¼å®å½±åäºè¿ä¸ªæ°æ®åºç³»ç»çåªä¸ªææ ï¼</span></p><p><span>å¥½å¤æ¯âæé¿æ¢å¤æ¶é´âæ´ç­</span></p><p><span>ç³»ç»çå¯¹åºææ å°±æ¯ @å°¼å¤ææ¯Â·èµµå @æå¡ æå°çRTOï¼æ¢å¤ç®æ æ¶é´ï¼ã</span></p><p><span>æ´é¢ç¹å¨éå¤ä»½éè¦æ¶èæ´å¤å­å¨ç©ºé´ï¼æä»¥è¿ä¸ªRTOæ¯ææ¬æ¢æ¥ çï¼å°±éè¦ä½ æ ¹æ®ä¸å¡éè¦æ§æ¥è¯ä¼°äºã</span></p><h1><a name="03--äºå¡éç¦»" class="md-header-anchor"></a><span>03 | äºå¡éç¦»</span></h1><h2><a name="éç¦»æ§ä¸éç¦»çº§å«" class="md-header-anchor"></a><span>éç¦»æ§ä¸éç¦»çº§å«</span></h2><p><span>èè¯»ï¼dirty readï¼ãä¸å¯éå¤è¯»ï¼nonrepeatable readï¼ãå¹»è¯»ï¼phantom readï¼çé®é¢ï¼ä¸ºäºè§£å³è¿äºé®é¢ï¼å°±æäºâéç¦»çº§å«âçæ¦ å¿µã</span></p><p><img src="Mysql 45è®².assets/image-20200914162559371.png" referrerpolicy="no-referrer" alt="image-20200914162559371"></p><p><img src="Mysql 45è®².assets/image-20200914162626063.png" referrerpolicy="no-referrer" alt="image-20200914162626063"></p><p><img src="Mysql 45è®².assets/image-20200914162650885.png" referrerpolicy="no-referrer" alt="image-20200914162650885"></p><p><span>æ°æ®åºéé¢ä¼åå»ºä¸ä¸ªè§å¾ï¼è®¿é®çæ¶åä»¥è§å¾çé»è¾ç»æä¸ºåã</span></p><ol start='' ><li><span>å¨â</span><strong><span>å¯éå¤è¯»</span></strong><span>âéç¦» çº§å«ä¸ï¼è¿ä¸ªè§å¾æ¯å¨</span><strong><span>äºå¡å¯å¨æ¶</span></strong><span>åå»ºçï¼æ´ä¸ªäºå¡å­å¨æé´é½ç¨è¿ä¸ªè§å¾ã</span></li><li><span>å¨â</span><strong><span>è¯»æäº¤</span></strong><span>âéç¦»çº§ å«ä¸ï¼è¿ä¸ªè§å¾æ¯å¨æ¯ä¸ª</span><strong><span>SQLè¯­å¥å¼å§æ§è¡ç</span></strong><span>æ¶ååå»ºçãè¿ééè¦æ³¨æçæ¯ï¼</span></li><li><span>â</span><strong><span>è¯»æªæäº¤</span></strong><span>âéç¦» çº§å«ä¸ç´æ¥è¿åè®°å½ä¸çææ°å¼ï¼</span><strong><span>æ²¡æè§å¾æ¦å¿µ</span></strong><span>ï¼èâä¸²è¡åâéç¦»çº§å«ä¸ç´æ¥ç¨</span><strong><span>å é</span></strong><span>çæ¹å¼æ¥é¿ åå¹¶è¡è®¿é®ã</span></li></ol><h2><a name="äºå¡éç¦»çå®ç°" class="md-header-anchor"></a><span>äºå¡éç¦»çå®ç° </span></h2><p><span>	</span><span>å®éä¸æ¯æ¡è®°å½å¨</span><strong><span>æ´æ°çæ¶åé½ä¼åæ¶è®°å½ä¸æ¡åæ»æä½</span></strong></p><p><img src="Mysql 45è®².assets/image-20200914163302200.png" referrerpolicy="no-referrer" alt="image-20200914163302200"></p><p><span>åä¸æ¡è®°å½å¨ç³»ç»ä¸­å¯ä»¥å­å¨å¤ä¸ªçæ¬ï¼å°±æ¯æ°æ®åºçå¤çæ¬å¹¶åæ§å¶ï¼MVCCï¼ãå¯¹äºread-view Aï¼</span><strong><span>è¦å¾å°1</span></strong><span>ï¼å°±</span><strong><span>å¿é¡»</span></strong><span>å°å½å å¼</span><strong><span>ä¾æ¬¡</span></strong><span>æ§è¡å¾ä¸­ææçåæ»æä½å¾å°ã</span></p><p><span>ä»ä¹æ¶åå é¤å¢ï¼ç­æ¡æ¯ï¼å¨ä¸éè¦çæ¶åæå é¤ã</span></p><p><span>å°±æ¯å½ç³»ç»éæ²¡ææ¯è¿ä¸ªåæ»æ¥å¿æ´æ©çread-viewçæ¶å</span></p><p><span>å°½éä¸è¦ä½¿ç¨é¿äºå¡</span></p><ul><li><span>å¯¼è´å¤§éå ç¨å­å¨ç©ºé´ã</span></li><li><span>é¿äºå¡è¿å ç¨éèµæºï¼ä¹å¯è½æå®æ´ä¸ªåº</span></li></ul><h2><a name="äºå¡çå¯å¨æ¹å¼" class="md-header-anchor"></a><span>äºå¡çå¯å¨æ¹å¼</span></h2><p><span>set autocommit=0ï¼èªå¨æäº¤å³æã</span></p><ol start='' ><li><p><span>éä¾¿è·ä¸ä¸ªä¸å¡é»è¾ï¼éè¿ general_log çæ¥å¿æ¥ç¡®è®¤ãä¸è¬æ¡æ¶å¦æä¼è®¾ç½®è¿ä¸ªå¼ï¼ä¹å°±ä¼æä¾åæ°æ¥æ§å¶è¡ä¸ºï¼ä½ çç®æ å°±æ¯æå®æ¹æ 1ã</span></p></li><li><p><span>åªè¯»äºå¡å¯ä»¥å»æ</span></p></li><li><p><span>SET MAX_EXECUTION_TIME å½ä»¤ï¼æ¥æ§å¶æ¯ä¸ªè¯­å¥æ§è¡çæé¿æ¶é´ï¼é¿ååä¸ªè¯­å¥æå¤æ§è¡å¤ªé¿æ¶é´ã</span></p><p><img src="Mysql 45è®².assets/image-20200914170553881.png" referrerpolicy="no-referrer" alt="image-20200914170553881"></p></li></ol><h2><a name="é®é¢-n130" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>æç»ä½ çä¸ä¸ªé®é¢å§ãä½ ç°å¨ç¥éäºç³»ç»éé¢åºè¯¥é¿åé¿äºå¡ï¼å¦æä½ æ¯ä¸å¡å¼åè´è´£äººåæ¶ä¹</span>
<span>æ¯æ°æ®åºè´è´£äººï¼ä½ ä¼æä»ä¹æ¹æ¡æ¥é¿ååºç°æèå¤çè¿ç§æåµå¢ï¼</span></p><h1><a name="04--æ·±å¥æµåºç´¢å¼" class="md-header-anchor"></a><span>04 | æ·±å¥æµåºç´¢å¼</span></h1><p><img src="Mysql 45è®².assets/image-20200914165758275.png" referrerpolicy="no-referrer" alt="image-20200914165758275"></p><ul><li><span>ä¸»é®ç´¢å¼çå¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå¨InnoDBéï¼ä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸º</span><strong><span>èç°ç´¢å¼</span></strong><span>ï¼clustered indexï¼ã</span></li><li><span>éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨InnoDBéï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ ï¼secondary indexï¼ã</span></li></ul><p><span>æ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼æ®éç´¢å¼çå¶å­èç¹å°±è¶å°ï¼æ®éç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã .</span></p><h2><a name="ç´¢å¼ç»´æ¤" class="md-header-anchor"></a><span>ç´¢å¼ç»´æ¤</span></h2><p><img src="Mysql 45è®².assets/image-20200914171157962.png" referrerpolicy="no-referrer" alt="image-20200914171157962"></p><h2><a name="é®é¢-n142" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20200914170517033.png" referrerpolicy="no-referrer" alt="image-20200914170517033"></p><p><img src="Mysql 45è®².assets/image-20200914171010726.png" referrerpolicy="no-referrer" alt="image-20200914171010726"></p><p><span>éå»ºç´¢å¼kçåæ³æ¯</span><strong><span>åç</span></strong><span>çï¼å¯ä»¥è¾¾å°çç©ºé´çç®çãä½æ¯ï¼éå»ºä¸»é®çè¿ç¨</span><strong><span>ä¸åç</span></strong><span>,é½ä¼å°æ´ä¸ªè¡¨éå»ºãã</span></p><p><img src="Mysql 45è®².assets/image-20200914171457854.png" referrerpolicy="no-referrer" alt="image-20200914171457854"></p><h2><a name="sqlæ¥è¯¢è¯­å¥çæ§è¡æµç¨" class="md-header-anchor"></a><span>SQLæ¥è¯¢è¯­å¥çæ§è¡æµç¨ï¼</span></h2><p><img src="Mysql 45è®².assets/image-20200914171545683.png" referrerpolicy="no-referrer" alt="image-20200914171545683"></p><h2><a name="è¦çç´¢å¼" class="md-header-anchor"></a><span>è¦çç´¢å¼</span><span>	</span></h2><p><span>ç±äºè¦çç´¢å¼å¯ä»¥åå°æ çæç´¢æ¬¡æ°ï¼æ¾èæåæ¥è¯¢æ§è½ï¼æä»¥ä½¿ç¨è¦çç´¢å¼æ¯ä¸ä¸ªå¸¸ç¨ ç±äºè¦çç´¢å¼å¯ä»¥åå°æ çæç´¢æ¬¡æ°ï¼æ¾èæåæ¥è¯¢æ§è½ï¼æä»¥ä½¿ç¨è¦çç´¢å¼æ¯ä¸ä¸ªå¸¸ç¨çæ§è½ä¼åææ®µ</span></p><h2><a name="æå·¦åç¼åå" class="md-header-anchor"></a><span>æå·¦åç¼åå</span></h2><p><span>å­æ®µé¡ºåºæåºç</span></p><p><span>å¨å»ºç«èåç´¢å¼çæ¶åï¼å¦ä½å®æç´¢ å¨å»ºç«èåç´¢å¼çæ¶åï¼å¦ä½å®æç´¢å¼åçå­æ®µ</span><strong><span>é¡ºåº</span></strong></p><p><span>è¦èèçååå°±æ¯</span><strong><span>ç©ºé´</span></strong></p><h2><a name="ç´¢å¼ä¸æ¨" class="md-header-anchor"></a><span>ç´¢å¼ä¸æ¨</span></h2><p><img src="Mysql 45è®².assets/image-20200915160356972.png" referrerpolicy="no-referrer" alt="image-20200915160356972"></p><p><img src="Mysql 45è®².assets/image-20200914172001135.png" referrerpolicy="no-referrer" alt="image-20200914172001135"></p><p><img src="Mysql 45è®².assets/image-20200914172009340.png" referrerpolicy="no-referrer" alt="image-20200914172009340"></p><p><span>èMySQL 5.6 å¼å¥çç´¢å¼ä¸æ¨ä¼åï¼index condition pushdown)ï¼ å¯ä»¥å¨ç´¢å¼éåè¿ç¨ä¸­ï¼å¯¹ç´¢ å¼ä¸­åå«çå­æ®µ</span><strong><span>ååå¤æ­</span></strong><span>ï¼ç´æ¥è¿æ»¤æä¸æ»¡è¶³æ¡ä»¶çè®°å½ï¼åå°åè¡¨æ¬¡æ°</span></p><h2><a name="é®é¢-n160" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20200914172115388.png" referrerpolicy="no-referrer" alt="image-20200914172115388"></p><p><img src="Mysql 45è®².assets/image-20200914172419813.png" referrerpolicy="no-referrer" alt="image-20200914172419813"></p><p><img src="Mysql 45è®².assets/image-20200917163344491.png" referrerpolicy="no-referrer" alt="image-20200917163344491"></p><p><img src="Mysql 45è®².assets/image-20200917163404203.png" referrerpolicy="no-referrer" alt="image-20200917163404203"></p><h1><a name="06--å¨å±éåè¡¨é" class="md-header-anchor"></a><span>06 | å¨å±éåè¡¨é </span></h1><p><span>æ ¹æ®å éçèå´ï¼MySQLéé¢çéå¤§è´å¯ä»¥åæå¨å±éãè¡¨çº§éåè¡é</span></p><h2><a name="å¨å±é-ftwrl" class="md-header-anchor"></a><span>å¨å±é FTWRL</span></h2><ul><li><span>å å¨å±è¯»éçæ¹æ³ï¼</span><strong><span>Flush tables with read lock (FTWRL)ã</span></strong></li></ul><p><span>å¯ä»¥ä½¿ç¨è¿ä¸ªå½ä»¤ï¼ä¹åå¶ä»çº¿ç¨çä»¥ä¸è¯­å¥ä¼è¢«é»å¡ï¼æ°æ®</span><strong><span>æ´æ°è¯­å¥</span></strong><span>ï¼æ°æ®çå¢å æ¹ï¼ãæ°æ®å®ä¹è¯­å¥ï¼åæ¬</span>
<span>å»ºè¡¨ã</span><strong><span>ä¿®æ¹è¡¨ç»æ</span></strong><span>ç­ï¼åæ´æ°ç±»äºå¡çæäº¤è¯­å¥ã</span></p><ul><li><span>è¿æmysqldump</span></li><li><span>è¿æset global readonly=true set global readonly=true</span></li></ul><h3><a name="ä½¿ç¨åºæ¯" class="md-header-anchor"></a><span>ä½¿ç¨åºæ¯</span></h3><p><span>å¨åºé»è¾å¤ä»½</span></p><p><span>å±é©çå°æ¹ï¼</span></p><ul><li><span>å¦æä½ å¨ä¸»åºä¸å¤ä»½ï¼é£ä¹å¨å¤ä»½æé´é½ä¸è½æ§è¡æ´æ°ï¼ä¸å¡åºæ¬ä¸å°±å¾åæï¼ </span></li><li><span>å¦æä½ å¨ä»åºä¸å¤ä»½ï¼é£ä¹å¤ä»½æé´ä»åºä¸è½æ§è¡ä¸»åºåæ­¥è¿æ¥çbinlogï¼ä¼å¯¼è´ä¸»ä»å»¶è¿</span></li></ul><p><span>å¦æä¸ä½¿ç¨</span></p><p><img src="Mysql 45è®².assets/image-20200915161059437.png" referrerpolicy="no-referrer" alt="image-20200915161059437"></p><p><span>å¤ä»½ç»æéï¼ç¨æ·Açæ°æ®ç¶ææ¯âè´¦æ·ä½é¢æ²¡æ£ï¼ä½æ¯ç¨æ·è¯¾ç¨è¡¨éé¢å·²ç»å¤äº ä¸é¨è¯¾âãå¦æåé¢ç¨è¿ä¸ªå¤ä»½æ¥æ¢å¤æ°æ®çè¯ï¼ç¨æ·Aå°±åç°ï¼èªå·±èµäº</span></p><p><span>ç»æï¼å¤ä»½ç³»ç»å¤ä»½çå¾å°çåº</span><strong><span>ä¸æ¯ä¸ä¸ªé»è¾æ¶é´ç¹</span></strong><span>ï¼è¿ä¸ªè§å¾æ¯é»è¾ä¸ä¸è´çã</span></p><p><span>å¶å®æ¯æä¸ä¸ªæ¹æ³è½å¤æ¿å°ä¸è´æ§è§å¾çï¼å¯éå¤è¯»éç¦»çº§å«ä¸å¼å¯ä¸ä¸ªäºå¡</span></p><h3><a name="mysqldump" class="md-header-anchor"></a><span>mysqldump</span></h3><p><span>å®æ¹èªå¸¦çé»è¾å¤ä»½å·¥å·æ¯</span><code>mysqldump</code><span>ï¼ä¸è´æ§è¯»ï¼</span></p><p><span>ä½¿ç¨åæ°âsingle-transactionçæ¶åï¼å¯¼æ°æ®</span><strong><span>ä¹åå°±ä¼å¯å¨ä¸ä¸ªäºå¡</span></strong><span>ï¼æ¥ç¡®ä¿æ¿å°ä¸è´æ§è§å¾ãèç±äºMVCCçæ¯æï¼è¿ä¸ªè¿ç¨ä¸­æ°æ®æ¯ å¯ä»¥æ­£å¸¸æ´æ°çã</span></p><p><span>ä¸è´æ§è¯»æ¯å¥½ï¼ä½åææ¯å¼æè¦æ¯ ä¸è´æ§è¯»æ¯å¥½ï¼ä½åææ¯å¼æè¦æ¯ æè¿ä¸ªéç¦»çº§å«ã æè¿ä¸ª</span><strong><span>éç¦»çº§å«</span></strong><span>ãæ¯å¦ï¼å¯¹äºMyISAMè¿ç§ä¸æ¯æäºå¡çå¼æï¼å¦æå¤ä»½è¿ç¨ä¸­ææ´æ°ï¼æ»æ¯ åªè½åå°ææ°çæ°æ®ï¼é£ä¹å°±ç ´åäºå¤ä»½çä¸è´æ§ãè¿æ¶ï¼æä»¬å°±éè¦ä½¿ç¨FTWRLå½ä»¤äºã</span></p><p><span>å¨åºåªè¯»ï¼ä¸ºä»ä¹ä¸ä½¿ç¨ æ¢ç¶è¦å¨åºåªè¯»ï¼ä¸ºä»ä¹ä¸ä½¿ç¨</span><strong><span>set global readonly=true</span></strong><span>çæ¹å¼å¢ çæ¹å¼å¢ï¼</span></p><h3><a name="set-global-readonlytrue" class="md-header-anchor"></a><span>set global readonly=true</span></h3><p><span>å»ºè®®ä½ ç¨FTWRLæ¹å¼ã</span></p><ul><li><span>ä¸æ¯ï¼å¨æäºç³»ç»ä¸­ï¼readonlyçå¼ä¼è¢«ç¨æ¥åå¶ä»é»è¾ï¼æ¯å¦ç¨æ¥</span><strong><span>å¤æ­ä¸ä¸ªåºæ¯ä¸»åºè¿æ¯å¤åº</span></strong><span>ãå æ­¤ï¼ä¿®æ¹globalåéçæ¹å¼å½±åé¢æ´å¤§ï¼æä¸å»ºè®®ä½ ä½¿ç¨ã </span></li><li><span>äºæ¯ï¼å¨</span><strong><span>å¼å¸¸å¤çæºå¶</span></strong><span>ä¸æå·®å¼ãå¦ææ§è¡FTWRLå½ä»¤ä¹åç±äºå®¢æ·ç«¯åçå¼å¸¸æ­å¼ï¼é£ä¹ MySQL</span><strong><span>ä¼èªå¨éæ¾</span></strong><span>è¿ä¸ªå¨å±éï¼æ´ä¸ªåºåå°å¯ä»¥æ­£å¸¸æ´æ°çç¶æãèå°æ´ä¸ªåºè®¾ç½®ä¸º readonlyä¹åï¼å¦æå®¢æ·ç«¯åçå¼å¸¸ï¼åæ°æ®åºå°±ä¼</span><strong><span>ä¸ç´ä¿æreadonlyç¶æ</span></strong><span>ï¼è¿æ ·ä¼å¯¼è´æ´ä¸ª åºé¿æ¶é´å¤äºä¸å¯åç¶æï¼é£é©è¾é«ã</span></li></ul><h2><a name="è¡¨çº§é" class="md-header-anchor"></a><span>è¡¨çº§é </span></h2><p><span>ä¸ç§æ¯è¡¨éï¼ä¸ç§æ¯åæ°æ®éï¼meta data lockï¼MDL)ã</span></p><h3><a name="è¡¨é" class="md-header-anchor"></a><span>è¡¨é</span></h3><p><span>è¡¨éçè¯­æ³æ¯ è¡¨éçè¯­æ³æ¯ </span><code>lock tables â¦ read/write</code><span>ã ä¸FTWRLç±»ä¼¼ï¼å¯ä»¥ç¨unlock tablesä¸»å¨éæ¾éï¼ ä¹å¯ä»¥å¨</span><strong><span>å®¢æ·ç«¯æ­å¼</span></strong><span>çæ¶åèªå¨éæ¾ãéè¦æ³¨æï¼lock tablesè¯­æ³é¤äºä¼éå¶å«ççº¿ç¨çè¯»åå¤ï¼ä¹éå®äº</span><strong><span>æ¬çº¿ç¨</span></strong><span>æ¥ä¸æ¥çæä½å¯¹è±¡ã</span></p><p><span>çº¿ç¨A</span></p><p><span>æ§è¡lock tables t1 read, t2 write; </span><font color=red ><span>ç¸å½äºwrite æ¯ä¸ªé</span></font><span>ã</span></p><p><span>//</span><strong><span>å¶ä»çº¿ç¨</span></strong><span>åt1ãè¯» åt2çè¯­å¥é½ä¼è¢«é»å¡ï¼åªè½è¯» t1ã</span></p><p><span>//çº¿ç¨Aå¨æ§è¡unlock tablesä¹åï¼ä¹åªè½æ§è¡</span><strong><span>è¯»t1ãè¯»åt2</span></strong><span>çæ ä½ãè¿åt1é½ä¸åè®¸ï¼èªç¶ä¹ä¸è½è®¿é®å¶ä»è¡¨ã</span></p><h3><a name="mdlmetadata-lock" class="md-header-anchor"></a><span>MDLï¼metadata lock)</span></h3><p><span>MDLä¸éè¦æ¾å¼ä½¿ç¨ï¼å¨è®¿é®ä¸ä¸ªè¡¨çæ¶åä¼è¢«èªå¨å ä¸</span></p><p><span>ä½ç¨: </span></p><p><span>	</span><span>ä¿è¯è¯»åçæ­£ç¡®æ§ã</span></p><p><span>å½å¯¹ä¸ä¸ªè¡¨åå¢å æ¹æ¥æä½çæ¶åï¼å </span><strong><span>MDLè¯»é</span></strong><span>ï¼å½ è¦å¯¹è¡¨åç»æåæ´æä½çæ¶åï¼å </span><strong><span>MDLåé</span></strong><span>ã</span></p><ul><li><span>è¯»éä¹é´</span><strong><span>ä¸äºæ¥</span></strong><span>ï¼å æ­¤ä½ å¯ä»¥æå¤ä¸ªçº¿ç¨åæ¶å¯¹ä¸å¼ è¡¨å¢å æ¹æ¥ã</span></li><li><span>è¯»åéä¹é´ãåéä¹é´æ¯</span><strong><span>äºæ¥</span></strong><span>çï¼ç¨æ¥ä¿è¯åæ´</span><strong><span>è¡¨ç»æ</span></strong><span>æä½ç</span><strong><span>å®å¨æ§</span></strong><span>ãå æ­¤ï¼å¦ææä¸¤ä¸ªçº¿</span>
<span>ç¨è¦åæ¶ç»ä¸ä¸ªè¡¨å å­æ®µï¼å¶ä¸­ä¸ä¸ªè¦ç­å¦ä¸ä¸ªæ§è¡å®æè½å¼å§æ§è¡ã</span></li></ul><blockquote><p><span>äºä»¶ï¼ç»ä¸ä¸ªå°è¡¨å ä¸ªå­æ®µï¼å¯¼è´æ´ä¸ªåºæäºã</span></p></blockquote><p><span>ç»ä¸ä¸ªè¡¨å å­æ®µï¼æèä¿®æ¹å­æ®µï¼æèå ç´¢å¼ï¼éè¦</span><strong><span>æ«æå¨è¡¨</span></strong><span>çæ°æ®</span></p><p><img src="Mysql 45è®².assets/image-20200917161952864.png" referrerpolicy="no-referrer" alt="image-20200917161952864"></p><p><span>å¦æåªæsession Cèªå·±è¢«é»å¡è¿æ²¡ä»ä¹å³ç³»ï¼ä½æ¯ä¹åææè¦å¨è¡¨tä¸æ°ç³è¯·MDLè¯»éçè¯·æ±ä¹ ä¼è¢«session Cé»å¡ãåé¢æä»¬è¯´äºï¼ææå¯¹è¡¨çå¢å æ¹æ¥æä½é½éè¦åç³è¯·MDLè¯»éï¼å°±é½è¢« éä½ï¼</span><strong><span>ç­äºè¿ä¸ªè¡¨ç°å¨å®å¨ä¸å¯è¯»åäº</span></strong></p><p><span>æç»ç»æï¼å¦ææä¸ªè¡¨ä¸çæ¥è¯¢è¯­å¥é¢ç¹ï¼èä¸å®¢æ·ç«¯æ</span><strong><span>éè¯æºå¶</span></strong><span>ï¼ä¹å°±æ¯è¯´è¶æ¶åä¼åèµ·ä¸ä¸ªæ°session åè¯·æ±çè¯ï¼è¿ä¸ªåºç</span><strong><span>çº¿ç¨å¾å¿«å°±ä¼çæ»¡</span></strong><span>ã</span></p><p><span>äºå¡ä¸­çMDLéï¼å¨è¯­å¥æ§è¡å¼å§æ¶ç³è¯·ï¼ä½æ¯è¯­å¥ç»æåå¹¶ä¸ä¼é©¬ä¸é æ¾ï¼</span><strong><span>èä¼ç­å°æ´ä¸ªäºå¡æäº¤ååéæ¾ã</span></strong></p><blockquote><p><span>å¦ä½å®å¨å°ç»å°è¡¨å å­æ®µï¼</span></p></blockquote><p><span>é¦åæä»¬è¦è§£å³é¿äºå¡ï¼äºå¡ä¸æäº¤ï¼å°±ä¼ä¸ç´å çMDLé</span></p><p><span>information_schema åºç innodb_trx è¡¨ä¸­ï¼ä½ å¯ä»¥</span><strong><span>æ¥å°å½åæ§è¡ä¸­çäºå¡</span></strong><span>ã</span></p><p><span>è¦èèå</span><strong><span>æå</span></strong><span>DDLï¼æè</span><strong><span>kill</span></strong><span>æè¿ä¸ªé¿äºå¡ã</span></p><p><span>å¦ææ¯è¡¨æ¯ä¸ä¸ªç­ç¹è¡¨ï¼è½ç¶æ°æ®éä¸å¤§ï¼ä½æ¯ä¸é¢çè¯·æ±å¾</span><strong><span>é¢ç¹</span></strong><span>ï¼èä½ ä¸å¾ä¸å ä¸ªå­æ®µï¼ä½ è¯¥æä¹åï¼</span></p><p><img src="Mysql 45è®².assets/image-20200917162653261.png" referrerpolicy="no-referrer" alt="image-20200917162653261"></p><h2><a name="é®é¢-n234" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>å¤ä»½ä¸è¬é½ä¼å¨å¤åºä¸æ§è¡ï¼ä½ å¨ç¨âsingle-transactionæ¹æ³åé» è¾å¤ä»½çè¿ç¨ä¸­ï¼å¦æä¸»åºä¸çä¸ä¸ªå°è¡¨åäºä¸ä¸ªDDLï¼æ¯å¦ç»ä¸ä¸ªè¡¨ä¸å äºä¸åãè¿æ¶åï¼ä» å¤åºä¸ä¼çå°ä»ä¹ç°è±¡å¢ï¼</span></p><p><img src="Mysql 45è®².assets/image-20201109140945294.png" referrerpolicy="no-referrer" alt="image-20201109140945294"></p><p><span>å¨å¤ä»½å¼å§çæ¶åï¼ä¸ºäºç¡®ä¿RRï¼å¯éå¤è¯»ï¼éç¦»çº§å«ï¼åè®¾ç½®ä¸æ¬¡RRéç¦»çº§å«(Q1); </span></p><p><span>å¯å¨äºå¡ï¼è¿éç¨ WITH CONSISTENTSNAPSHOTç¡®ä¿è¿ä¸ªè¯­å¥æ§è¡å®å°±å¯ä»¥å¾å°ä¸ä¸ªä¸è´æ§ è§å¾ï¼Q2)ï¼</span></p><p><span> è®¾ç½®ä¸ä¸ªä¿å­ç¹ï¼è¿ä¸ªå¾éè¦ï¼Q3ï¼ï¼</span></p><p><span> showcreate æ¯ä¸ºäºæ¿å°è¡¨ç»æ(Q4)ï¼ç¶åæ­£å¼å¯¼æ°æ® ï¼Q5ï¼ï¼åæ»å°SAVEPOINTspï¼å¨è¿ éçä½ç¨æ¯éæ¾ t1çMDLé ï¼Q6ãå½ç¶è¿é¨åå±äºâè¶çº²âï¼ä¸ææ­£æéé¢é½æ²¡æå°ã</span></p><p><span> DDLä»ä¸»åºä¼ è¿æ¥çæ¶é´æç§ææä¸åï¼ææäºåä¸ªæ¶å»ãé¢ç®è®¾å®ä¸ºå°è¡¨ï¼æä»¬åå®å°è¾¾åï¼ å¦æå¼å§æ§è¡ï¼åå¾å¿«è½å¤æ§è¡å®æã</span></p><p><img src="Mysql 45è®².assets/image-20201109141138120.png" referrerpolicy="no-referrer" alt="image-20201109141138120"></p><h1><a name="07--è¡éåè¿åå°è¡éå¯¹æ§è½çå½±å" class="md-header-anchor"></a><span>07 | è¡éåè¿ï¼åå°è¡éå¯¹æ§è½çå½±å</span></h1><h2><a name="ä»ä¸¤é¶æ®µéè¯´èµ·" class="md-header-anchor"></a><span>ä»ä¸¤é¶æ®µéè¯´èµ·</span></h2><p><img src="Mysql 45è®².assets/image-20201109110515542.png" referrerpolicy="no-referrer" alt="image-20201109110515542"></p><p><span>å®éä¸äºå¡Bçupdateè¯­å¥ä¼è¢«é»å¡ï¼ç´å°äºå¡Aæ§è¡</span><strong><span>commit</span></strong><span>ä¹åï¼äºå¡B</span><strong><span>æè½ç»§ç»­</span></strong><span>æ§è¡ã </span></p><p><strong><span>å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦æ æå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéå°½éå¾åæ¾ã</span></strong></p><p><span>æ¯å¦ï¼å®ç°ä¸ä¸ªçµå½±ç¥¨å¨çº¿äº¤æä¸å¡</span></p><p><img src="Mysql 45è®².assets/image-20201109110822851.png" referrerpolicy="no-referrer" alt="image-20201109110822851"></p><p><span>æä»¬éè¦updateä¸¤æ¡è®°å½ï¼å¹¶insertä¸æ¡è®°å½</span></p><p><span>ä¸¤ä¸ªäºå¡å²çªçé¨åå°±æ¯è¯­å¥2äº</span></p><p><span>æ ¹æ®ä¸¤é¶æ®µéåè®®ï¼ä¸è®ºä½ ææ ·å®æè¯­å¥é¡ºåºï¼ææçæä½éè¦çè¡éé½æ¯å¨äºå¡æäº¤çæ¶åæéæ¾çãæä»¥ï¼å¦æä½ æè¯­å¥2å®æå¨æåï¼æ¯å¦æç§3ã1ã2è¿æ ·çé¡ºåºï¼é£ä¹å½±é¢è´¦æ·ä½é¢ </span><strong><span>è¿ä¸è¡çéæ¶é´å°±æå°</span></strong><span>ãè¿å°±æå¤§ç¨åº¦å°åå°äºäºå¡ä¹é´çéç­å¾ï¼æåäºå¹¶ååº¦ã</span></p><h2><a name="æ­»éåæ­»éæ£æµ" class="md-header-anchor"></a><span>æ­»éåæ­»éæ£æµ</span></h2><p><span>å½åºç°æ­»éä»¥åï¼æä¸¤ç§ç­ç¥ï¼</span></p><ul><li><span>ä¸ç§ç­ç¥æ¯ï¼ç´æ¥è¿å¥ç­å¾ï¼ç´å°</span><strong><span>è¶æ¶</span></strong><span>ãè¿ä¸ªè¶æ¶æ¶é´å¯ä»¥éè¿åæ°innodb_lock_wait_timeoutæ¥è®¾ç½®ã </span></li><li><span>å¦ä¸ç§ç­ç¥æ¯ï¼</span><strong><span>åèµ·æ­»éæ£æµ</span></strong><span>ï¼åç°æ­»éåï¼</span><strong><span>ä¸»å¨åæ»</span></strong><span>æ­»éé¾æ¡ä¸­çæä¸ä¸ªäºå¡ï¼è®©å¶ä»äºå¡å¾ä»¥ç»§ç»­æ§è¡ãå°åæ°innodb_deadlock_detectè®¾ç½®ä¸ºonï¼è¡¨ç¤ºå¼å¯è¿ä¸ªé»è¾ã </span></li></ul><p><span>å¨InnoDBä¸­ï¼innodb_lock_wait_timeoutçé»è®¤å¼æ¯50sï¼</span></p><p><span>æ­£å¸¸æåµä¸æä»¬è¿æ¯è¦éç¨ç¬¬äºç§ç­ç¥ï¼å³ï¼ä¸»å¨æ­»éæ£æµï¼èä¸ innodb_deadlock_detectçé»è®¤å¼æ¬èº«å°±æ¯onãä¸»å¨æ­»éæ£æµå¨åçéçæ¶åï¼æ¯è½å¤å¿«éå ç°å¹¶è¿è¡å¤ççï¼ä½æ¯å®ä¹æ¯æé¢å¤è´æçã </span></p><p><span>æ¯ä¸ªæ°æ¥çè¢«å µä½ççº¿ç¨ï¼é½è¦å¤æ­ä¼ä¸ä¼ç±äºèªå·±çå å¥å¯¼è´äºæ­»éï¼è¿æ¯ä¸ä¸ªæ¶é´å¤æåº¦æ¯ O(n)çæä½ãåè®¾æ1000ä¸ªå¹¶åçº¿ç¨è¦åæ¶æ´æ°åä¸è¡ï¼é£ä¹æ­»éæ£æµæä½å°±æ¯100ä¸è¿ä¸ªéçº§ çãè½ç¶æç»æ£æµçç»ææ¯æ²¡ææ­»éï¼ä½æ¯è¿æé´è¦æ¶èå¤§éçCPUèµæºãå æ­¤ï¼ä½ å°±ä¼çå° </span><strong><span>CPUå©ç¨çå¾é«ï¼ä½æ¯æ¯ç§å´æ§è¡ä¸äºå ä¸ªäºå¡</span></strong><span>ã</span></p><h2><a name="æä¹è§£å³ç±è¿ç§ç­ç¹è¡æ´æ°å¯¼è´çæ§è½é®é¢å¢" class="md-header-anchor"></a><span>æä¹è§£å³ç±è¿ç§ç­ç¹è¡æ´æ°å¯¼è´çæ§è½é®é¢å¢ï¼</span></h2><ul><li><strong><span>ä¸ç§å¤´çå»å¤´çæ¹æ³ï¼å°±æ¯å¦æä½ è½ç¡®ä¿è¿ä¸ªä¸å¡ä¸å®ä¸ä¼åºç°æ­»éï¼å¯ä»¥ä¸´æ¶ææ­»éæ£ æµå³æ</span></strong><span>æå³çå¯è½ä¼åºç°å¤§éçè¶æ¶ï¼è¿æ¯ä¸å¡ææç</span></li><li><strong><span>å¦ä¸ä¸ªæè·¯æ¯æ§å¶å¹¶ååº¦ã</span></strong><span>ä½ ä¼å¾å¿«åç°è¿ä¸ªæ¹æ³ä¸å¤ªå¯è¡ï¼å ä¸ºå®¢æ·ç«¯å¾å¤ãæè§è¿ ä¸ä¸ªåºç¨ï¼æ600ä¸ªå®¢æ·ç«¯ï¼è¿æ ·å³ä½¿æ¯ä¸ªå®¢æ·ç«¯æ§å¶å°åªæ5ä¸ªå¹¶åçº¿ç¨ï¼æ±æ»å°æ°æ®åºæå¡ ç«¯ä»¥åï¼å³°å¼å¹¶åæ°ä¹å¯è½è¦è¾¾å°3000ã</span></li><li><span>å æ­¤ï¼è¿ä¸ªå¹¶åæ§å¶è¦åå¨æ°æ®åºæå¡ç«¯ãå¦æä½ æä¸­é´ä»¶ï¼å¯ä»¥èèå¨ä¸­é´ä»¶å®ç°ï¼å¦æä½ ç å¢éæè½ä¿®æ¹MySQLæºç çäººï¼ä¹å¯ä»¥åå¨MySQLéé¢ãåºæ¬æè·¯å°±æ¯ï¼å¯¹äºç¸åè¡çæ´æ°ï¼ å¨è¿å¥å¼æä¹åæéãè¿æ ·å¨InnoDBåé¨å°±ä¸ä¼æå¤§éçæ­»éæ£æµå·¥ä½äº</span></li></ul><p><span>æ²¡ææ°æ®åºæ¹é¢çä¸å®¶ï¼æä¹æ ·ä¼åè¿ä¸ªé®é¢å¢ï¼</span></p><p><span>ä½ å¯ä»¥èèéè¿å°ä¸è¡æ¹æé»è¾ä¸çå¤è¡æ¥åå°éå²çªãè¿æ¯ä»¥å½±é¢è´¦æ·ä¸ºä¾ï¼å¯ä»¥èèæ¾å¨å¤ æ¡è®°å½ä¸ï¼æ¯å¦10ä¸ªè®°å½ï¼å½±é¢çè´¦æ·æ»é¢ç­äºè¿10ä¸ªè®°å½çå¼çæ»åãè¿æ ·æ¯æ¬¡è¦ç»å½±é¢è´¦ æ·å éé¢çæ¶åï¼éæºéå¶ä¸­ä¸æ¡è®°å½æ¥å ãè¿æ ·æ¯æ¬¡å²çªæ¦çåæåæ¥ç1/10ï¼å¯ä»¥åå°éç­ å¾ä¸ªæ°ï¼ä¹å°±åå°äºæ­»éæ£æµçCPUæ¶èã è¿ä¸ªæ¹æ¡çä¸å»æ¯æ æçï¼ä½å¶å®è¿ç±»æ¹æ¡éè¦æ ¹æ®ä¸å¡é»è¾åè¯¦ç»è®¾è®¡ãå¦æè´¦æ·ä½é¢å¯è½ä¼ åå°ï¼æ¯å¦éç¥¨é»è¾ï¼é£ä¹è¿æ¶åå°±éè¦èèå½ä¸é¨åè¡è®°å½åæ0çæ¶åï¼ä»£ç è¦æç¹æ®å¤ çã</span></p><h2><a name="å°ç»-n273" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>æ¶åäºä¸¤é¶æ®µéåè®®ãæ­»éåæ­»éæ£æµè¿ä¸¤å¤§é¨ååå®¹</span></p><p><span>æç»ä½ çå»ºè®®æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ ååº¦çéçç³è¯·æ¶æºå°½éå¾åæ¾</span></p><p><span>ä½æ¯ï¼è°æ´è¯­å¥é¡ºåºå¹¶ä¸è½å®å¨é¿åæ­»éãæä»¥æä»¬å¼å¥äºæ­»éåæ­»éæ£æµçæ¦å¿µï¼ä»¥åæä¾äº ä¸ä¸ªæ¹æ¡ï¼æ¥åå°æ­»éå¯¹æ°æ®åºçå½±åãåå°æ­»éçä¸»è¦æ¹åï¼å°±æ¯</span><strong><span>æ§å¶è®¿é®ç¸åèµæºçå¹¶åäº</span></strong><span> å¡éã</span></p><h2><a name="é®é¢-n277" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>å¦æä½ è¦å é¤ä¸ä¸ªè¡¨éé¢çå10000è¡æ°æ®</span></p><ul><li><p><span>ç¬¬ä¸ç§ï¼ç´æ¥æ§è¡delete fromTlimit 10000; </span></p></li><li><p><span>ç¬¬äºç§ï¼å¨ä¸ä¸ªè¿æ¥ä¸­å¾ªç¯æ§è¡20æ¬¡ delete fromTlimit 500;</span></p></li><li><p><span>ç¬¬ä¸ç§ï¼å¨20ä¸ªè¿æ¥ä¸­åæ¶æ§è¡delete fromTlimit 500ã</span></p><p>&nbsp;</p><p><span>	</span><span>ç¬¬äºç§æ¹å¼æ¯ç¸å¯¹è¾å¥½çå³ï¼å¨ä¸ä¸ªè¿æ¥ä¸­å¾ªç¯æ§è¡20æ¬¡ delete fromTlimit 500ã ç¡®å®æ¯è¿æ ·çã</span></p><p><span>ç¬¬ä¸ç§æ¹å¼ï¼å³ï¼ç´æ¥æ§è¡delete fromTlimit 10000ï¼éé¢ï¼åä¸ªè¯­å¥å ç¨æ¶é´é¿ï¼éçæ¶é´ä¹ æ¯è¾é¿ï¼èä¸å¤§äºå¡è¿ä¼å¯¼è´ä¸»ä»å»¶è¿ã</span></p><p><span>ç¬¬ä¸ç§æ¹å¼ï¼å³ï¼å¨20ä¸ªè¿æ¥ä¸­åæ¶æ§è¡delete fromTlimit 500ï¼ï¼ä¼äººä¸ºé æéå²çªã</span></p></li></ul><h1><a name="08--äºå¡å°åºæ¯éç¦»çè¿æ¯ä¸éç¦»ç" class="md-header-anchor"></a><span>08 | äºå¡å°åºæ¯éç¦»çè¿æ¯ä¸éç¦»çï¼</span></h1><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>â</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`t`</span> ( </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`k`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> t(id, k) <span class="cm-keyword">values</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>),(<span class="cm-number">2</span>,<span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201109141910584.png" referrerpolicy="no-referrer" alt="image-20201109141910584"></p><p><span>begin/start transaction å½ä»¤å¹¶ä¸æ¯ä¸ä¸ªäºå¡çèµ·ç¹ï¼å¨æ§è¡å°å®ä»¬ä¹åçç¬¬ä¸ä¸ªæä½InnoDBè¡¨ çè¯­å¥ï¼äºå¡æçæ­£å¯å¨ãå¦æä½ æ³è¦</span><strong><span>é©¬ä¸å¯å¨ä¸ä¸ªäºå¡</span></strong><span>ï¼å¯ä»¥ä½¿ç¨start transaction with consistent snapshot è¿ä¸ªå½ä»¤ã</span></p><p><span>è¿éè¦æ³¨æçæ¯ï¼å¨æ´ä¸ªä¸æ éé¢ï¼æä»¬çä¾å­ä¸­å¦ææ²¡æç¹å«è¯´æï¼é½æ¯é»è®¤ autocommit=1ãï¼èªå¨æäº¤ï¼</span></p><p><span>äºå¡Cæ²¡ææ¾å¼å°ä½¿ç¨begin/commitï¼è¡¨ç¤ºè¿ä¸ªupdateè¯­å¥æ¬èº«å°±æ¯ä¸ä¸ªäºå¡ï¼ è¯­å¥å®æçæ¶åä¼</span><strong><span>èªå¨æäº¤</span></strong><span>ã</span></p><p><span>ç»æï¼ï¼å¦ææåè¯ä½ äºå¡Bæ¥å°çkçå¼æ¯3ï¼èäºå¡Aæ¥å°çkçå¼æ¯1ã</span></p><p><span>å¨MySQLéï¼æä¸¤ä¸ªâè§å¾âçæ¦å¿µï¼</span></p><ul><li><span>ä¸ä¸ªæ¯viewã</span></li><li><span>å¦ä¸ä¸ªæ¯InnoDBå¨å®ç°MVCCæ¶ç¨å°çä¸è´æ§è¯»è§å¾ï¼å³consistent read viewï¼ç¨äºæ¯æ RCï¼Read Committedï¼è¯»æäº¤ï¼åRRï¼Repeatable Readï¼å¯éå¤è¯»ï¼éç¦»çº§å«çå®ç°ã</span></li></ul><h2><a name="å¿«ç§å¨mvccéæ¯æä¹å·¥ä½ç" class="md-header-anchor"></a><span>âå¿«ç§âå¨MVCCéæ¯æä¹å·¥ä½çï¼</span></h2><p><span>å¨å¯éå¤è¯»éç¦»çº§å«ä¸ï¼äºå¡å¨å¯å¨çæ¶åå°±âæäºä¸ªå¿«ç§âãæ³¨æï¼è¿ä¸ª</span><strong><span>å¿«ç§æ¯åºäºæ´åº</span></strong><span>çã</span></p><p><span>InnoDBéé¢æ¯ä¸ªäºå¡æä¸ä¸ªå¯ä¸çäºå¡IDï¼å«ä½transaction idãå®æ¯å¨äºå¡å¼å§çæ¶åå InnoDBçäºå¡ç³»ç»ç³è¯·çï¼æ¯æç³è¯·é¡ºåºä¸¥æ ¼éå¢çã</span></p><p><span>æ°æ®è¡¨ä¸­çä¸è¡è®°å½ï¼å¶å®å¯è½æå¤ä¸ªçæ¬(row)ï¼æ¯ä¸ªçæ¬æèªå·±çrowtrx_idã</span></p><p><span>ä¸ä¸ªè®°å½è¢«å¤ä¸ªäºå¡è¿ç»­æ´æ°åçç¶æã</span></p><p><img src="Mysql 45è®².assets/image-20201109143705661.png" referrerpolicy="no-referrer" alt="image-20201109143705661"></p><p><span>å®éä¸ï¼å¾2ä¸­çä¸ä¸ªèçº¿ç®­å¤´ï¼å°±æ¯undo logï¼</span></p><p><span>èV1ãV2ãV3å¹¶</span><strong><span>ä¸æ¯ç©çä¸çå®å­å¨ç</span></strong><span>ï¼è æ¯æ¯æ¬¡éè¦çæ¶åæ ¹æ®å½åçæ¬åundo log</span><strong><span>è®¡ç®</span></strong><span>åºæ¥çãæ¯å¦ï¼éè¦V2çæ¶åï¼å°±æ¯éè¿V4ä¾ æ¬¡æ§è¡U3ãU2ç®åºæ¥ã</span></p><p><span>InnoDBæ¯æä¹å®ä¹é£ä¸ªâ100Gâçå¿«ç§ çã</span></p><p><span>æç§å¯éå¤è¯»çå®ä¹ï¼ä¸ä¸ªäºå¡å¯å¨çæ¶åï¼è½å¤çå°ææ</span><strong><span>å·²ç»æäº¤</span></strong><span>çäºå¡ç»æãä½æ¯ä¹åï¼è¿ ä¸ªäºå¡æ§è¡æé´ï¼å¶ä»äºå¡çæ´æ°å¯¹å®ä¸å¯è§ã</span></p><p><span>å¨å®ç°ä¸ï¼ InnoDBä¸º</span><strong><span>æ¯ä¸ªäºå¡æé äºä¸ä¸ªæ°ç»</span></strong><span>ï¼ç¨æ¥ä¿å­è¿ä¸ªäºå¡å¯å¨ç¬é´ï¼å½åæ­£å¨âæ´» è·âçææäºå¡IDãâæ´»è·âæçå°±æ¯ï¼</span><strong><span>å¯å¨äºä½è¿æ²¡æäº¤ã</span></strong></p><p><img src="Mysql 45è®².assets/image-20201109145243146.png" referrerpolicy="no-referrer" alt="image-20201109145243146"></p><p><img src="Mysql 45è®².assets/image-20201109145314029.png" referrerpolicy="no-referrer" alt="image-20201109145314029"></p><p><span>InnoDBå©ç¨äºâæææ°æ®é½æå¤ä¸ªçæ¬âçè¿ä¸ªç¹æ§ï¼å®ç°äºâç§çº§åå»º å¿«ç§âçè½åã</span></p><p><img src="Mysql 45è®².assets/image-20201109145614796.png" referrerpolicy="no-referrer" alt="image-20201109145614796"></p><p><img src="Mysql 45è®².assets/image-20201109145639484.png" referrerpolicy="no-referrer" alt="image-20201109145639484"></p><p><span>ä½ å¯è½æ³¨æå°äºï¼å¨äºå¡Aæ¥è¯¢çæ¶åï¼å¶å®äºå¡Bè¿</span><strong><span>æ²¡ææäº¤</span></strong><span>ï¼ä½æ¯å®çæç(1,3)è¿ä¸ªçæ¬å·² ç»åæå½åçæ¬äºãä½è¿ä¸ªçæ¬å¯¹äºå¡Aå¿é¡»æ¯ä¸å¯è§çï¼å¦åå°±åæèè¯»äºã</span></p><p><img src="Mysql 45è®².assets/image-20201109150630959.png" referrerpolicy="no-referrer" alt="image-20201109150630959"></p><h2><a name="æ´æ°é»è¾" class="md-header-anchor"></a><span>æ´æ°é»è¾</span></h2><p><img src="Mysql 45è®².assets/image-20201109150737552.png" referrerpolicy="no-referrer" alt="image-20201109150737552"></p><p><span>ä½ çå¾5ä¸­ï¼äºå¡Bçè§å¾æ°ç»æ¯åçæçï¼ä¹åäºå¡Cææäº¤ï¼ä¸æ¯åºè¯¥çä¸è§(1,2)åï¼æä¹è½ ç®åº(1,3)æ¥ï¼</span></p><p><span>æ¯çï¼å¦æäºå¡Bå¨æ´æ°ä¹åæ¥è¯¢ä¸æ¬¡æ°æ®ï¼è¿ä¸ªæ¥è¯¢è¿åçkçå¼ç¡®å®æ¯1ã</span></p><p><strong><span>æ´æ°æ°æ®é½æ¯åè¯»ååçï¼èè¿ä¸ªè¯»ï¼åªè½è¯»å½åç å¼ï¼ç§°ä¸ºâå½åè¯»âï¼current readï¼ã</span></strong></p><p><strong><span>å¸¦lock in share modeï¼for updateçSQLè¯­å¥ï¼æ¯å½åè¯»</span></strong></p><p><span>æä»¥ï¼å¨æ§è¡äºå¡Bæ¥è¯¢è¯­å¥çæ¶åï¼ä¸çèªå·±ççæ¬å·æ¯101ï¼ææ°æ°æ®ççæ¬å·ä¹æ¯101ï¼æ¯ èªå·±çæ´æ°ï¼å¯ä»¥ç´æ¥ä½¿ç¨ï¼æä»¥æ¥è¯¢å¾å°çkçå¼æ¯3ã</span></p><p><img src="Mysql 45è®².assets/image-20201109151028224.png" referrerpolicy="no-referrer" alt="image-20201109151028224"></p><p><span>æä»¬å¨ä¸ä¸ç¯æç« ä¸­æå°çâ</span><strong><span>ä¸¤é¶æ®µéåè®®</span></strong><span>âå°±è¦ä¸åºäºãäºå¡Câæ²¡æäº¤ï¼ä¹å°±æ¯è¯´(1,2) è¿ä¸ªçæ¬ä¸ç</span><strong><span>åéè¿æ²¡éæ¾</span></strong><span>ãèäºå¡Bæ¯</span><strong><span>å½åè¯»ï¼å¿é¡»è¦è¯»ææ°çæ¬</span></strong><span>ï¼èä¸å¿é¡»å éï¼å æ­¤å°±è¢« éä½äºï¼å¿é¡»ç­å°äºå¡Câéæ¾è¿ä¸ªéï¼æè½ç»§ç»­å®çå½åè¯»ã</span></p><p><img src="Mysql 45è®².assets/image-20201109152306677.png" referrerpolicy="no-referrer" alt="image-20201109152306677"></p><p><span>å¯éå¤è¯»çæ ¸å¿å°±æ¯ä¸è´æ§è¯»ï¼consistent readï¼ï¼èäºå¡æ´æ°æ°æ®çæ¶åï¼åªè½ç¨å½åè¯»ãå¦ æå½åçè®°å½çè¡éè¢«å¶ä»äºå¡å ç¨çè¯ï¼å°±éè¦è¿å¥éç­å¾ã</span></p><ul><li><span>å¨å¯éå¤è¯»éç¦»çº§å«ä¸ï¼åªéè¦å¨äºå¡å¼å§çæ¶ååå»ºä¸è´æ§è§å¾ï¼ä¹åäºå¡éçå¶ä»æ¥è¯¢ é½å±ç¨è¿ä¸ªä¸è´æ§è§å¾ï¼</span></li><li><span>å¨è¯»æäº¤éç¦»çº§å«ä¸ï¼æ¯ä¸ä¸ªè¯­å¥æ§è¡åé½ä¼éæ°ç®åºä¸ä¸ªæ°çè§å¾ã</span></li></ul><p><span>è¿ééè¦è¯´æä¸ä¸ï¼âstart transaction with consistent snapshot; âçæææ¯ä»è¿ä¸ªè¯­å¥å¼å§ï¼å å»ºä¸ä¸ªæç»­æ´ä¸ªäºå¡çä¸è´æ§å¿«ç§ãæä»¥ï¼å¨è¯»æäº¤éç¦»çº§å«ä¸ï¼è¿ä¸ªç¨æ³å°±æ²¡æä¹äºï¼ç­æäº æ®éçstart transactionã</span></p><h2><a name="ä¸é¢æ¯è¯»æäº¤æ¶çç¶æå¾" class="md-header-anchor"></a><span>ä¸é¢æ¯è¯»æäº¤æ¶çç¶æå¾</span></h2><p><img src="Mysql 45è®².assets/image-20201109152521076.png" referrerpolicy="no-referrer" alt="image-20201109152521076"></p><p><img src="Mysql 45è®².assets/image-20201109152607846.png" referrerpolicy="no-referrer" alt="image-20201109152607846"></p><h2><a name="å°ç»-n341" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>InnoDBçè¡æ°æ®æå¤ä¸ªçæ¬ï¼æ¯ä¸ªæ°æ®çæ¬æèªå·±çrowtrx_idï¼æ¯ä¸ªäºå¡æèè¯­å¥æèªå·±çä¸ è´æ§è§å¾ãæ®éæ¥è¯¢è¯­å¥æ¯ä¸è´æ§è¯»ï¼ä¸è´æ§è¯»ä¼æ ¹æ®rowtrx_idåä¸è´æ§è§å¾ç¡®å®æ°æ®çæ¬ç å¯è§æ§ã</span></p><ul><li><span>å¯¹äºå¯éå¤è¯»ï¼æ¥è¯¢åªæ¿è®¤å¨äºå¡å¯å¨åå°±å·²ç»æäº¤å®æçæ°æ®ï¼</span></li><li><span>å¯¹äºè¯»æäº¤ï¼æ¥è¯¢åªæ¿è®¤å¨è¯­å¥å¯å¨åå°±å·²ç»æäº¤å®æçæ°æ®ï¼</span></li></ul><p><span>è¿æ¯å ä¸ºè¡¨ç»ææ²¡æå¯¹åºçè¡æ°æ®ï¼ä¹æ²¡æ rowtrx_idï¼å æ­¤åªè½éµå¾ªå½åè¯»çé»è¾ã</span></p><p><span>MySQL 8.0å·²ç»å¯ä»¥æè¡¨ç»ææ¾å¨InnoDBå­å¸éäºï¼ä¹è®¸ä»¥åä¼æ¯æè¡¨ç»æçå¯éå¤ è¯»ã</span></p><h2><a name="é®é¢-n350" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201109154403032.png" referrerpolicy="no-referrer" alt="image-20201109154403032"></p><p><span>ç­æ¡ï¼</span></p><p><img src="Mysql 45è®².assets/image-20201110154512452.png" referrerpolicy="no-referrer" alt="image-20201110154512452"></p><p><img src="Mysql 45è®².assets/image-20201110154531228.png" referrerpolicy="no-referrer" alt="image-20201110154531228"></p><h1><a name="09--æ®éç´¢å¼åå¯ä¸ç´¢å¼åºè¯¥æä¹éæ©" class="md-header-anchor"></a><span>09 | æ®éç´¢å¼åå¯ä¸ç´¢å¼ï¼åºè¯¥æä¹éæ©ï¼</span></h1><p><span>åè®¾ä½ å¨ç»´æ¤ä¸ä¸ªå¸æ°ç³»ç»ï¼æ¯ä¸ªäººé½æä¸ä¸ª</span><strong><span>å¯ä¸çèº«ä»½è¯å·</span></strong><span>ï¼èä¸ä¸å¡ä»£ç å·²ç»ä¿è¯äºä¸ä¼å å¥ä¸¤ä¸ªéå¤çèº«ä»½è¯å·ãå¦æå¸æ°ç³»ç»éè¦æç§èº«ä»½è¯å·æ¥å§åï¼å°±ä¼æ§è¡ç±»ä¼¼è¿æ ·çSQLè¯­ å¥ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> name <span class="cm-keyword">from</span> CUser <span class="cm-keyword">where</span> id_card = <span class="cm-string">'xxxxxxxyyyyyyzzzzz'</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>ä¸å®ä¼èèå¨id_cardå­æ®µä¸å»ºç´¢å¼ã</span></p><p><span>èº«ä»½è¯å·å­æ®µæ¯è¾å¤§ï¼æä¸å»ºè®®ä½ æèº«ä»½è¯å·å½åä¸»é®</span></p><p><span>é£ä¹ç°å¨ä½ æä¸¤ä¸ªéæ©ï¼è¦ä¹ç» id_cardå­æ®µåå»ºå¯ä¸ç´¢å¼ï¼è¦ä¹åå»ºä¸ä¸ªæ®éç´¢å¼ãå¦</span></p><p><span>æä»¬å°±ä»è¿ä¸¤ç§ç´¢å¼å¯¹æ¥è¯¢è¯­å¥åæ´æ°è¯­å¥çæ§è½å½±åæ¥è¿è¡åæ</span></p><h2><a name="æ¥è¯¢è¿ç¨" class="md-header-anchor"></a><span>æ¥è¯¢è¿ç¨</span></h2><p><span>select id fromTwhere k=5ãå¯ä»¥è®¤ä¸ºæ°æ®é¡µåé¨éè¿äºåæ³æ¥å®ä½è®°å½</span></p><ul><li><span>å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼æ¥æ¾å°æ»¡è¶³æ¡ä»¶çç¬¬ä¸ä¸ªè®°å½(5,500)åï¼éè¦æ¥æ¾ä¸ä¸ä¸ªè®°å½ï¼ç´å°ç¢° </span><strong><span>å°ç¬¬ä¸ä¸ªä¸æ»¡è¶³</span></strong><span>k=5æ¡ä»¶çè®°å½ã</span></li><li><span>å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼ç±äºç´¢å¼å®ä¹äºå¯ä¸æ§ï¼æ¥æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³æ¡ä»¶çè®°å½åï¼å°±ä¼åæ­¢ç»§ç»­æ£ç´¢ã</span></li></ul><p><span>æ§è½å·®è·å¾®ä¹å¶å¾®ã</span></p><p><span>InnoDBçæ°æ®æ¯æ</span><strong><span>æ°æ®é¡µ</span></strong><span>ä¸ºåä½æ¥è¯»åçãå½æ¾å°k=5çè®°å½çæ¶åï¼å®æå¨çæ°æ®é¡µå°±é½å¨</span><strong><span>åå­</span></strong><span>éäºãè¦å¤åçé£ä¸æ¬¡âæ¥æ¾åå¤æ­ä¸ä¸æ¡è®°å½âçæä½ï¼å°±åªéè¦ä¸æ¬¡æé å¯»æ¾åä¸æ¬¡è®¡ç®ã</span></p><p><span>å½ç¶ï¼å¦æk=5è¿ä¸ªè®°å½åå¥½æ¯è¿ä¸ªæ°æ®é¡µç</span><strong><span>æåä¸ä¸ªè®°å½</span></strong><span>ï¼é£ä¹è¦åä¸ä¸ä¸ªè®°å½ï¼å¿é¡»è¯»åä¸ ä¸ä¸ªæ°æ®é¡µï¼è¿ä¸ªæä½ä¼ç¨å¾®å¤æä¸äºã</span></p><p><span>å¯¹äºæ´åå­æ®µï¼ä¸ä¸ªæ°æ®é¡µå¯ä»¥æ¾è¿åä¸ªkeyï¼å æ­¤åºç°è¿ç§æåµçæ¦ çä¼å¾ä½ãæä»¥ï¼æä»¬è®¡ç®å¹³åæ§è½å·®å¼æ¶ï¼ä»å¯ä»¥è®¤ä¸ºè¿ä¸ªæä½ææ¬å¯¹äºç°å¨çCPUæ¥è¯´å¯ä»¥ </span><strong><span>å¿½ç¥ä¸è®¡</span></strong><span>ã</span></p><h2><a name="æ´æ°è¿ç¨change-bufferï¼" class="md-header-anchor"></a><span>æ´æ°è¿ç¨ï¼change bufferï¼</span></h2><p><img src="Mysql 45è®².assets/image-20201109162144269.png" referrerpolicy="no-referrer" alt="image-20201109162144269"></p><p><span>å½éè¦æ´æ°ä¸ä¸ªæ°æ®é¡µæ¶ï¼å¦æ</span><strong><span>æ°æ®é¡µå¨åå­ä¸­</span></strong><span>å°±ç´æ¥æ´æ°ï¼èå¦æè¿ä¸ªæ°æ®é¡µè¿æ²¡æå¨åå­ä¸­ çè¯ï¼å¨ä¸å½±å</span><strong><span>æ°æ®ä¸è´æ§</span></strong><span>çåæä¸ï¼InooDBä¼å°è¿äºæ´æ°æä½</span><strong><span>ç¼å­å¨change buffer</span></strong><span>ä¸­ï¼è¿æ · å°±ä¸éè¦ä»ç£çä¸­è¯»å¥è¿ä¸ªæ°æ®é¡µäºãå¨ä¸æ¬¡æ¥è¯¢éè¦è®¿é®è¿ä¸ªæ°æ®é¡µçæ¶åï¼å°</span><strong><span>æ°æ®é¡µè¯»å¥å å­</span></strong><span>ï¼ç¶åæ§è¡change bufferä¸­ä¸è¿ä¸ªé¡µæå³çæä½ãéè¿è¿ç§æ¹å¼å°±è½ä¿è¯è¿ä¸ªæ°æ®é»è¾çæ­£ ç¡®æ§ã</span></p><p><span>å°change bufferä¸­çæä½</span><strong><span>åºç¨å°åæ°æ®é¡µ</span></strong><span>ï¼å¾å°ææ°ç»æçè¿ç¨ç§°ä¸º</span><code>merge</code><span>ãé¤äº</span><strong><span>è®¿é®è¿ä¸ªæ°æ® é¡µ</span></strong><span>ä¼è§¦åmergeå¤ï¼ç³»ç»æåå°çº¿ç¨ä¼</span><strong><span>å®æmerge</span></strong><span>ãå¨æ°æ®åº</span><strong><span>æ­£å¸¸å³é­</span></strong><span>ï¼shutdownï¼çè¿ç¨ä¸­ï¼ ä¹ä¼æ§è¡mergeæä½ãæ°æ®è¯»å¥åå­æ¯éè¦å ç¨</span><strong><span>buffer pool</span></strong><span>çï¼æä»¥è¿ç§æ¹å¼è¿è½å¤é¿åå ç¨åå­ï¼æé«åå­å©ç¨çã</span></p><p><span>å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼ææçæ´æ°æä½é½è¦åå¤æ­è¿ä¸ªæä½æ¯å¦è¿åå¯ä¸æ§çº¦æãæ¯å¦ï¼è¦æå¥ (4,400)è¿ä¸ªè®°å½ï¼å°±è¦åå¤æ­ç°å¨è¡¨ä¸­æ¯å¦å·²ç»å­å¨k=4çè®°å½ï¼èè¿å¿é¡»è¦å°æ°æ®é¡µè¯»å¥åå­ æè½å¤æ­ãå¦æé½å·²ç»è¯»å¥å°åå­äºï¼é£ç´æ¥æ´æ°åå­ä¼æ´å¿«ï¼å°±æ²¡å¿è¦ä½¿ç¨change buffer äºã</span></p><p><span> å æ­¤ï¼å¯ä¸ç´¢å¼çæ´æ°å°±</span><strong><span>ä¸è½</span></strong><span>ä½¿ç¨change bufferï¼å®éä¸ä¹</span><strong><span>åªææ®éç´¢å¼</span></strong><span>å¯ä»¥ä½¿ç¨ã</span></p><p><img src="Mysql 45è®².assets/image-20201109170208165.png" referrerpolicy="no-referrer" alt="image-20201109170208165"></p><p><span>change bufferç¨çæ¯buffer pooléçåå­,change bufferçå¤§å°ï¼å¯ä»¥é è¿åæ°innodb_change_buffer_max_sizeæ¥</span><strong><span>å¨æè®¾ç½®</span></strong><span>ãè¿ä¸ªåæ°è®¾ç½®ä¸º50çæ¶åï¼è¡¨ç¤ºchange bufferçå¤§å°æå¤åªè½å ç¨buffer poolç50%ã</span></p><h3><a name="å¦æè¦å¨è¿å¼ è¡¨ä¸­æå¥ä¸ä¸ª-æ°è®°å½4400çè¯innodbçå¤çæµç¨æ¯ææ ·ç" class="md-header-anchor"></a><span>å¦æè¦å¨è¿å¼ è¡¨ä¸­æå¥ä¸ä¸ª æ°è®°å½(4,400)çè¯ï¼InnoDBçå¤çæµç¨æ¯ææ ·ç</span></h3><p><span>ç¬¬ä¸ç§æåµæ¯ï¼è¿ä¸ªè®°å½è¦æ´æ°çç®æ é¡µ</span><strong><span>å¨åå­ä¸­</span></strong></p><ul><li><p><span>å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼æ¾å°3å5ä¹é´çä½ç½®ï¼å¤æ­å°</span><strong><span>æ²¡æå²çª</span></strong><span>ï¼æå¥è¿ä¸ªå¼ï¼è¯­å¥æ§è¡ç»æï¼</span></p></li><li><p><span>å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼æ¾å°3å5ä¹é´çä½ç½®ï¼æå¥è¿ä¸ªå¼ï¼è¯­å¥æ§è¡ç»æã</span></p><p><span>å·®å«ï¼åªæ¯ä¸ä¸ªå¤æ­ï¼åªä¼èè´¹å¾®å°ç CPUæ¶é´</span></p></li></ul><p><span>ç¬¬äºç§æåµæ¯ï¼è¿ä¸ªè®°å½è¦æ´æ°çç®æ é¡µ</span><strong><span>ä¸å¨åå­ä¸­</span></strong><span>ã</span></p><ul><li><p><span>å¯¹äºå¯ä¸ç´¢å¼æ¥è¯´ï¼éè¦å°æ°æ®é¡µ</span><strong><span>è¯»å¥åå­</span></strong><span>ï¼å¤æ­å°æ²¡æå²çªï¼</span><strong><span>æå¥è¿ä¸ªå¼</span></strong><span>ï¼è¯­å¥æ§è¡ç»æï¼ </span></p></li><li><p><span>å¯¹äºæ®éç´¢å¼æ¥è¯´ï¼åæ¯å°æ´æ°è®°å½å¨</span><strong><span>change buffer</span></strong><span>ï¼è¯­å¥æ§è¡å°±ç»æäºã</span></p><p><span>ä»ç£çè¯»å¥åå­æ¶å</span><strong><span>éæºIO</span></strong><span>çè®¿é®ï¼æ¯æ°æ®åºéé¢ææ¬æé«çæä½ä¹ä¸ãchange buffer å ä¸º</span><strong><span>åå°äº</span></strong><span>éæºç£çè®¿é®ï¼æä»¥å¯¹æ´æ°æ§è½çæåæ¯ä¼å¾ææ¾çã</span></p></li></ul><h2><a name="change-bufferçä½¿ç¨åºæ¯" class="md-header-anchor"></a><span>change bufferçä½¿ç¨åºæ¯</span></h2><p><span>æ®é ç´¢å¼çææåºæ¯ï¼ä½¿ç¨change bufferé½å¯ä»¥èµ·å°å éä½ç¨åï¼</span></p><p><span>æä»¥å¨ä¸ä¸ªæ°æ®é¡µåmergeä¹åï¼change bufferè®°å½çåæ´è¶å¤ï¼ä¹å°±æ¯è¿ä¸ªé¡µé¢ ä¸è¦æ´æ°çæ¬¡æ°è¶å¤ï¼ï¼æ¶çå°±è¶å¤§ã</span></p><p><span>å¯¹äº</span><strong><span>åå¤è¯»å°</span></strong><span>çä¸å¡æ¥è¯´ï¼é¡µé¢å¨åå®ä»¥åé©¬ä¸è¢«è®¿é®å°çæ¦çæ¯è¾å°ï¼æ­¤æ¶change bufferçä½¿ç¨æææå¥½ãè¿ç§ä¸å¡æ¨¡åå¸¸è§çå°±æ¯è´¦åç±»ãæ¥å¿ç±»çç³»ç»ã</span></p><p><span>å°æ´æ°åè®° å½å¨change bufferï¼ä½ä¹åç±äºé©¬ä¸è¦è®¿é®è¿ä¸ªæ°æ®é¡µï¼ä¼ç«å³è§¦åmergeè¿ç¨ãè¿æ ·éæºè®¿é® IOçæ¬¡æ°ä¸ä¼åå°ï¼åèå¢å äºchange bufferçç»´æ¤ä»£ä»·ãæä»¥ï¼å¯¹äºè¿ç§ä¸å¡æ¨¡å¼æ¥ è¯´ï¼change bufferåèèµ·å°äºå¯ä½ç¨ã</span></p><h2><a name="ç´¢å¼éæ©åå®è·µ" class="md-header-anchor"></a><span>ç´¢å¼éæ©åå®è·µ</span></h2><p><span>è¿ä¸¤ç±»ç´¢å¼å¨æ¥è¯¢è½åä¸ æ¯æ²¡å·®å«çï¼ä¸»è¦èèçæ¯å¯¹</span><strong><span>æ´æ°æ§è½</span></strong><span>çå½±åãæä»¥ï¼æå»ºè®®ä½ å°½ééæ©æ®éç´¢å¼ã</span></p><p><span>å¦æææç</span><strong><span>æ´æ°åé¢ï¼é½é©¬ä¸ä¼´éçå¯¹è¿ä¸ªè®°å½çæ¥è¯¢</span></strong><span>ï¼é£ä¹ä½ åºè¯¥</span><code>å³é­change buffer</code><span>ãèå¨ å¶ä»æåµä¸ï¼change bufferé½è½æåæ´æ°æ§è½ã</span></p><h2><a name="change-buffer-å-redo-log" class="md-header-anchor"></a><span>change buffer å redo log</span></h2><p><span>WAL æåæ§è½çæ ¸å¿æº å¶ï¼ä¹çç¡®æ¯å°½éåå°</span><strong><span>éæºè¯»å</span></strong></p><p><span>k1 æ°æ®é¡µååå­</span></p><p><span>k2 ä¸å¨</span></p><p><img src="Mysql 45è®².assets/image-20201110153240140.png" referrerpolicy="no-referrer" alt="image-20201110153240140"></p><p><img src="Mysql 45è®².assets/image-20201110153316985.png" referrerpolicy="no-referrer" alt="image-20201110153316985"></p><p><span>ç¶ååäºä¸å¤ç£çï¼ä¸¤æ¬¡æä½åå¨ä¸èµ·åäºä¸æ¬¡ç£çï¼ï¼èä¸è¿æ¯é¡ºåºåçã</span></p><p><span>æä»¬ç°å¨è¦æ§è¡ select *fromt where k in (k1, k2)ã</span></p><p><img src="Mysql 45è®².assets/image-20201110153519192.png" referrerpolicy="no-referrer" alt="image-20201110153519192"></p><p><img src="Mysql 45è®².assets/image-20201110153555894.png" referrerpolicy="no-referrer" alt="image-20201110153555894"></p><p><strong><span>redo log ä¸»è¦èççæ¯é æº</span><font color="red"><span>å</span></font><span>ç£ççIOæ¶èï¼è½¬æé¡ºåºåï¼ï¼èchange bufferä¸»è¦èççåæ¯éæº</span><font color="red"><span>è¯»</span></font><span>ç£ççIOæ¶ èã</span></strong></p><h2><a name="å°ç»-n415" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>æ®éç´¢å¼åå¯ä¸ç´¢å¼çéæ©å¼å§ï¼åä½ åäº«äºæ°æ®çæ¥è¯¢åæ´æ°è¿ç¨ï¼ç¶åè¯´æäº change bufferçæºå¶ä»¥ååºç¨åºæ¯ï¼æåè®²å°äºç´¢å¼éæ©çå®è·µã</span></p><p><span>å¯ä¸ç´¢å¼</span><strong><span>ç¨ä¸ä¸</span></strong><span>change bufferçä¼åæºå¶</span></p><p><span>å¦æç¢°ä¸äºå¤§éæå¥æ°æ®æ¢ãåå­ å½ä¸­çä½çæ¶åï¼å¯ä»¥ç»ä½ å¤æä¾ä¸ä¸ªææ¥æè·¯</span></p><h2><a name="é®é¢-n419" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>change bufferä¸å¼å§æ¯ååå­çï¼é£ä¹å¦æè¿ä¸ªæ¶åæºå¨æçµéå¯ï¼ä¼ä¸ ä¼å¯¼è´change bufferä¸¢å¤±å¢ï¼change bufferä¸¢å¤±å¯ä¸æ¯å°äºå¿ï¼åä»ç£çè¯»å¥æ°æ®å¯å°±æ²¡æäº mergeè¿ç¨ï¼å°±ç­äºæ¯æ°æ®ä¸¢å¤±äºãä¼ä¸ä¼åºç°è¿ç§æåµå¢ï¼</span></p><p><span>ç­æ¡æ¯ä¸ä¼ä¸¢å¤±ï¼çè¨åºçå¾å¤åå­¦é½åç­å¯¹äºãè½ç¶æ¯åªæ´æ°åå­ï¼ä½æ¯å¨äºå¡æäº¤çæ¶åï¼æä»¬æchange bufferçæä½ä¹è®°å½å°</span><strong><span>redo log</span></strong><span>éäºï¼æä»¥å´©æºæ¢å¤çæ¶åï¼change bufferä¹è½æ¾åæ¥ã</span></p><p><img src="Mysql 45è®².assets/image-20201110165513483.png" referrerpolicy="no-referrer" alt="image-20201110165513483"></p><h1><a name="10--mysqlä¸ºä»ä¹ææ¶åä¼ééç´¢å¼analyze-table-t" class="md-header-anchor"></a><span>10 | MySQLä¸ºä»ä¹ææ¶åä¼ééç´¢å¼ï¼analyze table t</span></h1><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`t`</span> ( </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`a`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`b`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">KEY</span> <span class="cm-variable-2">`a`</span> (<span class="cm-variable-2">`a`</span>), <span class="cm-keyword">KEY</span> <span class="cm-variable-2">`b`</span> (<span class="cm-variable-2">`b`</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span>ï¼</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ----å¾è¡¨tä¸­æå¥10ä¸è¡è®°å½</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">delimiter</span> ;;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">create</span> <span class="cm-keyword">procedure</span> idata()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">begin</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">declare</span> i <span class="cm-builtin">int</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">set</span> i=<span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span>(i&lt;=<span class="cm-number">100000</span>)<span class="cm-keyword">do</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> t <span class="cm-keyword">values</span>(i, i, i);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">set</span> i=i+<span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span> <span class="cm-keyword">while</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span>;;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">delimiter</span> ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">call</span> idata();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 460px;"></div><div class="CodeMirror-gutters" style="display: none; height: 460px;"></div></div></div></pre><h2><a name="æåµä¸" class="md-header-anchor"></a><span>æåµä¸ï¼</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; select * from t where a between 10000 and 20000;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>ä½ ä¼è¯´ï¼aä¸æç´¢å¼ï¼è¯å®æ¯è¦ä½¿ç¨ç´¢å¼aç</span></p><p><img src="Mysql 45è®².assets/image-20201110154953239.png" referrerpolicy="no-referrer" alt="image-20201110154953239"></p><p><span>ä¹ç¡®å®ç¬¦åé¢æ</span></p><p><img src="Mysql 45è®².assets/image-20201110155028131.png" referrerpolicy="no-referrer" alt="image-20201110155028131"></p><p><span>session Aï¼å¼å¯äºä¸ä¸ªäºå¡</span></p><p><span>session Bï¼ææ°æ®é½å  é¤åï¼åè°ç¨äº idataè¿ä¸ªå­å¨è¿ç¨ï¼æå¥äº10ä¸è¡æ°æ®</span></p><p><span>è¿æ¶åï¼session Bçæ¥è¯¢è¯­å¥select *fromt where a between 10000 and 20000å°±</span><strong><span>ä¸ä¼åéæ©ç´¢å¼a</span></strong><span>äºãæä»¬å¯ä»¥éè¿æ¢æ¥è¯¢æ¥å¿ï¼slowlogï¼æ¥æ¥çä¸ä¸å·ä½çæ§è¡æåµã</span></p><p><img src="Mysql 45è®².assets/image-20201110155211672.png" referrerpolicy="no-referrer" alt="image-20201110155211672"></p><p><img src="Mysql 45è®².assets/image-20201110155231304.png" referrerpolicy="no-referrer" alt="image-20201110155231304"></p><p><span>Q1æ«æäº10ä¸è¡</span></p><p><span>Q2æ«æäº10001è¡</span></p><h2><a name="ä¼åå¨çé»è¾" class="md-header-anchor"></a><span>ä¼åå¨çé»è¾</span></h2><p><span>éæ©ç´¢å¼æ¯ä¼åå¨çå·¥ä½</span></p><p><span>æ¯æ¾å°ä¸ä¸ªæä¼çæ§è¡æ¹æ¡ï¼å¹¶ç¨æå°çä»£ä»·å»æ§è¡è¯­å¥ãå¨æ°æ®åº éé¢ï¼</span><strong><span>æ«æè¡æ°</span></strong><span>æ¯å½±åæ§è¡ä»£ä»·çå ç´ ä¹ä¸ãæ«æçè¡æ°è¶å°ï¼æå³çè®¿é®ç£çæ°æ®çæ¬¡æ°è¶ å°ï¼æ¶èçCPUèµæºè¶å°ã</span></p><h3><a name="æ«æè¡æ°æ¯æä¹å¤æ­ç" class="md-header-anchor"></a><span>æ«æè¡æ°æ¯æä¹å¤æ­çï¼</span></h3><p><span>çæ­£å¼å§æ§è¡è¯­å¥ä¹åï¼å¹¶</span><strong><span>ä¸è½ç²¾ç¡®</span></strong><span>å°ç¥éæ»¡è¶³è¿ä¸ªæ¡ä»¶çè®°å½æå¤å°æ¡ï¼èåªè½æ ¹ æ®ç»è®¡ä¿¡æ¯æ¥ä¼°ç®è®°å½æ°ã</span></p><p><span>è¿ä¸ªç»è®¡ä¿¡æ¯å°±æ¯ç´¢å¼ç</span><strong><span>âåºååº¦</span></strong><span>âãæ¾ç¶ï¼ä¸ä¸ªç´¢å¼ä¸ä¸åçå¼è¶å¤ï¼è¿ä¸ªç´¢å¼çåºååº¦å°±è¶ å¥½ãèä¸ä¸ªç´¢å¼ä¸</span><strong><span>ä¸å</span></strong><span>çå¼çä¸ªæ°ï¼æä»¬ç§°ä¹ä¸ºâ</span><strong><span>åºæ°</span></strong><span>âï¼cardinalityï¼ãä¹å°±æ¯è¯´ï¼è¿ä¸ªåºæ°è¶å¤§ï¼ç´¢å¼çåºååº¦è¶å¥½ã</span></p><p><span>show indexæ¹æ³ï¼çå°ä¸ä¸ªç´¢å¼çåºæ°</span></p><p><img src="Mysql 45è®².assets/image-20201110155748271.png" referrerpolicy="no-referrer" alt="image-20201110155748271"></p><p><span>MySQLæ¯ææ ·å¾å°ç´¢å¼çåºæ°çå¢ï¼</span></p><h4><a name="éæ ·ç»è®¡" class="md-header-anchor"></a><span>éæ ·ç»è®¡</span></h4><p><span>InnoDBé»è®¤ä¼éæ©Nä¸ª</span><strong><span>æ°æ®é¡µ</span></strong><span>ï¼ç»è®¡è¿äºé¡µé¢ä¸ç</span><strong><span>ä¸åå¼</span></strong><span>ï¼å¾å°ä¸ä¸ª</span><strong><span>å¹³åå¼</span></strong><span>ï¼ç¶åä¹ä»¥è¿ä¸ª</span><strong><span>ç´¢å¼çé¡µé¢æ°</span></strong><span>ï¼å°±å¾å°äºè¿ä¸ªç´¢å¼ç</span><strong><span>åºæ°</span></strong><span>ã</span></p><p><span>èæ°æ®è¡¨æ¯ä¼</span><strong><span>æç»­æ´æ°</span></strong><span>çï¼ç´¢å¼ç»è®¡ä¿¡æ¯ä¹ä¸ä¼åºå®ä¸åãæä»¥ï¼å½</span><strong><span>åæ´</span></strong><span>çæ°æ®è¡æ°</span><strong><span>è¶è¿1/M</span></strong><span>ç æ¶åï¼ä¼èªå¨è§¦å</span><strong><span>éæ°</span></strong><span>åä¸æ¬¡</span><strong><span>ç´¢å¼ç»è®¡</span></strong><span>ã</span></p><p><img src="Mysql 45è®².assets/image-20201110160226554.png" referrerpolicy="no-referrer" alt="image-20201110160226554"></p><p><span>rowsè¿ä¸ªå­æ®µè¡¨ç¤ºçæ¯é¢è®¡æ«æè¡æ°ã</span></p><p><span>èæ¯ä¼åå¨ä¸ºä»ä¹æ¾çæ«æ37000è¡çæ§è¡è®¡å ä¸ç¨ï¼å´éæ©äºæ«æè¡æ°æ¯100000çæ§è¡è®¡åå¢ï¼</span></p><p><span>å¦æä½¿ç¨ç´¢å¼aï¼æ¯æ¬¡ä»ç´¢å¼aä¸æ¿å°ä¸ä¸ªå¼ï¼é½è¦åå°ä¸»é®ç´¢å¼ä¸æ¥åºæ´è¡æ°æ®ï¼ è¿ä¸ªä»£ä»·ä¼åå¨ä¹è¦ç®è¿å»çã(</span><strong><span>åè¡¨</span></strong><span>)</span></p><p><span>è³äº ä¸ºä»ä¹ä¼å¾å°éè¯¯çæ«æè¡æ°ï¼è¿ä¸ªåå å°±ä½ä¸ºè¯¾åé®é¢ï¼çç»ä½ å»åæäºï¼</span></p><p><code>analyze table t æ¥ä¿®æ­£ç»è®¡ä¿¡æ¯</code></p><h2><a name="æåµäº" class="md-header-anchor"></a><span>æåµäº</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; select * from t where (a between 1 and 1000) and (b between 50000 and 100000) </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201110163239036.png" referrerpolicy="no-referrer" alt="image-20201110163239036"></p><p><img src="Mysql 45è®².assets/image-20201110163302612.png" referrerpolicy="no-referrer" alt="image-20201110163302612"></p><p><span>è¿æ¬¡ä¼åå¨éæ©äºç´¢å¼bï¼èrowså­æ®µæ¾ç¤ºéè¦æ«æçè¡ æ°æ¯50198ã </span></p><p><span>ä¹åä¼åå¨éæ©ä½¿ç¨ç´¢å¼bï¼æ¯å ä¸ºå®è®¤ä¸ºä½¿ç¨ç´¢å¼bå¯ä»¥</span><strong><span>é¿åæåº</span></strong><span>ï¼bæ¬èº«æ¯ç´¢å¼ï¼å·²ç»æ¯æåº çäºï¼å¦æéæ©ç´¢å¼bçè¯ï¼ä¸éè¦ååæåºï¼åªéè¦éåï¼ï¼æä»¥å³ä½¿æ«æè¡æ°å¤ï¼ä¹å¤å®ä¸º ä»£ä»·æ´å°ã</span></p><p><span>ä»è¿ä¸ªç»æä¸­ï¼ä½ å¯ä»¥å¾å°ä¸¤ä¸ªç»è®ºï¼ </span></p><ol start='' ><li><span>æ«æè¡æ°çä¼°è®¡å¼ä¾ç¶ä¸åç¡®ï¼</span></li><li><span>è¿ä¸ªä¾å­éMySQLåééäºç´¢å¼ã</span></li></ol><h2><a name="è§£å³æ¹æ¡" class="md-header-anchor"></a><span>è§£å³æ¹æ¡</span></h2><ul><li><span>ä¸ç§æ¹æ³æ¯ï¼åæä»¬ç¬¬ä¸ä¸ªä¾å­ä¸æ ·ï¼éç¨</span><code>force index</code><span>å¼ºè¡éæ©ä¸ä¸ªç´¢å¼ã</span></li></ul><p><span>ç¼ºç¹ï¼ä¸æ¥è¿ä¹åä¸ä¼ç¾ï¼äºæ¥å¦æç´¢å¼æ¹äºåå­ï¼è¿ä¸ªè¯­å¥ mysql&gt; explain select * from t where (a between 1 and 1000) and (b between 50000 and 100000) order by b limit 1; ä¹å¾æ¹ï¼æ¾å¾å¾éº»ç¦ãèä¸å¦æä»¥åè¿ç§»å°å«çæ°æ®åºçè¯ï¼è¿ä¸ªè¯­æ³è¿å¯è½ä¼ä¸å¼å®¹</span></p><p><span>æ°æ®åºçé®é¢æå¥½è¿æ¯å¨æ°æ®åºåé¨æ¥è§£å³</span></p><ul><li><span>ç¬¬äºç§æ¹æ³å°±æ¯ï¼æä»¬å¯ä»¥èèä¿®æ¹ è¯­å¥ï¼å¼å¯¼MySQLä½¿ç¨æä»¬ææçç´¢å¼ã</span></li></ul><p><span>order byb limit 1â æ¹ æ âorder byb,a limit 1â ï¼è¯­ä¹çé»è¾æ¯ç¸åçã</span></p><p><span>æç§b,aæåºï¼å°±æå³çä½¿ç¨è¿ä¸¤ä¸ªç´¢å¼</span><strong><span>é½éè¦æåº</span></strong></p><ul><li><span>ç¬¬ä¸ç§æ¹æ³æ¯ï¼å¨æäºåºæ¯ä¸ï¼æä»¬å¯ä»¥æ°å»ºä¸ä¸ªæ´åéçç´¢å¼ï¼æ¥æä¾ç»ä¼åå¨åé æ©ï¼æ</span><strong><span>å æè¯¯ç¨çç´¢å¼</span></strong><span>ã</span></li></ul><h2><a name="å°ç»-n483" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>èç´¢å¼ç»è®¡çæ´æ°æºå¶ï¼ä¼åå¨å­å¨ééç´¢å¼çå¯è½æ§ï¼åºæ°ï¼åè¡¨ï¼æåºï¼</span></p><p><code>analyze tableæ¥è§£å³</code></p><p><span>force indexæ¥å¼ºè¡æå®ç´¢å¼ï¼ä¹å¯ä»¥éè¿ä¿®æ¹ è¯­å¥æ¥å¼å¯¼ä¼åå¨ï¼è¿å¯ä»¥éè¿å¢å æèå é¤ç´¢å¼æ¥ç»è¿è¿ä¸ªé®é¢ã</span></p><h2><a name="é®é¢-n487" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>è¿session Açéåï¼ è®©session Bå é¤æ°æ®ååéæ°æå¥äºä¸éæ°æ®ï¼ç¶åå°±åç°explainç»æä¸­ï¼rowså­æ®µä»10001 åæ37000å¤ã</span></p><p><span>èå¦ææ²¡æsession Açéåï¼åªæ¯åç¬æ§è¡delete fromt ãcall idata()ãexplainè¿ä¸å¥è¯ï¼ä¼ç å°rowså­æ®µå¶å®è¿æ¯10000å·¦å³ãä½ å¯ä»¥èªå·±éªè¯ä¸ä¸è¿ä¸ªç»æãä¸ºä»ä¹å¢ï¼</span></p><p>&nbsp;</p><p><span>ä½æ¯ï¼session Aå¼å¯äºäºå¡å¹¶æ²¡ææäº¤ï¼æä»¥ä¹åæå¥ç10ä¸è¡æ°æ®æ¯ä¸è½å é¤çãè¿æ ·ï¼ä¹ åçæ°æ®æ¯ä¸è¡æ°æ®é½æ</span><strong><span>ä¸¤ä¸ªçæ¬</span></strong><span>ï¼æ§çæ¬æ¯deleteä¹åçæ°æ®ï¼æ°çæ¬æ¯æ è®°ä¸ºdeletedçæ° æ®ã</span></p><p><span>è¿æ ·ï¼ç´¢å¼aä¸çæ°æ®å¶å®å°±æä¸¤ä»½ã ç¶åä½ ä¼è¯´ï¼ä¸å¯¹åï¼ä¸»é®ä¸çæ°æ®ä¹ä¸è½å ï¼é£æ²¡æä½¿ç¨force indexçè¯­å¥ï¼ä½¿ç¨explainå½ä»¤ çå°çæ«æè¡æ°ä¸ºä»ä¹è¿æ¯100000å·¦å³ï¼ï¼æ½å°è¯ï¼å¦æè¿ä¸ªä¹ç¿»åï¼ä¹è®¸ä¼åå¨è¿ä¼è®¤ä¸ºé å­æ®µaä½ä¸ºç´¢å¼æ´åéï¼</span></p><p><span> æ¯çï¼ä¸è¿è¿ä¸ªæ¯ä¸»é®ï¼ä¸»é®æ¯ç´æ¥æç§è¡¨çè¡æ°æ¥ä¼°è®¡çãèè¡¨çè¡æ°ï¼ä¼åå¨ç´æ¥ç¨çæ¯ </span><strong><span>showt able status</span></strong><span>çå¼ã</span></p><h1><a name="11--æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼" class="md-header-anchor"></a><span>11 | æä¹ç»å­ç¬¦ä¸²å­æ®µå ç´¢å¼ï¼</span></h1><p><span>é®ç®±è¿æ ·çå­æ®µä¸å»ºç«åççç´¢å¼</span></p><p><img src="Mysql 45è®².assets/image-20201110170424169.png" referrerpolicy="no-referrer" alt="image-20201110170424169"></p><h2><a name="åç¼ç´¢å¼" class="md-header-anchor"></a><span>åç¼ç´¢å¼</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">alter</span> <span class="cm-keyword">table</span> SUser <span class="cm-keyword">add</span> <span class="cm-keyword">index</span> index2(email(<span class="cm-number">6</span>));</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201110170719851.png" referrerpolicy="no-referrer" alt="image-20201110170719851"></p><p><strong><span>ä½¿ç¨åç¼ç´¢å¼ï¼å®ä¹å¥½é¿åº¦ï¼å°±å¯ä»¥åå°æ¢èçç©ºé´ï¼åä¸ç¨é¢å¤å¢å å¤ªå¤çæ¥ è¯¢ææ¬ã</span></strong></p><p><span>æä»¬è¦çä¸ä¸4~7ä¸ªå­èçåç¼ç´¢å¼</span></p><p><img src="Mysql 45è®².assets/image-20201110170918280.png" referrerpolicy="no-referrer" alt="image-20201110170918280"></p><h3><a name="åç¼ç´¢å¼å¯¹è¦çç´¢å¼çå½±å" class="md-header-anchor"></a><span>åç¼ç´¢å¼å¯¹è¦çç´¢å¼çå½±å</span></h3><p><span>å¦æä½¿ç¨index1ï¼å³emailæ´ä¸ªå­ç¬¦ä¸²çç´¢å¼ç»æï¼çè¯ï¼å¯ä»¥å©ç¨è¦çç´¢å¼ï¼ä»index1æ¥ å°ç»æåç´æ¥å°±è¿åäºï¼ä¸éè¦åå°IDç´¢å¼åå»æ¥ä¸æ¬¡ãèå¦æä½¿ç¨index2ï¼å³email(6)ç´¢å¼ç» æï¼çè¯ï¼å°±ä¸å¾ä¸åå°IDç´¢å¼åå»å¤æ­emailå­æ®µçå¼ã</span></p><p><span>å³ä½¿ä½ å°index2çå®ä¹ä¿®æ¹ä¸ºemail(18)çåç¼ç´¢å¼ï¼è¦åå°idç´¢å¼åæ¥ä¸ä¸ï¼å®ä¹æ¯å¦æªæ­äºå®æ´ä¿¡ æ¯ã</span></p><h2><a name="å¶ä»æ¹å¼" class="md-header-anchor"></a><span>å¶ä»æ¹å¼</span></h2><p><span>åè®¾ä½ ç»´æ¤çæ°æ®åºæ¯ä¸ä¸ªå¸çå¬æ°ä¿¡æ¯ç³»ç»ï¼è¿æ¶åå¦æå¯¹èº«ä»½è¯å·åé¿åº¦ä¸º6çåç¼ç´¢å¼ç è¯ï¼è¿ä¸ªç´¢å¼çåºååº¦å°±éå¸¸ä½äºã</span></p><h3><a name="ç¬¬ä¸ç§æ¹å¼æ¯ä½¿ç¨ååºå­å¨" class="md-header-anchor"></a><span>ç¬¬ä¸ç§æ¹å¼æ¯ä½¿ç¨ååºå­å¨ã</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> field_list <span class="cm-keyword">from</span> t <span class="cm-keyword">where</span> id_card = reverse(<span class="cm-string">'input_id_card_string'</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>æä»¥æåè¿6ä½å¾å¯è½å°±æä¾äºè¶³å¤çåº ååº¦ãå½ç¶äºï¼å®è·µä¸­ä½ ä¸è¦å¿è®°ä½¿ç¨count(distinct)æ¹æ³å»åä¸ªéªè¯</span></p><h3><a name="ç¬¬äºç§æ¹å¼æ¯ä½¿ç¨hashå­æ®µ" class="md-header-anchor"></a><span>ç¬¬äºç§æ¹å¼æ¯ä½¿ç¨hashå­æ®µ</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">alter</span> <span class="cm-keyword">table</span> t <span class="cm-keyword">add</span> id_card_crc <span class="cm-builtin">int</span> <span class="cm-builtin">unsigned</span>, <span class="cm-keyword">add</span> <span class="cm-keyword">index</span>(id_card_crc);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>æ¯æ¬¡æå¥æ°è®°å½çæ¶åï¼é½åæ¶ç¨</span><strong><span>crc32()</span></strong><span>è¿ä¸ªå½æ°å¾å°æ ¡éªç å¡«å°è¿ä¸ªæ°å­æ®µï¼ä¸¤ä¸ªä¸åçèº«ä»½è¯å·éè¿crc32()å½æ°å¾å°çç»æå¯è½æ¯ç¸åçï¼whereé¨åè¦å¤æ­id_cardçå¼æ¯å¦ç²¾ç¡®ç¸åã</span></p><p><span>ç´¢å¼çé¿åº¦åæäº4ä¸ªå­èï¼æ¯åæ¥å°äºå¾å¤ã</span></p><ol start='' ><li><span>ä»å ç¨ç</span><strong><span>é¢å¤ç©ºé´</span></strong><span>æ¥çï¼ååºå­å¨æ¹å¼å¨ä¸»é®ç´¢å¼ä¸ï¼ä¸ä¼æ¶èé¢å¤çå­å¨ç©ºé´ï¼èhashå­ æ®µæ¹æ³éè¦å¢å ä¸ä¸ªå­æ®µãå½ç¶ï¼ååºå­å¨æ¹å¼ä½¿ç¨4ä¸ªå­èçåç¼é¿åº¦åºè¯¥æ¯ä¸å¤çï¼å¦ æåé¿ä¸ç¹ï¼è¿ä¸ªæ¶èè·é¢å¤è¿ä¸ªhashå­æ®µä¹</span><strong><span>å·®ä¸å¤æµæ¶</span></strong><span>äºã</span></li><li><span>å¨</span><strong><span>CPUæ¶è</span></strong><span>æ¹é¢ï¼ååºæ¹å¼æ¯æ¬¡ååè¯»çæ¶åï¼é½éè¦é¢å¤è°ç¨ä¸æ¬¡reverseå½æ°ï¼èhash å­æ®µçæ¹å¼éè¦é¢å¤</span><strong><span>è°ç¨ä¸æ¬¡</span></strong><span>crc32()å½æ°ãå¦æåªä»è¿ä¸¤ä¸ªå½æ°ç</span><strong><span>è®¡ç®å¤æåº¦</span></strong><span>æ¥çç è¯ï¼</span><strong><span>reverseå½æ°</span></strong><span>é¢å¤æ¶èçCPUèµæºä¼æ´å°äºã</span></li><li><span>ä»æ¥è¯¢æçä¸çï¼ä½¿ç¨</span><strong><span>hash</span></strong><span>å­æ®µæ¹å¼çæ¥è¯¢æ§è½ç¸å¯¹æ´ç¨³å®ä¸äºãå ä¸ºcrc32ç®åºæ¥çå¼è½ ç¶æå²çªçæ¦çï¼ä½æ¯æ¦çéå¸¸å°ï¼å¯ä»¥è®¤ä¸ºæ¯æ¬¡æ¥è¯¢çå¹³åæ«æè¡æ°æ¥è¿1ãèååºå­å¨ æ¹å¼æ¯ç«è¿æ¯ç¨ç</span><strong><span>åç¼ç´¢å¼</span></strong><span>çæ¹å¼ï¼ä¹å°±æ¯è¯´è¿æ¯ä¼å¢å æ«æè¡æ°ã</span></li></ol><h2><a name="å°ç»-n522" class="md-header-anchor"></a><span>å°ç»</span></h2><p><img src="Mysql 45è®².assets/image-20201110172225966.png" referrerpolicy="no-referrer" alt="image-20201110172225966"></p><h2><a name="é®é¢-n524" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201111101524631.png" referrerpolicy="no-referrer" alt="image-20201111101524631"></p><p><img src="Mysql 45è®².assets/image-20201111140016559.png" referrerpolicy="no-referrer" alt="image-20201111140016559"></p><h1><a name="12--ä¸ºä»ä¹æçmysqlä¼æä¸ä¸" class="md-header-anchor"></a><span>12 | ä¸ºä»ä¹æçMySQLä¼âæâä¸ä¸ï¼</span></h1><p><span>ä¸æ¡SQLè¯­å¥ï¼æ­£å¸¸æ§è¡çæ¶åç¹å«å¿«ï¼ä½ æ¯ææ¶ä¹ä¸ç¥éæä¹åäºï¼å®å°±ä¼åå¾ç¹å«æ¢</span></p><h2><a name="ä½ çsqlè¯­å¥ä¸ºä»ä¹åæ¢äº" class="md-header-anchor"></a><span>ä½ çSQLè¯­å¥ä¸ºä»ä¹åâæ¢âäº</span></h2><ul><li><span>å½åå­</span><strong><span>æ°æ®é¡µ</span></strong><span>è·</span><strong><span>ç£çæ°æ®é¡µ</span></strong><span>åå®¹ä¸ä¸è´çæ¶åï¼æä»¬ç§°è¿ä¸ªåå­é¡µä¸ºâ</span><strong><span>èé¡µ</span></strong><span>âã</span></li><li><span>åå­æ°æ®å å¥å°ç£çåï¼åå­åç£çä¸çæ°æ®é¡µçåå®¹å°±ä¸è´äºï¼ç§°ä¸ºâ</span><strong><span>å¹²åé¡µ</span></strong><span>â</span></li></ul><p><span>å¹³æ¶æ§è¡å¾å¿«çæ´æ°æä½ï¼å¶å®å°±æ¯å¨ååå­åæ¥å¿ï¼è MySQLå¶å°âæâä¸ä¸çé£ä¸ªç¬é´ï¼å¯è½å°±æ¯å¨å·èé¡µï¼flushï¼ã</span></p><h2><a name="4ç§æåµä¼å¼åæ°æ®åºçflushè¿ç¨å¢" class="md-header-anchor"></a><span>4ç§æåµä¼å¼åæ°æ®åºçflushè¿ç¨å¢ï¼</span></h2><ul><li><span>æ¯InnoDBçredo logåæ»¡äº,åæ­¢æææ´æ°æä½ï¼æ checkpointå¾åæ¨è¿ï¼redo logçåºç©ºé´å¯ä»¥ç»§ç»­åã</span></li></ul><p><img src="Mysql 45è®².assets/image-20201111102304253.png" referrerpolicy="no-referrer" alt="image-20201111102304253"></p><ul><li><span>æ¯ç³»ç»åå­ä¸è¶³,èåå­ä¸å¤ç¨çæ¶åï¼å°±è¦æ·æ±° ä¸äºæ°æ®é¡µï¼ç©ºåºåå­ç»å«çæ°æ®é¡µä½¿ç¨ãå¦ææ·æ±°çæ¯âèé¡µâï¼å°±è¦åå°èé¡µåå°ç£çã</span></li></ul><p><span>è¿æ¶åé¾éä¸è½ç´æ¥æåå­æ·æ±°æï¼ä¸æ¬¡éè¦è¯·æ±çæ¶åï¼ä»ç£çè¯»å¥æ°æ® é¡µï¼ç¶åæ¿redo logåºæ¥åºç¨ä¸å°±è¡äºï¼</span></p><p><span>è¿éå¶å®æ¯ä»æ§è½èèçãå¦æå·èé¡µä¸å®ä¼åçï¼ å°±ä¿è¯äºæ¯ä¸ªæ°æ®é¡µæä¸¤ç§ç¶æï¼</span></p><p><img src="Mysql 45è®².assets/image-20201111102812874.png" referrerpolicy="no-referrer" alt="image-20201111102812874"></p><ul><li><span>ç¬¬ä¸ç§åºæ¯æ¯ï¼çæä¸å¿çæ¶åï¼æèæçä¹åãè¿æ¶åæå°æ²¡äºï¼ææé²çä¹æ¯é²çï¼ä¸å¦æ´æ°è´¦æ¬ã</span></li><li><span>ç¬¬åç§åºæ¯, æ¯MySQLæ­£å¸¸å³é­çæåµãè¿æ¶åï¼MySQLä¼æåå­çèé¡µé½flushå°ç£ çä¸ï¼è¿æ ·ä¸æ¬¡MySQLå¯å¨çæ¶åï¼å°±å¯ä»¥ç´æ¥ä»ç£çä¸è¯»æ°æ®ï¼å¯å¨éåº¦ä¼å¾å¿«ã</span></li></ul><h2><a name="åæä¸ä¸å-ä¸¤ç§åºæ¯ä¸çæ§è½é®é¢" class="md-header-anchor"></a><span>åæä¸ä¸å ä¸¤ç§åºæ¯ä¸çæ§è½é®é¢</span></h2><ul><li><p><span>ç¬¬ä¸ç§æ¯âredo logåæ»¡äºï¼è¦flushèé¡µâï¼è¿ç§æåµæ¯InnoDBè¦å°½éé¿åçãå ä¸ºåºç°è¿ç§æåµ çæ¶åï¼æ´ä¸ªç³»ç»å°±</span><strong><span>ä¸è½</span></strong><span>åæ¥å</span><strong><span>æ´æ°</span></strong><span>äºï¼ææçæ´æ°é½å¿é¡»å µä½ãå¦æä½ ä»çæ§ä¸çï¼è¿æ¶åæ´æ°æ°ä¼è·ä¸º0ã</span></p></li><li><p><span>ç¬¬äºç§æ¯âåå­ä¸å¤ç¨äºï¼è¦åå°èé¡µåå°ç£çâï¼è¿ç§æåµå¶å®æ¯</span><strong><span>å¸¸æ</span></strong><span>ãInnoDBç¨ç¼å²æ±  ï¼buffer poolï¼ç®¡çåå­ï¼ç¼å²æ± ä¸­çåå­é¡µæä¸ç§ç¶æï¼</span></p><ul><li><span>ç¬¬ä¸ç§æ¯ï¼è¿æ²¡æä½¿ç¨çï¼</span></li><li><span>ç¬¬äºç§æ¯ï¼ä½¿ç¨äºå¹¶ä¸æ¯å¹²åé¡µï¼ </span></li><li><span>ç¬¬ä¸ç§æ¯ï¼ä½¿ç¨äºå¹¶ä¸æ¯èé¡µã</span></li></ul></li></ul><p><span>InnoDBçç­ç¥æ¯å°½éä½¿ç¨åå­ï¼å æ­¤å¯¹äºä¸ä¸ªé¿æ¶é´è¿è¡çåºæ¥è¯´ï¼æªè¢«ä½¿ç¨çé¡µé¢å¾å°ã</span></p><p><span>èå½è¦è¯»å¥çæ°æ®é¡µæ²¡æå¨åå­çæ¶åï¼å°±å¿é¡»å°ç¼å²æ± ä¸­ç³è¯·ä¸ä¸ªæ°æ®é¡µãè¿æ¶ååªè½æ</span><strong><span>æä¹ä¸ä½¿ç¨</span></strong><span>çæ°æ®é¡µä»åå­ä¸­æ·æ±°æï¼å¦æè¦æ·æ±°çæ¯ä¸ä¸ª</span><strong><span>å¹²åé¡µ</span></strong><span>ï¼å°±ç´æ¥éæ¾åºæ¥</span><strong><span>å¤ç¨</span></strong><span>ï¼ä½å¦ææ¯ </span><strong><span>èé¡µ</span></strong><span>å¢ï¼å°±å¿é¡»å°èé¡µå</span><strong><span>å·å°ç£ç</span></strong><span>ï¼åæå¹²åé¡µåæè½å¤ç¨ã </span></p><p><span>æä»¥ï¼å·èé¡µè½ç¶æ¯å¸¸æï¼ä½æ¯åºç°ä»¥ä¸è¿ä¸¤ç§æåµï¼é½æ¯ä¼ææ¾å½±åæ§è½çï¼</span></p><ol start='' ><li><span>ä¸ä¸ªæ¥è¯¢è¦æ·æ±°çèé¡µä¸ªæ°å¤ªå¤ï¼ä¼å¯¼è´æ¥è¯¢çååºæ¶é´ææ¾åé¿ï¼</span></li><li><span>æ¥å¿åæ»¡ï¼æ´æ°å¨é¨å µä½ï¼åæ§è½è·ä¸º0ï¼è¿ç§æåµå¯¹ææä¸å¡æ¥è¯´ï¼æ¯ä¸è½æ¥åçã</span></li></ol><h2><a name="innodbå·èé¡µçæ§å¶ç­ç¥" class="md-header-anchor"></a><span>InnoDBå·èé¡µçæ§å¶ç­ç¥</span></h2><p><span>InnoDBæå¨ä¸»æºç</span><strong><span>IOè½å</span></strong><span>ï¼è¿æ ·InnoDBæè½ç¥ééè¦å¨åå·èé¡µçæ¶ åï¼å¯ä»¥å·å¤å¿«ã</span></p><p><span>å°</span><code>innodb_io_capacity</code><span>è¿ä¸ªåæ°äºï¼æå»ºè®®ä½ è®¾ ç½®æç£çç</span><code>IOPS</code><span>ãç£ççIOPSå¯ä»¥éè¿fioè¿ä¸ªå·¥å·æ¥æµè¯ï¼</span></p><p><span>å ä¸ºæ²¡è½æ­£ç¡®å°è®¾ç½®innodb_io_capacityåæ°ï¼èå¯¼è´çæ§è½é®é¢ä¹æ¯æ¯çæ¯ã</span><strong><span>MySQLçåå¥éåº¦å¾æ¢ï¼TPSå¾ä½ï¼</span></strong><span>å·èé¡µå·å¾ç¹å«æ¢,çè³æ¯èé¡µçæçéåº¦è¿æ¢ï¼è¿æ ·å°±é æäºèé¡µ ç´¯ç§¯ï¼å½±åäºæ¥è¯¢åæ´æ°æ§è½ã</span></p><h2><a name="æ»ä¸è½ä¸ç´æ¯å¨åå·å§" class="md-header-anchor"></a><span>æ»ä¸è½ä¸ç´æ¯å¨åå·å§ï¼</span></h2><p><span>è½ç¶æä»¬ç°å¨å·²ç»å®ä¹äºâå¨åå·èé¡µâçè¡ä¸ºï¼ä½å¹³æ¶æ»ä¸è½ä¸ç´æ¯å¨åå·å§ï¼æä»¬å°±ä¸èµ·ççInnoDBæä¹æ§å¶å¼ææ ç§âå¨åâçç¾åæ¯æ¥å·èé¡µã</span></p><p><span>è®¾è®¡ç­ç¥æ§å¶å·èé¡µçéåº¦ï¼ä¼åèåªäºå  ç´ å¢ï¼</span></p><p><span>å¦æå·å¤ªæ¢ï¼ä¼åºç°ä»ä¹æåµï¼é¦åæ¯åå­èé¡µå¤ªå¤ï¼å¶æ¬¡æ¯redo logåæ»¡ã</span></p><p><span>InnoDBçå·çéåº¦å°±æ¯è¦åèè¿ä¸¤ä¸ªå ç´ ï¼ä¸ä¸ªæ¯</span><strong><span>èé¡µæ¯ä¾</span></strong><span>ï¼ä¸ä¸ªæ¯redo log</span><strong><span>åç</span></strong><span>éåº¦ã</span></p><ul><li><span>innodb_io_capacityèé¡µæ¯ä¾ä¸éï¼é»è®¤å¼æ¯75%ã%ãInnoDBä¼æ ¹æ®å½åçèé¡µ æ¯ä¾ï¼åè®¾ä¸ºMï¼</span></li><li><span>InnoDBæ¯æ¬¡åå¥çæ¥å¿é½æä¸ä¸ªåºå·ï¼å½ååå¥çåºå·è·checkpointå¯¹åºçåºå·ä¹é´çå·®å¼ï¼ æä»¬åè®¾ä¸ºN</span></li></ul><p><img src="Mysql 45è®².assets/image-20201111112811100.png" referrerpolicy="no-referrer" alt="image-20201111112811100"></p><p><img src="Mysql 45è®².assets/image-20201111114427748.png" referrerpolicy="no-referrer" alt="image-20201111114427748"></p><h2><a name="å°ç»-n589" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>æå»¶ç»­ç¬¬2ç¯ä¸­ä»ç»çWALçæ¦å¿µï¼åä½ è§£éäºè¿ä¸ªæºå¶åç»­éè¦çå·èé¡µæä½åæ§è¡æ¶æºãå©ç¨WALææ¯ï¼</span><strong><span>æ°æ®åºå°éæºåè½¬æ¢æäºé¡ºåºå</span></strong><span>ï¼å¤§å¤§æåäºæ°æ®åºçæ§è½ã</span></p><p><span>ä½æ¯ï¼ç±æ­¤ä¹å¸¦æ¥äºåå­èé¡µçé®é¢ãèé¡µä¼è¢«åå°çº¿ç¨èªå¨flushï¼ä¹ä¼ç±äºæ°æ®é¡µæ·æ±°èè§¦ åflushï¼èå·èé¡µçè¿ç¨ç±äºä¼å ç¨èµæºï¼å¯è½ä¼è®©ä½ çæ´æ°åæ¥è¯¢è¯­å¥çååºæ¶é´é¿ä¸äºã å¨æç« éï¼æä¹ç»ä½ ä»ç»äºæ§å¶å·èé¡µçæ¹æ³åå¯¹åºççæ§æ¹å¼ã</span></p><h2><a name="é®é¢-n592" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201111135510527.png" referrerpolicy="no-referrer" alt="image-20201111135510527"></p><p><span>è¿æ¶åç³»ç»ä¸å¾ä¸åæ­¢æææ´æ°ï¼å»æ¨è¿checkpointã è¿æ¶ï¼ä½ çå°çç°è±¡å°±æ¯ç£çååå¾å°ï¼ä½æ¯æ°æ®åºåºç°é´æ­æ§çæ§è½ä¸è·ã</span></p><p><img src="Mysql 45è®².assets/image-20201111144413368.png" referrerpolicy="no-referrer" alt="image-20201111144413368"></p><h1><a name="13--ä¸ºä»ä¹è¡¨æ°æ®å æä¸åè¡¨æä»¶å¤§å°ä¸å" class="md-header-anchor"></a><span>13 | ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸åï¼</span></h1><p><span>è¡¨ç»ææ¯å­å¨ä»¥.frmä¸ºåç¼çæä»¶éï¼MySQL 8.0çæ¬ï¼åå·²ç»åè®¸æè¡¨ç»æå®ä¹æ¾å¨ç³»ç»æ°æ®è¡¨ä¸­äºãè¡¨æ°æ®æ¢å¯ä»¥å­å¨å±äº«è¡¨ç©ºé´éï¼ä¹å¯ä»¥æ¯åç¬çæä»¶ãè¿ä¸ªè¡ä¸ºæ¯ç±åæ° </span><code>innodb_file_per_table</code><span>æ§å¶çï¼</span></p><p><img src="Mysql 45è®².assets/image-20201111140250516.png" referrerpolicy="no-referrer" alt="image-20201111140250516"></p><p><span>éè¿</span><code>drop table</code><span>å½ä»¤ï¼ç³»ç»å°±ä¼ç´æ¥</span><strong><span>å é¤è¿ä¸ªæ ä»¶</span></strong><span>ãèå¦ææ¯æ¾å¨å±äº«è¡¨ç©ºé´ä¸­ï¼å³ä½¿è¡¨å æäºï¼ç©ºé´ä¹æ¯ä¸ä¼åæ¶çã</span></p><h2><a name="æ°æ®å é¤æµç¨" class="md-header-anchor"></a><span>æ°æ®å é¤æµç¨</span></h2><p><img src="Mysql 45è®².assets/image-20201111140357517.png" referrerpolicy="no-referrer" alt="image-20201111140357517"></p><p><span>æä»¬è¦å æR4è¿ä¸ªè®°å½ï¼InnoDBå¼æåªä¼æR4è¿ä¸ªè®°å½</span><strong><span>æ è®°ä¸ºå é¤</span></strong><span>ã</span></p><p><span>åè®¾ï¼æä»¬è¦å æR4è¿ä¸ªè®°å½ï¼InnoDBå¼æåªä¼æR4è¿ä¸ªè®°å½æ è®°ä¸ºå é¤ãå¦æä¹åè¦åæå¥ ä¸ä¸ªIDå¨300å600ä¹é´çè®°å½æ¶ï¼å¯è½ä¼</span><strong><span>å¤ç¨è¿ä¸ªä½ç½®</span></strong><span>ã</span></p><p><span>å¦ææä»¬å æäºä¸ä¸ªæ°æ®é¡µä¸çææè®° å½ï¼æ´ä¸ªæ°æ®é¡µå°±å¯ä»¥è¢«å¤ç¨äº</span></p><p><strong><span>æ°æ®é¡µçå¤ç¨è·è®°å½çå¤ç¨æ¯ä¸åçã</span></strong></p><p><img src="Mysql 45è®².assets/image-20201111140626209.png" referrerpolicy="no-referrer" alt="image-20201111140626209"></p><p><span>ç¨deleteå½ä»¤ææ´ä¸ªè¡¨çæ°æ®å é¤å¢ï¼ç»æå°±æ¯ï¼ææçæ°æ®é¡µé½ä¼è¢«æ è®° ä¸ºå¯å¤ç¨ãä½æ¯ç£çä¸ï¼æä»¶ä¸ä¼åå°ã</span></p><p><span>ä¸æ­¢æ¯å é¤æ°æ®ä¼é æç©ºæ´ï¼</span><strong><span>æå¥æ°æ®ä¹ä¼</span></strong></p><p><span>å¦ææ°æ®æ¯æç§ç´¢å¼éå¢é¡ºåºæå¥çï¼é£ä¹ç´¢å¼æ¯ç´§åçãä½å¦ææ°æ®æ¯éæºæå¥çï¼å°±å¯è½é  æç´¢å¼ç</span><strong><span>æ°æ®é¡µåè£</span></strong><span>ã</span></p><p><img src="Mysql 45è®².assets/image-20201111140732990.png" referrerpolicy="no-referrer" alt="image-20201111140732990"></p><p><span>é¡µåè£å®æåï¼page Açæ«å°¾å°±çä¸äºç©ºæ´ï¼æ³¨æï¼å®éä¸ï¼å¯è½ä¸æ­¢1 ä¸ªè®°å½çä½ç½®æ¯ç©ºæ´ï¼ã</span></p><p><strong><span>ç»è¿å¤§éå¢å æ¹çè¡¨ï¼é½æ¯å¯è½æ¯å­å¨ç©ºæ´ç</span></strong></p><p><span>èéå»ºè¡¨ï¼å°±å¯ä»¥è¾¾å°è¿æ ·çç®çã</span></p><h2><a name="éå»ºè¡¨" class="md-header-anchor"></a><span>éå»ºè¡¨</span></h2><p><code>alter table A engine=InnoDB</code><span>å½ä»¤æ¥éå»ºè¡¨,MySQLä¼èª å¨å®æè½¬å­æ°æ®ãäº¤æ¢è¡¨åãå é¤æ§è¡¨çæä½ã</span></p><p><img src="Mysql 45è®².assets/image-20201111141439410.png" referrerpolicy="no-referrer" alt="image-20201111141439410"></p><p><span>å¨è¿ä¸ªè¿ç¨ä¸­ï¼ææ°çæ°æ®è¦åå¥å° è¡¨Açè¯ï¼å°±ä¼é ææ°æ®ä¸¢å¤±ãå æ­¤ï¼å¨æ´ä¸ªDDLè¿ç¨ä¸­ï¼è¡¨Aä¸­</span><strong><span>ä¸è½ææ´æ°</span></strong><span>ãä¹å°±æ¯è¯´ï¼è¿ä¸ª DDLä¸æ¯Onlineçã</span></p><h2><a name="mysql-56å¼å¥çonline-ddl" class="md-header-anchor"></a><span>MySQL 5.6å¼å¥çOnline DDL</span></h2><p><img src="Mysql 45è®².assets/image-20201111142141644.png" referrerpolicy="no-referrer" alt="image-20201111142141644"></p><p><img src="Mysql 45è®².assets/image-20201111142151448.png" referrerpolicy="no-referrer" alt="image-20201111142151448"></p><p><span>alterè¯­å¥å¨å¯å¨çæ¶åéè¦è·åMDL</span><strong><span>åé</span></strong><span>ï¼ä½æ¯è¿ä¸ªåéå¨çæ­£æ·è´æ°æ® ä¹åå°±éåæ</span><strong><span>è¯»é</span></strong><span>äºã</span></p><p><span>ä¸ºä»ä¹è¦éåå¢ï¼ä¸ºäºå®ç°Onlineï¼MDLè¯»éä¸ä¼é»å¡å¢å æ¹æä½ã </span></p><p><span>é£ä¸ºä»ä¹ä¸å¹²èç´æ¥è§£éå¢ï¼ä¸ºäºä¿æ¤èªå·±ï¼ç¦æ­¢å¶ä»çº¿ç¨å¯¹è¿ä¸ªè¡¨åæ¶åDDLã</span></p><p><span>ä¸è¿°çè¿äºéå»ºæ¹æ³é½ä¼æ«æåè¡¨æ°æ®åæå»ºä¸´æ¶æä»¶ãå¯¹äºå¾å¤§çè¡¨æ¥ è¯´ï¼è¿ä¸ªæä½æ¯å¾</span><strong><span>æ¶èIOåCPUèµæº</span></strong><span>çã</span></p><p><span>å¦ææ³è¦æ¯è¾å®å¨çæä½çè¯ï¼ææ¨èä½ ä½¿ç¨GitHubå¼æºçgh-ostæ¥å</span></p><h2><a name="online-å-inplace" class="md-header-anchor"></a><span>Online å inplace</span></h2><p><span>æä»¬æè¡¨Aä¸­çæ°æ®å¯¼åºæ¥çå­æ¾ä½ç½®å«ä½tmp_tableãè¿æ¯ä¸ä¸ªä¸´ æ¶è¡¨ï¼æ¯å¨</span><strong><span>serverå±</span></strong><span>åå»ºçã</span></p><p><span>æ ¹æ®è¡¨Aéå»ºåºæ¥çæ°æ®æ¯æ¾å¨âtmp_fileâéçï¼è¿ä¸ªä¸´æ¶æä»¶æ¯InnoDBå¨</span><strong><span>åé¨åå»ºåº</span></strong><span> æ¥çãæ´ä¸ªDDLè¿ç¨é½å¨InnoDBåé¨å®æããå¯¹äºserverå±æ¥è¯´ï¼æ²¡æææ°æ®æªå¨å°ä¸´æ¶è¡¨ï¼æ¯ ä¸ä¸ªâ</span><strong><span>åå°</span></strong><span>âæä½ï¼è¿å°±æ¯âinplaceâåç§°çæ¥æºã</span></p><p><span>æä»¥ï¼æç°å¨é®ä½ ï¼å¦æä½ æä¸ä¸ª1TBçè¡¨ï¼ç°å¨ç£çé´æ¯1.2TBï¼è½ä¸è½åä¸ä¸ªinplaceçDDL å¢ï¼ ç­æ¡æ¯</span><strong><span>ä¸è½</span></strong><span>ãå ä¸ºï¼tmp_fileä¹æ¯è¦å ç¨ä¸´æ¶ç©ºé´çã</span></p><p><span>alter table t engine=InnoDB,å¶å®éå«çæææ¯ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">alter table t engine=innodb,ALGORITHM=inplace;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>è·inplaceå¯¹åºçå°±æ¯æ·è´è¡¨çæ¹å¼äºï¼ç¨æ³æ¯ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">alter table t engine=innodb,ALGORITHM=copy;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>è¡¨ç¤ºçæ¯å¼ºå¶æ·è´è¡¨</span></p><p><span>è¦ç»InnoDBè¡¨çä¸ä¸ªå­æ®µå å¨æç´¢å¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">alter table t add FULLTEXT(field_name);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>è¿ä¸ªè¿ç¨æ¯inplaceçï¼ä½ä¼é»å¡å¢å æ¹æä½ï¼æ¯</span><strong><span>éOnline</span></strong><span>çã</span></p><p><span>å¦æè¯´è¿ä¸¤ä¸ªé»è¾ä¹é´çå³ç³»æ¯ä»ä¹çè¯ï¼å¯ä»¥æ¦æ¬ä¸ºï¼</span></p><ul><li><span>DDLè¿ç¨å¦ææ¯Onlineçï¼å°±ä¸å®æ¯inplaceç</span></li><li><span>åè¿æ¥æªå¿ï¼ä¹å°±æ¯è¯´inplaceçDDLï¼æå¯è½ä¸æ¯Onlineçãæªæ­¢å°MySQL 8.0ï¼æ·»å å¨æ ç´¢å¼ï¼FULLTEXTindexï¼åç©ºé´ç´¢å¼(SPATIAL index)å°±å±äºè¿ç§æåµã</span></li></ul><p><img src="Mysql 45è®².assets/image-20201111143213549.png" referrerpolicy="no-referrer" alt="image-20201111143213549"></p><h2><a name="å°ç»-n645" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>å¦æè¦æ¶ç¼©ä¸ä¸ªè¡¨ï¼åªæ¯deleteæè¡¨éé¢ä¸ç¨çæ°æ®çè¯ï¼è¡¨æä»¶çå¤§å°æ¯ ä¸ä¼åçï¼ä½ è¿è¦éè¿alter tableå½ä»¤éå»ºè¡¨ï¼æè½è¾¾å°è¡¨æä»¶åå°çç®çã</span></p><p><span>Online DDLçæ¹å¼æ¯å¯ä»¥èèå¨ä¸å¡ä½å³°æä½¿ç¨çï¼</span></p><h2><a name="é®é¢-n648" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>åè®¾ç°å¨æäººç¢°å°äºä¸ä¸ªâæ³è¦æ¶ç¼©è¡¨ç©ºé´ï¼ç»æéå¾å¶åâçæåµï¼çä¸å»æ¯è¿æ ·çï¼</span></p><p><img src="Mysql 45è®².assets/image-20201111144207949.png" referrerpolicy="no-referrer" alt="image-20201111144207949"></p><p><img src="Mysql 45è®².assets/image-20201111153309681.png" referrerpolicy="no-referrer" alt="image-20201111153309681"></p><h1><a name="14--countè¿ä¹æ¢æè¯¥æä¹å" class="md-header-anchor"></a><span>14 | count(*)è¿ä¹æ¢ï¼æè¯¥æä¹åï¼</span></h1><h2><a name="countçå®ç°æ¹å¼" class="md-header-anchor"></a><span>count(*)çå®ç°æ¹å¼</span></h2><ul><li><span>MyISAMå¼ææä¸ä¸ªè¡¨çæ»è¡æ°</span><strong><span>å­å¨</span></strong><span>äºç£çä¸ï¼å æ­¤æ§è¡count(*)çæ¶åä¼ç´æ¥è¿åè¿ä¸ªæ°ï¼ æçå¾é«ï¼</span></li><li><span>èInnoDBå¼æå°±éº»ç¦äºï¼å®æ§è¡count(*)çæ¶åï¼éè¦ææ°æ®ä¸è¡ä¸è¡å°ä»å¼æéé¢</span><strong><span>è¯»</span></strong><span>åº æ¥ï¼ç¶åç´¯ç§¯è®¡æ°ã</span></li></ul><p><span>å¦æå äºwhere æ¡ä»¶ çè¯ï¼MyISAMè¡¨ä¹æ¯ä¸è½è¿åå¾è¿ä¹å¿«çã</span></p><p><span>ä¸ºä»ä¹è¦ä½¿ç¨InnoDBï¼å ä¸ºä¸è®ºæ¯å¨äºå¡æ¯æãå¹¶åè½åè¿ æ¯å¨æ°æ®å®å¨æ¹é¢ï¼InnoDBé½ä¼äºMyISAMã</span></p><h2><a name="ä¸ºä»ä¹innodbä¸ä¹ææ°å­å­èµ·æ¥å¢" class="md-header-anchor"></a><span>ä¸ºä»ä¹InnoDBä¸ä¹ææ°å­å­èµ·æ¥å¢ï¼</span></h2><p><span>è¿æ¯å ä¸ºå³ä½¿æ¯å¨åä¸ä¸ªæ¶å»çå¤ä¸ªæ¥è¯¢ï¼ç±äºå¤çæ¬å¹¶åæ§å¶ï¼MVCCï¼çåå </span></p><p><span>åè®¾è¡¨tä¸­ç°å¨æ10000æ¡è®°å½ï¼æä»¬è®¾è®¡äºä¸ä¸ªç¨æ·å¹¶è¡çä¼è¯ã</span></p><p><img src="Mysql 45è®².assets/image-20201111151105979.png" referrerpolicy="no-referrer" alt="image-20201111151105979"></p><p><span>å¨ä»£ç ä¸å°±æ¯éè¿å¤çæ¬å¹¶å æ§å¶ï¼ä¹å°±æ¯MVCCæ¥å®ç°çãæ¯ä¸è¡è®°å½é½è¦å¤æ­èªå·±æ¯å¦å¯¹è¿ä¸ª</span><strong><span>ä¼è¯å¯è§</span></strong><span>ï¼å æ­¤å¯¹äº count(*)è¯·æ±æ¥è¯´ï¼InnoDBåªå¥½ææ°æ®ä¸è¡ä¸è¡å°è¯»åºä¾æ¬¡å¤æ­ï¼å¯è§çè¡æè½å¤ç¨äºè®¡ç®âåº äºè¿ä¸ªæ¥è¯¢âçè¡¨çæ»è¡æ°ã</span></p><p><span>ä¼åï¼</span></p><p><span>æ®éç´¢å¼æ æ¯ä¸»é®ç´¢å¼æ å°å¾å¤ãMySQLä¼åå¨ä¼æ¾å°æå°çé£æ£µæ æ¥éåã</span></p><p><span>å¨ä¿è¯é»è¾æ­£ ç¡®çåæä¸ï¼å°½éåå°æ«æçæ°æ®éï¼æ¯æ°æ®åºç³»ç»è®¾è®¡çéç¨æ³åä¹ä¸ã</span></p><p><span>TABLE_ROWSè½ ä»£æ¿count(*)åï¼</span></p><p><span>ç´¢å¼ç»è®¡çå¼ æ¯éè¿éæ ·æ¥</span><strong><span>ä¼°ç®ç</span></strong><span>ãå®éä¸ï¼TABLE_ROWSå°±æ¯ä»è¿ä¸ªéæ ·ä¼°ç®å¾æ¥çï¼å æ­¤å®ä¹å¾ä¸åã æå¤ä¸åå¢ï¼å®æ¹ææ¡£è¯´è¯¯å·®å¯è½è¾¾å°40%å°50%ã</span></p><ul><li><span>MyISAMè¡¨è½ç¶count(*)å¾å¿«ï¼ä½æ¯ä¸æ¯æäºå¡ï¼ </span></li><li><em><span>showtable statuså½ä»¤è½ç¶è¿åå¾å¿«ï¼ä½æ¯ä¸åç¡®ï¼</span></em></li><li><em><span>InnoDBè¡¨ç´æ¥count(</span></em><span>)ä¼éåå¨è¡¨ï¼è½ç¶ç»æåç¡®ï¼ä½ä¼å¯¼è´æ§è½é®é¢ã</span></li></ul><h2><a name="ç¨ç¼å­ç³»ç»ä¿å­è®¡æ°" class="md-header-anchor"></a><span>ç¨ç¼å­ç³»ç»ä¿å­è®¡æ°</span></h2><p><span>ç¼å­ç³»ç»å¯è½ä¼ä¸¢å¤±æ´æ°ã</span></p><p><img src="Mysql 45è®².assets/image-20201111151812026.png" referrerpolicy="no-referrer" alt="image-20201111151812026"></p><p><img src="Mysql 45è®².assets/image-20201111151901972.png" referrerpolicy="no-referrer" alt="image-20201111151901972"></p><h2><a name="å¨æ°æ®åºä¿å­è®¡æ°" class="md-header-anchor"></a><span>å¨æ°æ®åºä¿å­è®¡æ°</span></h2><p><span>è®¡æ°ç´æ¥æ¾å°æ°æ®åºéåç¬çä¸å¼ è®¡æ°è¡¨Cä¸­</span></p><p><span>è¿è§£å³äºå´©æºä¸¢å¤±çé®é¢ï¼InnoDBæ¯æ¯æå´©æºæ¢å¤ä¸ä¸¢æ°æ®çã</span></p><p><span>äºInnoDBè¦æ¯æäºå¡</span></p><h2><a name="ä¸åçcountç¨æ³" class="md-header-anchor"></a><span>ä¸åçcountç¨æ³</span></h2><p><img src="Mysql 45è®².assets/image-20201111152124209.png" referrerpolicy="no-referrer" alt="image-20201111152124209"></p><p><img src="Mysql 45è®².assets/image-20201111152241472.png" referrerpolicy="no-referrer" alt="image-20201111152241472"></p><p><img src="Mysql 45è®².assets/image-20201111152424096.png" referrerpolicy="no-referrer" alt="image-20201111152424096"></p><p><img src="Mysql 45è®².assets/image-20201111152459723.png" referrerpolicy="no-referrer" alt="image-20201111152459723"></p><p><span>count(å­æ®µ)&lt;count(ä¸»é®id)&lt;count(1)âcount(*)</span></p><h2><a name="é®é¢-n692" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201113094643767.png" referrerpolicy="no-referrer" alt="image-20201113094643767"></p><p><span>ä»å¹¶åç³»ç»æ§è½çè§åº¦ èèï¼ä½ è§å¾å¨è¿ä¸ªäºå¡åºåéï¼åºè¯¥åæå¥æä½è®°å½ï¼è¿æ¯åºè¯¥åæ´æ°è®¡æ°è¡¨å¢ï¼</span></p><p><span>å ä¸ºæ´æ°è®¡æ°è¡¨æ¶åå°è¡éçç«äºï¼åæå¥åæ´æ°è½æå¤§ç¨åº¦å°åå°äºå¡ä¹é´çéç­å¾ï¼æå å¹¶ååº¦</span></p><p>&nbsp;</p><h1><a name="15--ç­çæç« ä¸ï¼æ¥å¿åç´¢å¼ç¸å³é®é¢" class="md-header-anchor"></a><span>15 | ç­çæç« ï¼ä¸ï¼ï¼æ¥å¿åç´¢å¼ç¸å³é®é¢</span></h1><h2><a name="æ¥å¿ç¸å³é®é¢" class="md-header-anchor"></a><span>æ¥å¿ç¸å³é®é¢</span></h2><h3><a name="å¨ä¸¤é¶æ®µæäº¤çä¸åç¬é´mysqlå¦æåçå¼å¸¸éå¯æ¯æ-ä¹ä¿è¯æ°æ®å®æ´æ§ç" class="md-header-anchor"></a><span>å¨ä¸¤é¶æ®µæäº¤çä¸åç¬é´ï¼MySQLå¦æåçå¼å¸¸éå¯ï¼æ¯æ ä¹ä¿è¯æ°æ®å®æ´æ§çï¼</span></h3><p><img src="Mysql 45è®².assets/image-20201111161936542.png" referrerpolicy="no-referrer" alt="image-20201111161936542"></p><p><span>ä¸¤ä¸ªâcommitâçæ¦å¿µï¼</span></p><ul><li><span>ä»è¯´çâcommitè¯­å¥âï¼æ¯æMySQLè¯­æ³ä¸­ï¼ç¨äºæäº¤ä¸ä¸ªäºå¡çå½ä»¤ãä¸è¬è·begin/start transaction éå¯¹ä½¿ç¨ã </span></li><li><span>èæä»¬å¾ä¸­ç¨å°çè¿ä¸ªâcommitæ­¥éª¤âï¼æçæ¯äºå¡æäº¤è¿ç¨ä¸­çä¸ä¸ªå°æ­¥éª¤ï¼ä¹æ¯æåä¸ æ­¥ãå½è¿ä¸ªæ­¥éª¤æ§è¡å®æåï¼è¿ä¸ªäºå¡å°±æäº¤å®æäºã </span></li><li><span>âcommitè¯­å¥âæ§è¡çæ¶åï¼ä¼</span><strong><span>åå«</span></strong><span>âcommit æ­¥éª¤âã</span></li></ul><p><span>å´©æºæ¢å¤æ¶çå¤æ­è§å</span></p><ol start='' ><li><p><span>å¦æredo logéé¢çäºå¡æ¯å®æ´çï¼ä¹å°±æ¯å·²ç»æäºcommitæ è¯ï¼åç´æ¥æäº¤ï¼</span></p></li><li><p><span>å¦æredo logéé¢çäºå¡åªæå®æ´çprepareï¼åå¤æ­å¯¹åºçäºå¡binlogæ¯å¦å­å¨å¹¶å®æ´ï¼ </span></p><p><span>a. å¦ææ¯ï¼åæäº¤äºå¡ï¼ </span></p><p><span>b. å¦åï¼åæ»äºå¡ã</span></p></li></ol><h3><a name="mysqlæä¹ç¥ébinlogæ¯å®æ´ç" class="md-header-anchor"></a><span>MySQLæä¹ç¥ébinlogæ¯å®æ´ç?</span></h3><ul><li><span>statementæ ¼å¼çbinlogï¼æåä¼æCOMMITï¼</span></li><li><span>rowæ ¼å¼çbinlogï¼æåä¼æä¸ä¸ªXID eventã</span></li></ul><h3><a name="redo-log-å-binlogæ¯æä¹å³èèµ·æ¥ç" class="md-header-anchor"></a><span>redo log å binlogæ¯æä¹å³èèµ·æ¥ç?</span></h3><p><span>å®ä»¬æä¸ä¸ªå±åçæ°æ®å­æ®µï¼å«XIDãå´©æºæ¢å¤çæ¶åï¼ä¼æé¡ºåºæ«æredo logï¼</span></p><ul><li><span>å¦æç¢°å°æ¢æprepareãåæcommitçredo logï¼å°±ç´æ¥æäº¤ï¼</span></li><li><span>å¦æç¢°å°åªæparepareãèæ²¡æcommitçredo logï¼å°±æ¿çXIDå»binlogæ¾å¯¹åºçäºå¡ã</span></li></ul><h3><a name="å¤äºprepareé¶æ®µçredo-logå ä¸å®æ´binlogéå¯å°±è½æ¢å¤ä¸ºä»ä¹è¦è¿ä¹è®¾è®¡" class="md-header-anchor"></a><span>å¤äºprepareé¶æ®µçredo logå ä¸å®æ´binlogï¼éå¯å°±è½æ¢å¤ï¼ä¸ºä»ä¹è¦è¿ä¹è®¾è®¡?</span></h3><p><span>ç»äºä¸å¼ ç¤ºæå¾ï¼è¿éå°±æ²¡æredo logäºã</span></p><p><img src="Mysql 45è®².assets/image-20201111172357435.png" referrerpolicy="no-referrer" alt="image-20201111172357435"></p><p><img src="Mysql 45è®².assets/image-20201111172419909.png" referrerpolicy="no-referrer" alt="image-20201111172419909"></p><h3><a name="é£è½ä¸è½åè¿æ¥åªç¨redo-logä¸è¦binlog" class="md-header-anchor"></a><span>é£è½ä¸è½åè¿æ¥ï¼åªç¨redo logï¼ä¸è¦binlogï¼</span></h3><p><span>ä¸ä¸ªæ¯å½æ¡£ãredo logæ¯å¾ªç¯åï¼åå°æ«å°¾æ¯è¦åå°å¼å¤´ç»§ç»­åçãè¿æ ·åå²æ¥å¿æ²¡æ³ä¿ çï¼redo logä¹å°±èµ·ä¸å°å½æ¡£çä½ç¨ã</span></p><p><span>MySQLç³»ç»é«å¯ç¨çåºç¡ï¼å°±æ¯binlogå¤å¶ã</span></p><p><span>æå¼æç³»ç»ï¼è¿äºç³»ç»å°±é æ¶è´¹MySQLçbinlogæ¥æ´æ° èªå·±çæ°æ®ãå³æbinlogçè¯ï¼è¿äºä¸æ¸¸ç³»ç»å°±æ²¡æ³è¾å¥äºã</span></p><p><span>æ¬MySQLé«å¯ç¨å¨åçå¾å¤ç³»ç»æºå¶é½ä¾èµäºbinlogï¼æä»¥âé¸ å é¹å·¢âredo logè¿åä¸å°ã</span></p><h3><a name="redo-logä¸è¬è®¾ç½®å¤å¤§" class="md-header-anchor"></a><span>redo logä¸è¬è®¾ç½®å¤å¤§ï¼</span></h3><p><span>æä»¥ï¼å¦ææ¯ç°å¨å¸¸è§çå ä¸ªTBçç£ççè¯ï¼å°±ä¸è¦å¤ªå°æ°äºï¼ç´æ¥å°redo logè®¾ç½®ä¸º4ä¸ªæ ä»¶ãæ¯ä¸ªæä»¶1GBå§ã</span></p><h3><a name="æ­£å¸¸è¿è¡ä¸­çå®ä¾æ°æ®åå¥åçæç»è½çæ¯ä»redo-logæ´æ°è¿æ¥ç-è¿æ¯ä»buffer-poolæ´æ°è¿æ¥çå¢" class="md-header-anchor"></a><span>æ­£å¸¸è¿è¡ä¸­çå®ä¾ï¼æ°æ®åå¥åçæç»è½çï¼æ¯ä»redo logæ´æ°è¿æ¥ç è¿æ¯ä»buffer poolæ´æ°è¿æ¥çå¢ï¼</span></h3><p><img src="Mysql 45è®².assets/image-20201113092717264.png" referrerpolicy="no-referrer" alt="image-20201113092717264"></p><h2><a name="redo-log-bufferæ¯ä»ä¹æ¯åä¿®æ¹åå­è¿æ¯ååredo-logæä»¶" class="md-header-anchor"></a><span>redo log bufferæ¯ä»ä¹ï¼æ¯åä¿®æ¹åå­ï¼è¿æ¯ååredo logæä»¶ï¼</span></h2><p><span>çæçæ¥å¿é½å¾åä¿å­èµ·æ¥ï¼ä½åä¸è½å¨ è¿æ²¡commitçæ¶åå°±ç´æ¥åå°redo logæä»¶éã æä»¥ï¼</span><code>redo log buffer</code><span>å°±æ¯ä¸ååå­ï¼ç¨æ¥åå­redoæ¥å¿çã</span></p><p><span>ä¹å°±æ¯è¯´ï¼å¨æ§è¡ç¬¬ä¸ä¸ªinsertçæ¶ åï¼æ°æ®çåå­è¢«ä¿®æ¹äºï¼redo log bufferä¹åå¥äºæ¥å¿ã ä½æ¯ï¼çæ­£ææ¥å¿åå°redo logæä»¶ï¼æä»¶åæ¯ ib_logfile+æ°å­ï¼ï¼æ¯å¨æ§è¡</span><code>commitè¯­å¥</code><span>çæ¶å åçã</span></p><h2><a name="é®é¢-n746" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201113094906258.png" referrerpolicy="no-referrer" alt="image-20201113094906258"></p><p><img src="Mysql 45è®².assets/image-20201113094922992.png" referrerpolicy="no-referrer" alt="image-20201113094922992"></p><p><span>éé¡¹3ï¼å³ï¼InnoDBè®¤çæ§è¡äºâæè¿ä¸ªå¼ä¿®æ¹æ(1,2)&quot;è¿ä¸ª æä½ï¼è¯¥å éçå éï¼è¯¥æ´æ°çæ´æ°ã</span></p><p><img src="Mysql 45è®².assets/image-20201113111522765.png" referrerpolicy="no-referrer" alt="image-20201113111522765"></p><p><img src="Mysql 45è®².assets/image-20201113111544883.png" referrerpolicy="no-referrer" alt="image-20201113111544883"></p><p><span>MySQLè®¤ä¸ºè¯»åºæ¥çå¼ï¼åªæä¸ä¸ªç¡®å®ç (id=1), èè¦åçæ¯(a=3)ï¼åªä»è¿ä¸¤ä¸ªä¿¡æ¯æ¯çä¸åºæ¥âä¸éè¦ä¿®æ¹âçã</span></p><p><img src="Mysql 45è®².assets/image-20201113111504129.png" referrerpolicy="no-referrer" alt="image-20201113111504129"></p><p><span>ä¸é¢æä»¬çéªè¯ç»æé½æ¯å¨binlog_format=statementæ ¼å¼ä¸è¿è¡çã</span></p><h1><a name="16--order-byæ¯æä¹å·¥ä½ç" class="md-header-anchor"></a><span>16 | âorder byâæ¯æä¹å·¥ä½çï¼</span></h1><p><span>åè®¾ä½ è¦æ¥è¯¢åå¸æ¯âæ­å·âçææäººåå­ï¼å¹¶ä¸æç§å§åæåºè¿å å1000ä¸ªäººçå§åãå¹´é¾ã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`t`</span> ( </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) NOTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`city`</span> <span class="cm-builtin">varchar</span>(<span class="cm-number">16</span>) NOTNULL, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`name`</span> <span class="cm-builtin">varchar</span>(<span class="cm-number">16</span>) NOTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`age`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) NOTNULL, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`addr`</span> <span class="cm-builtin">varchar</span>(<span class="cm-number">128</span>) DEFAULTNULL, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">KEY</span> <span class="cm-variable-2">`city`</span> (<span class="cm-variable-2">`city`</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><p><span>å¯ä»¥è¿ä¹å</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">select city,name,age from t where city='æ­å·' order by name limit 1000 ;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><h2><a name="å¨å­æ®µæåº" class="md-header-anchor"></a><span>å¨å­æ®µæåº</span></h2><p><img src="Mysql 45è®².assets/image-20201113100633369.png" referrerpolicy="no-referrer" alt="image-20201113100633369"></p><p><span>Extraè¿ä¸ªå­æ®µä¸­çâUsing filesortâè¡¨ç¤ºçå°±æ¯éè¦æåºï¼MySQLä¼ç»æ¯ä¸ªçº¿ç¨åéä¸ååå­ç¨äº æåºï¼ç§°ä¸º</span><strong><span>sort_buffer</span></strong><span>ã</span></p><p><img src="Mysql 45è®².assets/image-20201113100705566.png" referrerpolicy="no-referrer" alt="image-20201113100705566"></p><p><span>è¯­å¥æ§è¡æµç¨ï¼</span></p><ol start='' ><li><p><span>åå§åsort_bufferï¼ç¡®å®æ¾å¥nameãcityãageè¿ä¸ä¸ªå­æ®µï¼ </span></p></li><li><p><span>ä»ç´¢å¼cityæ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³city=&#39;æ­å·âæ¡ä»¶çä¸»é®idï¼ä¹å°±æ¯å¾ä¸­çID_Xï¼ </span></p></li><li><p><span>å°ä¸»é®idç´¢å¼ååºæ´è¡ï¼ånameãcityãageä¸ä¸ªå­æ®µçå¼ï¼å­å¥sort_bufferä¸­ï¼</span></p></li><li><p><span>ä»ç´¢å¼cityåä¸ä¸ä¸ªè®°å½çä¸»é®idï¼ </span></p></li><li><p><span>éå¤æ­¥éª¤3ã4ç´å°cityçå¼ä¸æ»¡è¶³æ¥è¯¢æ¡ä»¶ä¸ºæ­¢ï¼å¯¹åºçä¸»é®idä¹å°±æ¯å¾ä¸­çID_Yï¼</span></p></li><li><p><span>å¯¹sort_bufferä¸­çæ°æ®æç§å­æ®µnameåå¿«éæåºï¼ </span></p></li><li><p><span>æç§æåºç»æåå1000è¡è¿åç»å®¢æ·ç«¯ã</span></p><p><img src="Mysql 45è®².assets/image-20201113101010113.png" referrerpolicy="no-referrer" alt="image-20201113101010113"></p></li></ol><p><strong><span>sort_buffer_size</span></strong><span>ï¼å°±æ¯MySQLä¸ºæåºå¼è¾çåå­ï¼sort_bufferï¼çå¤§å°ãå¦æè¦æåºçæ°æ®é å°äºsort_buffer_sizeï¼æåºå°±å¨åå­ä¸­å®æãä½å¦æ</span><strong><span>æåºæ°æ®éå¤ªå¤§</span></strong><span>ï¼åå­æ¾ä¸ä¸ï¼åä¸å¾ä¸å©ç¨</span><strong><span>ç£çä¸´æ¶æä»¶</span></strong><span>è¾å©æåºã</span></p><p><span>ä½ å¯ä»¥ç¨ä¸é¢ä»ç»çæ¹æ³ï¼æ¥ç¡®å®ä¸ä¸ªæåºè¯­å¥æ¯å¦ä½¿ç¨äºä¸´æ¶æä»¶ã</span></p><p><img src="Mysql 45è®².assets/image-20201113101819768.png" referrerpolicy="no-referrer" alt="image-20201113101819768"></p><p><img src="Mysql 45è®².assets/image-20201113101839973.png" referrerpolicy="no-referrer" alt="image-20201113101839973"></p><p><span>number_of_tmp_filesè¡¨ç¤ºçæ¯ï¼æåºè¿ç¨ä¸­ä½¿ç¨çä¸´æ¶æä»¶æ°</span></p><p><span>ç¨å½å¹¶æåºç®æ³ï¼MySQLå°éè¦æåºçæ°æ®åæ12ä»½ï¼æ¯ä¸ä»½åç¬æåºåå­å¨è¿äºä¸´æ¶æä»¶ä¸­ãç¶åæ è¿12ä¸ªæåºæä»¶ååå¹¶æä¸ä¸ªæåºçå¤§æä»¶</span></p><p><img src="Mysql 45è®².assets/image-20201113101932804.png" referrerpolicy="no-referrer" alt="image-20201113101932804"></p><h2><a name="rowidæåº" class="md-header-anchor"></a><span>rowidæåº</span></h2><p><img src="Mysql 45è®².assets/image-20201113102623739.png" referrerpolicy="no-referrer" alt="image-20201113102623739"></p><p><span>sort_bufferéé¢ è¦æ¾ç</span><strong><span>å­æ®µæ°å¤ªå¤</span></strong><span>ï¼è¿æ ·åå­éè½å¤åæ¶æ¾ä¸çè¡æ°å¾å°ï¼è¦åæå¾å¤ä¸ªä¸´æ¶æä»¶ï¼æåºçæ§è½ ä¼å¾å·®ã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SET</span> max_length_for_sort_data = <span class="cm-number">16</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>cityãnameãage è¿ä¸ä¸ªå­æ®µçå®ä¹æ»é¿åº¦æ¯36ï¼ææmax_length_for_sort_dataè®¾ç½®ä¸º16</span></p><p><img src="Mysql 45è®².assets/image-20201113102731506.png" referrerpolicy="no-referrer" alt="image-20201113102731506"></p><p><span>éè¦è¯´æçæ¯ï¼æåçâç»æéâæ¯ä¸ä¸ªé»è¾æ¦å¿µï¼å®éä¸MySQLæå¡ç«¯ä»æåºåçsort_bufferä¸­ ä¾æ¬¡ååºidï¼ç¶åå°åè¡¨æ¥å°cityãnameåageè¿ä¸ä¸ªå­æ®µçç»æï¼ä¸éè¦å¨æå¡ç«¯åèè´¹åå­ å­å¨ç»æï¼æ¯ç´æ¥è¿åç»å®¢æ·ç«¯çã</span></p><p><span>å¾ä¸­çexamined_rowsçå¼è¿æ¯4000ï¼è¡¨ç¤ºç¨äºæåºçæ°æ®æ¯4000è¡ãä½æ¯select @b- @aè¿ä¸ªè¯­å¥çå¼åæ5000äºã å ä¸ºè¿æ¶åé¤äºæåºè¿ç¨å¤ï¼å¨æåºå®æåï¼è¿è¦æ ¹æ®idå»åè¡¨åå¼ãç±äºè¯­å¥æ¯limit 1000ï¼å  æ­¤ä¼å¤è¯»1000è¡</span></p><p><img src="Mysql 45è®².assets/image-20201113103901176.png" referrerpolicy="no-referrer" alt="image-20201113103901176"></p><p><span>ä»OPTIMIZER_TRACEçç»æä¸­ï¼ä½ è¿è½çå°å¦å¤ä¸¤ä¸ªä¿¡æ¯ä¹åäº</span></p><ul><li><span>sort_modeåæäºï¼è¡¨ç¤ºåä¸æåºçåªænameåidè¿ä¸¤ä¸ªå­æ®µã</span></li><li><span>number_of_tmp_filesåæ10äºï¼æ¯å ä¸ºè¿æ¶ååä¸æåºçè¡æ°è½ç¶ä»ç¶æ¯4000è¡ï¼ä½æ¯æ¯ä¸ è¡é½åå°äºï¼å æ­¤éè¦æåºçæ»æ°æ®éå°±åå°äºï¼éè¦çä¸´æ¶æä»¶ä¹ç¸åºå°åå°äº</span></li></ul><h2><a name="å¨å­æ®µæåº-vs-rowidæåº" class="md-header-anchor"></a><span>å¨å­æ®µæåº VS rowidæåº</span></h2><p><strong><span>å¦æåå­å¤ï¼å°±è¦å¤å©ç¨åå­ï¼å°½éåå°ç£çè®¿é®ã</span></strong></p><p><span>å¯¹äºInnoDBè¡¨æ¥è¯´ï¼rowidæåºä¼è¦æ±åè¡¨å¤é æç£çè¯»ï¼å æ­¤ä¸ä¼è¢«ä¼åéæ©</span></p><p><span>å¹¶ä¸æ¯ææçorder byè¯­å¥ï¼é½éè¦æåºæä½çã</span></p><p><span>å¦æè½å¤ä¿è¯ä»cityè¿ä¸ªç´¢å¼ä¸ååºæ¥çè¡ï¼å¤©ç¶å°±æ¯æç§nameéå¢æåºçè¯å°±ä¸ç¨äºã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">alter table t add index city_user(city, name);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201113104545132.png" referrerpolicy="no-referrer" alt="image-20201113104545132"></p><p><img src="Mysql 45è®².assets/image-20201113104606473.png" referrerpolicy="no-referrer" alt="image-20201113104606473"></p><p><img src="Mysql 45è®².assets/image-20201113105114361.png" referrerpolicy="no-referrer" alt="image-20201113105114361"></p><p><span>Extraå­æ®µä¸­æ²¡æUsing filesortäºï¼è¯¢ä¹ä¸ç¨æ4000è¡å¨é½è¯»ä¸éï¼åªè¦æ¾å°æ»¡è¶³æ¡ä»¶çå 1000æ¡è®°å½å°±å¯ä»¥éåºäº</span></p><p><span>è¦çç´¢å¼æ¯æï¼ç´¢å¼ä¸çä¿¡æ¯è¶³å¤æ»¡è¶³æ¥è¯¢è¯·æ±ï¼ä¸éè¦å åå°ä¸»é®ç´¢å¼ä¸å»åæ°æ®ã</span></p><p><span>éå¯¹è¿ä¸ªæ¥è¯¢ï¼æä»¬å¯ä»¥åå»ºä¸ä¸ªcityãnameåageçèåç´¢å¼ï¼å¯¹åºçSQLè¯­å¥å°±æ¯ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">alter table t add index city_user_age(city, name, age);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201113110819017.png" referrerpolicy="no-referrer" alt="image-20201113110819017"></p><p><span>Extraå­æ®µéé¢å¤äºâUsing indexâï¼è¡¨ç¤ºçå°±æ¯ä½¿ç¨äºè¦çç´¢å¼ï¼æ§è½ä¸ä¼å¿«å¾å¤ã</span></p><h2><a name="é®é¢-n818" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201113111100462.png" referrerpolicy="no-referrer" alt="image-20201113111100462"></p><p><img src="Mysql 45è®².assets/image-20201113154349777.png" referrerpolicy="no-referrer" alt="image-20201113154349777"></p><h1><a name="17--å¦ä½æ­£ç¡®å°æ¾ç¤ºéæºæ¶æ¯" class="md-header-anchor"></a><span>17 | å¦ä½æ­£ç¡®å°æ¾ç¤ºéæºæ¶æ¯ï¼</span></h1><h2><a name="åå­ä¸´æ¶è¡¨" class="md-header-anchor"></a><span>åå­ä¸´æ¶è¡¨</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> word <span class="cm-keyword">from</span> words <span class="cm-keyword">order</span> <span class="cm-keyword">by</span> rand() <span class="cm-keyword">limit</span> <span class="cm-number">3</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201113141851787.png" referrerpolicy="no-referrer" alt="image-20201113141851787"></p><p><span>Using temporaryï¼è¡¨ç¤ºçæ¯éè¦ä½¿ç¨ä¸´æ¶è¡¨ï¼Using filesortï¼è¡¨ç¤ºçæ¯éè¦æ§è¡ æåºæä½ã</span></p><p><span>å¯¹äºInnoDBè¡¨æ¥è¯´ï¼æ§è¡</span><strong><span>å¨å­æ®µæåº</span></strong><span>ä¼åå°ç£çè®¿é®ï¼å æ­¤ä¼è¢«</span><strong><span>ä¼åéæ©</span></strong></p><p><span>å¯¹äºåå­è¡¨ï¼åè¡¨è¿ç¨åªæ¯ç®åå°æ ¹æ®æ°æ®è¡çä½ç½®ï¼ç´æ¥è®¿é®åå­å¾å°æ°æ®ï¼æ ¹æ¬ä¸ä¼å¯¼è´å¤è®¿é®ç£çãMySQLè¿æ¶å°±ä¼éæ©</span><strong><span>rowidæåº</span></strong></p><p><img src="Mysql 45è®².assets/image-20201113142302695.png" referrerpolicy="no-referrer" alt="image-20201113142302695"></p><p><img src="Mysql 45è®².assets/image-20201113142632031.png" referrerpolicy="no-referrer" alt="image-20201113142632031"></p><p><span>éè¿æ¢æ¥è¯¢æ¥å¿ï¼slowlogï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Query_time: 0.900376 Lock_time: 0.000347 Rows_sent: 3 Rows_examined: 20003</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">SET</span> <span class="cm-builtin">timestamp</span>=<span class="cm-number">1541402277</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> word <span class="cm-keyword">from</span> words <span class="cm-keyword">order</span> <span class="cm-keyword">by</span> rand() <span class="cm-keyword">limit</span> <span class="cm-number">3</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p><span>InnoDBè¡¨çä¸»é®å æãä¹InnoDBä¼èªå·±çæ ä¸ä¸ªé¿åº¦ä¸º6å­èçrowidæ¥ä½ä¸ºä¸»é®ã</span></p><p><strong><span>order by rand()ä½¿ç¨äºåå­ä¸´æ¶è¡¨ï¼åå­ä¸´æ¶è¡¨æåºçæ¶åä½¿ç¨äºrowidæåºæ¹æ³ã</span></strong></p><h2><a name="ç£çä¸´æ¶è¡¨" class="md-header-anchor"></a><span>ç£çä¸´æ¶è¡¨</span></h2><p><code>tmp_table_size</code><span>è¿ä¸ªéç½®éå¶äºåå­ä¸´æ¶è¡¨çå¤§å°ï¼é»è®¤å¼æ¯16Mãå¦æä¸´æ¶è¡¨å¤§ å°è¶è¿äºtmp_table_sizeï¼é£ä¹åå­ä¸´æ¶è¡¨å°±ä¼è½¬æç£çä¸´æ¶è¡¨ã</span></p><p><span>ç£çä¸´æ¶è¡¨ä½¿ç¨çå¼æé»è®¤æ¯InnoDBï¼æ¯ç±åæ°internal_tmp_disk_storage_engineæ§å¶çã</span></p><p><img src="Mysql 45è®².assets/image-20201113144247728.png" referrerpolicy="no-referrer" alt="image-20201113144247728"></p><p><img src="Mysql 45è®².assets/image-20201113144259769.png" referrerpolicy="no-referrer" alt="image-20201113144259769"></p><p><span>sort_modeéé¢æ¾ç¤ºçæ¯rowidæåºï¼è¿ä¸ªæ¯ç¬¦åé¢æçï¼åä¸æåºçæ¯éæºå¼Rå­æ®µårowidå­ æ®µç»æçè¡ãæåºçæ¯éæºå¼Rå­æ®µårowidå­æ®µç»æçè¡ã</span></p><p><span>è¿æ¶åä½ å¯è½å¿ç®äºä¸ä¸ï¼åç°ä¸å¯¹ãRå­æ®µå­æ¾çéæºå¼å°±8ä¸ªå­èï¼rowidæ¯6ä¸ªå­èï¼è³äº ä¸ºä»ä¹æ¯6å­èï¼å°±çç»ä½ è¯¾åæèå§ï¼ï¼æ°æ®æ»è¡æ°æ¯10000ï¼è¿æ ·ç®åºæ¥å°±æ140000å­èï¼ </span><strong><span>è¶è¿äºsort_buffer_size</span></strong><span> å®ä¹ç 32768å­èäºãä½æ¯ï¼number_of_tmp_filesçå¼å±ç¶æ¯0ï¼é¾é</span><code>ä¸éè¦ç¨ä¸´æ¶æä»¶å</code><span>ï¼</span></p><p><span>éç¨æ¯MySQL 5.6çæ¬å¼å¥çä¸ä¸ªæ°çæåºç®æ³ï¼ä¼åéåæåºç®æ³ï¼å æåºï¼ï¼åªè¦3ä¸ªå´å¾å°äºå¨é¨çæåºã</span></p><p><img src="Mysql 45è®².assets/image-20201113151228902.png" referrerpolicy="no-referrer" alt="image-20201113151228902"></p><p><span>ä¸ºäºæå¿«å°æ¿å°å½åå çæå¤§å¼ï¼æ»æ¯ä¿ææå¤§å¼å¨å é¡¶ï¼å æ­¤è¿æ¯ä¸ä¸ªæå¤§å ã</span></p><p><span>filesort_priority_queue_optimizationè¿ä¸ªé¨åç chosen=trueï¼å°±è¡¨ç¤ºä½¿ç¨äºä¼åéåæåºç®æ³ï¼è¿ä¸ªè¿ç¨ä¸éè¦ä¸´æ¶æä»¶ï¼å æ­¤å¯¹åºç number_of_tmp_filesæ¯0ã</span></p><h2><a name="éæºæåºæ¹æ³" class="md-header-anchor"></a><span>éæºæåºæ¹æ³</span><span>	</span></h2><h3><a name="éæºç®æ³1" class="md-header-anchor"></a><span>éæºç®æ³1</span></h3><p><img src="Mysql 45è®².assets/image-20201113152405573.png" referrerpolicy="no-referrer" alt="image-20201113152405573"></p><p><span>å ä¸ºåmax(id)åmin(id)é½æ¯ä¸éè¦æ«æç´¢å¼çï¼èç¬¬ä¸æ­¥çselectä¹å¯ä»¥ç¨ ç´¢å¼å¿«éå®ä½ï¼å¯ä»¥è®¤ä¸ºå°±</span><strong><span>åªæ«æäº3è¡</span></strong><span>ãä½å®éä¸ï¼è¿ä¸ªç®æ³æ¬èº«å¹¶ä¸ä¸¥æ ¼æ»¡è¶³é¢ç®çéæºè¦ æ±ï¼å ä¸ºIDä¸­é´å¯è½æç©ºæ´ï¼å æ­¤éæ©ä¸åè¡çæ¦çä¸ä¸æ ·ï¼ä¸æ¯çæ­£çéæºã</span></p><h3><a name="éæºç®æ³2" class="md-header-anchor"></a><span>éæºç®æ³2ã</span></h3><p><img src="Mysql 45è®².assets/image-20201113152452368.png" referrerpolicy="no-referrer" alt="image-20201113152452368"></p><p><img src="Mysql 45è®².assets/image-20201113152459954.png" referrerpolicy="no-referrer" alt="image-20201113152459954"></p><p><span>è§£å³äºç®æ³1éé¢ææ¾çæ¦çä¸ååé®é¢ï¼æ»å±éè¦æ«æC+Y+1è¡ï¼</span></p><p><span>å½ç¶ï¼éæºç®æ³2è·ç´æ¥order by rand()æ¯èµ·æ¥ï¼æ§è¡ä»£ä»·è¿æ¯å°å¾å¤çã</span></p><p><span>è¦éæºå3ä¸ªwordå¼å¢ï¼æ¯ C+(Y1+1)+(Y2+1)+(Y3+1)</span><img src="Mysql 45è®².assets/image-20201113152600882.png" referrerpolicy="no-referrer" alt="image-20201113152600882"></p><h2><a name="å°ç»-n855" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>å¦æä½ ç´æ¥ä½¿ç¨order by rand()ï¼è¿ä¸ªè¯­å¥éè¦Using temporaryå Using filesortï¼æ¥è¯¢çæ§è¡ä»£ ä»·å¾å¾æ¯æ¯è¾å¤§çãæä»¥ï¼å¨è®¾è®¡çæ¶åä½ è¦éé¿å¼è¿ç§åæ³ã</span></p><p><span>æ¯è¾è§èçç¨æ³å°±æ¯ï¼å°½éå°ä¸å¡é»è¾åå¨ä¸å¡ä»£ç ä¸­ï¼è®©æ°æ®åºåªåâè¯» åæ°æ®âçäºæãå æ­¤ï¼è¿ç±»æ¹æ³çåºç¨è¿æ¯æ¯è¾å¹¿æ³çã</span></p><h2><a name="é®é¢-n858" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201113154446424.png" referrerpolicy="no-referrer" alt="image-20201113154446424"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> t <span class="cm-keyword">limit</span> N, M-N+<span class="cm-number">1</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>åå ä¸åæ´ä¸ªè¡¨æ»è¡æ°çCè¡ï¼è¿ä¸ªæ¹æ¡çæ«æè¡æ°æ»å±åªéè¦C+M+1è¡ãæå°nä¸º0</span></p><h1><a name="18--ä¸ºä»ä¹è¿äºsqlè¯­å¥é»è¾ç¸åæ§è½å´å·®å¼å·¨å¤§" class="md-header-anchor"></a><span>18 | ä¸ºä»ä¹è¿äºSQLè¯­å¥é»è¾ç¸åï¼æ§è½å´å·®å¼å·¨å¤§ï¼</span></h1><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`tradelog`</span> ( </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`tradeid`</span> <span class="cm-builtin">varchar</span>(<span class="cm-number">32</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`operator`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-2">`t_modified`</span> <span class="cm-builtin">datetime</span> <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">KEY</span> <span class="cm-variable-2">`tradeid`</span> (<span class="cm-variable-2">`tradeid`</span>), </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">KEY</span> <span class="cm-variable-2">`t_modified`</span> (<span class="cm-variable-2">`t_modified`</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span> <span class="cm-keyword">DEFAULT</span> <span class="cm-string-2">CHARSET</span>=utf8mb4;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 207px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><h2><a name="æ¡ä¾ä¸æ¡ä»¶å­æ®µå½æ°æä½" class="md-header-anchor"></a><span>æ¡ä¾ä¸ï¼æ¡ä»¶å­æ®µå½æ°æä½</span></h2><p><span>è¦ç»è®¡å çå¨ææå¹´ä»½ä¸­7æä»½çäº¤æè®°å½æ»æ°</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; select count(*) from tradelog where month(t_modified)=7;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>ä¸ºä»ä¹æ¡ä»¶æ¯where t_modified=&#39;2018-7-1âçæ¶åå¯ä»¥ç¨ä¸ç´¢å¼ï¼èæ¹æwhere month(t_modified)=7å°±ä¸è¡ã</span></p><p><span>æ¹æ¡ä¸é¢çæ°å­å°±æ¯month()å½æ°å¯¹åºçå¼ã</span></p><p><img src="Mysql 45è®².assets/image-20201116151407476.png" referrerpolicy="no-referrer" alt="image-20201116151407476"></p><p><span>å¦æä½ çSQLè¯­å¥æ¡ä»¶ç¨çæ¯where t_modified=&#39;2018-7-1âçè¯ï¼å¼æå°±ä¼æç§ä¸é¢ç»¿è²ç®­å¤´ç è·¯çº¿ï¼å¿«éå®ä½å° t_modified=&#39;2018-7-1âéè¦çç»æã </span></p><p><span>å®éä¸ï¼B+æ æä¾çè¿ä¸ªå¿«éå®ä½è½åï¼æ¥æºäºåä¸å±åå¼èç¹ç</span><strong><span>æåºæ§</span></strong><span>ã</span></p><p><strong><span>å¯¹ç´¢å¼å­æ®µåå½æ°æä½ï¼å¯è½ä¼ç ´åç´¢å¼å¼çæåºæ§ï¼å æ­¤ä¼åå¨å°±å³å®æ¾å¼èµ°æ æç´¢åè½ã</span></strong></p><p><span>ä¼åå¨å¹¶ä¸æ¯è¦æ¾å¼ä½¿ç¨è¿ä¸ªç´¢å¼ã</span></p><p><span>å¨è¿ä¸ªä¾å­éï¼æ¾å¼äºæ æç´¢åè½ï¼ä¼åå¨å¯ä»¥éæ©éåä¸»é®ç´¢å¼ï¼ä¹å¯ä»¥éæ©éåç´¢å¼ t_modifiedï¼ä¼åå¨</span><strong><span>å¯¹æ¯ç´¢å¼å¤§å°å</span></strong><span>åç°ï¼ç´¢å¼t_modified</span><strong><span>æ´å°</span></strong><span>ï¼éåè¿ä¸ªç´¢å¼æ¯éåä¸»é®ç´¢å¼ æ¥å¾æ´å¿«ãå æ­¤æç»è¿æ¯ä¼éæ©ç´¢å¼t_modifiedã</span></p><p><img src="Mysql 45è®².assets/image-20201116151620211.png" referrerpolicy="no-referrer" alt="image-20201116151620211"></p><p><span>key=&quot;t_modified&quot;è¡¨ç¤ºçæ¯ï¼ä½¿ç¨äºt_modifiedè¿ä¸ªç´¢å¼ï¼</span></p><p><span>Extraå­æ®µçUsing indexï¼è¡¨ç¤ºç æ¯ä½¿ç¨äºè¦çç´¢å¼ã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> <span class="cm-keyword">count</span>(*) <span class="cm-keyword">from</span> tradelog <span class="cm-keyword">where</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-&gt; (t_modified &gt;= <span class="cm-string">'2016-7-1'</span> <span class="cm-keyword">and</span> t_modified&lt;<span class="cm-string">'2016-8-1'</span>) <span class="cm-keyword">or</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-&gt; (t_modified &gt;= <span class="cm-string">'2017-7-1'</span> <span class="cm-keyword">and</span> t_modified&lt;<span class="cm-string">'2017-8-1'</span>) <span class="cm-keyword">or</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-&gt; (t_modified &gt;= <span class="cm-string">'2018-7-1'</span> <span class="cm-keyword">and</span> t_modified&lt;<span class="cm-string">'2018-8-1'</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><h2><a name="æ¡ä¾äºéå¼ç±»åè½¬æ¢" class="md-header-anchor"></a><span>æ¡ä¾äºï¼éå¼ç±»åè½¬æ¢</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> tradelog <span class="cm-keyword">where</span> tradeid=<span class="cm-number">110717</span>; // å­æ®µä¸ºå­ç¬¦ä¸²</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>select â10â &gt; 9</span></p><ol start='' ><li><span>å¦æè§åæ¯âå°å­ç¬¦ä¸²è½¬ææ°å­âï¼é£ä¹å°±æ¯åæ°å­æ¯è¾ï¼ç»æåºè¯¥æ¯1ï¼ </span></li><li><span>å¦æè§åæ¯âå°æ°å­è½¬æå­ç¬¦ä¸²âï¼é£ä¹å°±æ¯åå­ç¬¦ä¸²æ¯è¾ï¼ç»æåºè¯¥æ¯0ã</span></li></ol><p><span>å¨MySQL ä¸­ï¼å­ç¬¦ä¸²åæ°å­åæ¯è¾çè¯ï¼æ¯å°</span><strong><span>å­ç¬¦ä¸²</span></strong><span>è½¬æ¢æ</span><strong><span>æ°å­</span></strong><span>ã</span></p><p><span>è¿ä¸ªè¯­å¥ç¸å½äºï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> tradelog <span class="cm-keyword">where</span> CAST(tradid <span class="cm-keyword">AS</span> <span class="cm-builtin">signed</span> <span class="cm-builtin">int</span>) = <span class="cm-number">110717</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>è§åï¼å¯¹ç´¢å¼å­æ®µåå½æ°æä½ï¼ä¼åå¨ä¼æ¾å¼èµ°æ æ ç´¢åè½ã</span></p><h2><a name="æ¡ä¾ä¸éå¼å­ç¬¦ç¼ç è½¬æ¢" class="md-header-anchor"></a><span>æ¡ä¾ä¸ï¼éå¼å­ç¬¦ç¼ç è½¬æ¢</span></h2><p><span>å¦å¤ä¸ä¸ªè¡¨trade_detailï¼ç¨äºè®°å½äº¤æçæä½ç»èã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`trade_detail`</span> (</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`tradeid`</span> <span class="cm-builtin">varchar</span>(<span class="cm-number">32</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`trade_step`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>, <span class="cm-comment">/*æä½æ­¥éª¤*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`step_info`</span> <span class="cm-builtin">varchar</span>(<span class="cm-number">32</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>, <span class="cm-comment">/*æ­¥éª¤ä¿¡æ¯*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">KEY</span> <span class="cm-variable-2">`tradeid`</span> (<span class="cm-variable-2">`tradeid`</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span> <span class="cm-keyword">DEFAULT</span> <span class="cm-string-2">CHARSET</span>=utf8;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> d.* <span class="cm-keyword">from</span> tradelog l, trade_detail d <span class="cm-keyword">where</span> d<span class="cm-variable-2">.tradeid</span>=l<span class="cm-variable-2">.tradeid</span> <span class="cm-keyword">and</span> l<span class="cm-variable-2">.id</span>=<span class="cm-number">2</span>; <span class="cm-comment">/*è¯­å¥Q</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201116153408847.png" referrerpolicy="no-referrer" alt="image-20201116153408847"></p><p><img src="Mysql 45è®².assets/image-20201116153529525.png" referrerpolicy="no-referrer" alt="image-20201116153529525"></p><p><span>æ¯ä»tradelogè¡¨ä¸­åtradeidå­æ®µï¼åå»trade_detailè¡¨éæ¥è¯¢å¹éå­æ®µã</span></p><p><img src="Mysql 45è®².assets/image-20201116153607599.png" referrerpolicy="no-referrer" alt="image-20201116153607599"></p><p><img src="Mysql 45è®².assets/image-20201116153647334.png" referrerpolicy="no-referrer" alt="image-20201116153647334"></p><p><span>è¿ä¸¤ä¸ªè¡¨çå­ç¬¦éä¸åï¼ä¸ä¸ªæ¯</span><strong><span>utf8</span></strong><span>ï¼ä¸ä¸ªæ¯ </span><strong><span>utf8mb4</span></strong></p><p><span>å­ç¬¦éutf8mb4æ¯utf8çè¶éï¼åæutf8å­ç¬¦ä¸²è½¬æutf8mb4å­ç¬¦éï¼éè¦å°è¢«é©±å¨æ°æ®è¡¨éçå­æ®µä¸ä¸ªä¸ªå°è½¬æ¢æutf8mb4</span></p><p><span>ç­åäºï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> trade_detail <span class="cm-keyword">where</span> <span class="cm-keyword">CONVERT</span>(traideid <span class="cm-keyword">USING</span> utf8mb4)=$L2<span class="cm-variable-2">.tradeid.value</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><strong><span>å¯¹ç´¢å¼å­æ®µåå½æ°æä½ï¼ä¼åå¨ä¼æ¾å¼èµ°æ æç´¢åè½</span></strong></p><p><span>æ¹æ³ä¸ï¼è¦ä¼åè¯­å¥</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">alter</span> <span class="cm-keyword">table</span> trade_detail <span class="cm-keyword">modify</span> tradeid <span class="cm-builtin">varchar</span>(<span class="cm-number">32</span>) <span class="cm-keyword">CHARACTER</span> <span class="cm-keyword">SET</span> utf8mb4 <span class="cm-keyword">default</span> <span class="cm-atom">null</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>æ¹æ³äºï¼æä¸»å¨æ l.tradeidè½¬æutf8ï¼å°±é¿åäºè¢«é©±å¨è¡¨ä¸çå­ç¬¦ç¼ç è½¬æ¢</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> d.* <span class="cm-keyword">from</span> tradelog l , trade_detail d <span class="cm-keyword">where</span> d<span class="cm-variable-2">.tradeid</span>=<span class="cm-keyword">CONVERT</span>(l<span class="cm-variable-2">.tradeid</span> <span class="cm-keyword">USING</span> utf8) <span class="cm-keyword">and</span> l<span class="cm-variable-2">.id</span> = <span class="cm-number">2</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><h2><a name="é®é¢-n909" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>æè¶£çåºæ¯</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`table_a`</span> (</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`b`</span> <span class="cm-builtin">varchar</span>(<span class="cm-number">10</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">KEY</span> <span class="cm-variable-2">`b`</span> (<span class="cm-variable-2">`b`</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><p>&nbsp;</p><h1><a name="19--ä¸ºä»ä¹æåªæ¥ä¸è¡çè¯­å¥ä¹æ§è¡è¿ä¹æ¢" class="md-header-anchor"></a><span>19 | ä¸ºä»ä¹æåªæ¥ä¸è¡çè¯­å¥ï¼ä¹æ§è¡è¿ä¹æ¢ï¼</span></h1><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`t`</span> (</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">NOT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`c`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) <span class="cm-keyword">DEFAULT</span> <span class="cm-atom">NULL</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p><span>å¶ä¸­æ10ä¸è¡æ°æ®çbçå¼æ¯â1234567890â</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> table_a <span class="cm-keyword">where</span> b=<span class="cm-string">'1234567890abcd'</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>æçæ³çæåµæ¯ï¼MySQLçå°å­æ®µbå®ä¹çæ¯varchar(10)ï¼é£è¯å®è¿åç©ºåã</span></p><p><img src="Mysql 45è®².assets/image-20201116164945552.png" referrerpolicy="no-referrer" alt="image-20201116164945552"></p><h2><a name="ç¬¬ä¸ç±»æ¥è¯¢é¿æ¶é´ä¸è¿å" class="md-header-anchor"></a><span>ç¬¬ä¸ç±»ï¼æ¥è¯¢é¿æ¶é´ä¸è¿å</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> t <span class="cm-keyword">where</span> id=<span class="cm-number">1</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>ä¸è¬ç¢°å°è¿ç§æåµçè¯ï¼å¤§æ¦çæ¯è¡¨tè¢«éä½äºã</span></p><p><code>show processlist</code><span>æ¥ç</span></p><p><img src="Mysql 45è®².assets/image-20201116155549325.png" referrerpolicy="no-referrer" alt="image-20201116155549325"></p><h3><a name="ç­mdlé" class="md-header-anchor"></a><span>ç­MDLé</span></h3><p><span>è¿ä¸ªç¶æè¡¨ç¤ºçæ¯ï¼ç°å¨æä¸ä¸ªçº¿ç¨æ­£å¨è¡¨tä¸è¯·æ±æèææMDLåéï¼æselectè¯­å¥ å µä½äºã</span></p><p><img src="Mysql 45è®².assets/image-20201116155621735.png" referrerpolicy="no-referrer" alt="image-20201116155621735"></p><p><span>è¿ç±»é®é¢çå¤çæ¹å¼ï¼å°±æ¯æ¾å°è°ææMDLåéï¼ç¶åæå®</span><code>killæã</code></p><p><img src="Mysql 45è®².assets/image-20201116155749392.png" referrerpolicy="no-referrer" alt="image-20201116155749392"></p><p><img src="Mysql 45è®².assets/image-20201116155756898.png" referrerpolicy="no-referrer" alt="image-20201116155756898"></p><h3><a name="ç­flush" class="md-header-anchor"></a><span>ç­flush</span></h3><p><img src="Mysql 45è®².assets/image-20201116160019004.png" referrerpolicy="no-referrer" alt="image-20201116160019004"></p><p><span>å¯¹è¡¨åflushæä½çç¨ æ³ï¼ä¸è¬æä»¥ä¸ä¸¤ä¸ªï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">flush</span> <span class="cm-keyword">tables</span> t <span class="cm-keyword">with</span> <span class="cm-keyword">read</span> <span class="cm-keyword">lock</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">flush</span> <span class="cm-keyword">tables</span> <span class="cm-keyword">with</span> <span class="cm-keyword">read</span> <span class="cm-keyword">lock</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>æ­£å¸¸è¿ä¸¤ä¸ªè¯­å¥æ§è¡èµ·æ¥é½å¾å¿«ï¼é¤éå®ä»¬ä¹è¢«å«ççº¿ç¨å µä½äºã</span></p><p><img src="Mysql 45è®².assets/image-20201116160100928.png" referrerpolicy="no-referrer" alt="image-20201116160100928"></p><p><span>æ¯è¡åä¸ç§ï¼è¿æ ·è¿ä¸ªè¯­å¥é»è®¤è¦æ§è¡10ä¸ç§ï¼å¨è¿æé´è¡¨ tä¸ç´æ¯è¢«session Aâæå¼âçãç¶åï¼session Bçflush tables tå½ä»¤åè¦å»å³é­è¡¨tï¼å°±éè¦ç­ session Açæ¥è¯¢ç»æãè¿æ ·ï¼session Cè¦åæ¬¡æ¥è¯¢çè¯ï¼å°±ä¼è¢«flush å½ä»¤å µä½äºã</span></p><h3><a name="ç­è¡é" class="md-header-anchor"></a><span>ç­è¡é</span></h3><p><span>ç»è¿äºè¡¨çº§éçèéªï¼æä»¬çselect è¯­å¥ç»äºæ¥å°å¼æéäºã</span></p><p><img src="Mysql 45è®².assets/image-20201116161213976.png" referrerpolicy="no-referrer" alt="image-20201116161213976"></p><p><span>è®¿é®id=1è¿ä¸ªè®°å½æ¶è¦å è¯»éï¼å¦æè¿æ¶åå·²ç»æä¸ä¸ªäºå¡å¨è¿è¡è®°å½ä¸ææä¸ä¸ªåé</span></p><p><img src="Mysql 45è®².assets/image-20201116161133672.png" referrerpolicy="no-referrer" alt="image-20201116161133672"></p><p><span>æ¥åºæ¯è°å çè¿ä¸ªåéï¼sys.innodb_lock_waits è¡¨æ¥å°ã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> t sys<span class="cm-variable-2">.innodb_lock_waits</span> <span class="cm-keyword">where</span> locked_table=<span class="cm-variable-2">`'test'.'t'`\G</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201116161309552.png" referrerpolicy="no-referrer" alt="image-20201116161309552"></p><p><span>èå¹²æè¿ä¸ªç½ªé­ç¥¸é¦çæ¹å¼ï¼å°±æ¯ KILLQUERY 4æKILL 4ã</span></p><p><span>ä¸è¿ï¼è¿éä¸åºè¯¥æ¾ç¤ºâKILLQUERY 4âãè¿ä¸ªå½ä»¤è¡¨ç¤ºåæ­¢4å·çº¿ç¨å½åæ­£å¨æ§è¡çè¯­å¥ï¼èè¿ ä¸ªæ¹æ³å¶å®æ¯æ²¡æç¨çãå ä¸ºå æè¡éçæ¯updateè¯­å¥ï¼è¿ä¸ªè¯­å¥å·²ç»æ¯ä¹åæ§è¡</span><strong><span>å®æäºç</span></strong><span>ï¼ ç°å¨æ§è¡KILLQUERYï¼æ æ³è®©è¿ä¸ªäºå¡å»æid=1ä¸çè¡éã</span></p><p><span>KILL 4æææï¼ä¹å°±æ¯è¯´ç´æ¥</span><strong><span>æ­å¼è¿ä¸ªè¿æ¥</span></strong><span>ãè¿ééå«çä¸ä¸ªé»è¾å°±æ¯ï¼è¿æ¥è¢«æ­å¼ç æ¶åï¼ä¼</span><strong><span>èªå¨</span><font color=red><span>åæ»</span></font><span> è¿ä¸ªè¿æ¥éé¢æ­£å¨æ§è¡ççº¿ç¨</span></strong><span>ï¼ä¹å°±éæ¾äºid=1ä¸çè¡éã</span></p><h2><a name="ç¬¬äºç±»æ¥è¯¢æ¢" class="md-header-anchor"></a><span>ç¬¬äºç±»ï¼æ¥è¯¢æ¢</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> t <span class="cm-keyword">where</span> c=<span class="cm-number">50000</span> <span class="cm-keyword">limit</span> <span class="cm-number">1</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>å­æ®µcä¸æ²¡æç´¢å¼ï¼è¿ä¸ªè¯­å¥åªè½èµ°idä¸»é®é¡ºåºæ«æï¼å æ­¤éè¦æ«æ5ä¸è¡ã</span></p><p><span> </span><code>set long_query_time=0</code><span>ï¼å°æ¢æ¥è¯¢æ¥å¿çæ¶é´éå¼è®¾ç½®ä¸º0ã</span></p><p><img src="Mysql 45è®².assets/image-20201116162714512.png" referrerpolicy="no-referrer" alt="image-20201116162714512"></p><p><strong><span>åæ¥è¯¢ä¸ä¸å®æ¯æ¢æ¥è¯¢</span></strong></p><p><span>slow log</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> t <span class="cm-keyword">where</span> id=<span class="cm-number">1</span>ï¼</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201116163556425.png" referrerpolicy="no-referrer" alt="image-20201116163556425"></p><p><img src="Mysql 45è®².assets/image-20201116163608020.png" referrerpolicy="no-referrer" alt="image-20201116163608020"></p><p><img src="Mysql 45è®².assets/image-20201116163617409.png" referrerpolicy="no-referrer" alt="image-20201116163617409"></p><p><img src="Mysql 45è®².assets/image-20201116163629724.png" referrerpolicy="no-referrer" alt="image-20201116163629724"></p><p><img src="Mysql 45è®².assets/image-20201116163715940.png" referrerpolicy="no-referrer" alt="image-20201116163715940"></p><p><span>session Bæ´æ°å®100ä¸æ¬¡ï¼çæäº100ä¸ä¸ªåæ»æ¥å¿(undo log)ã</span></p><p><span>å¸¦lock in share modeçSQLè¯­å¥ï¼æ¯</span><strong><span>å½åè¯»</span></strong></p><h2><a name="å°ç»-n963" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>æ§è¡âæ¥ä¸è¡âï¼å¯è½ä¼åºç°çè¢«éä½åæ§è¡æ¢çä¾å­ãè¿å¶ ä¸­æ¶åå°äºè¡¨éãè¡éåä¸è´æ§è¯»çæ¦å¿µã</span></p><h2><a name="é®é¢-n965" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>æä»¬å¨ä¸¾ä¾å éè¯»çæ¶åï¼ç¨çæ¯è¿ä¸ªè¯­å¥ï¼</span><code>select *fromt where id=1 lock in share mode</code><span>ãç±äºidä¸æç´¢å¼ï¼æä»¥å¯ä»¥ç´æ¥å®ä½å°id=1è¿ä¸è¡ï¼å æ­¤è¯»éä¹æ¯åªå å¨äºè¿ä¸è¡ä¸ã ä½å¦ææ¯ä¸é¢çSQLè¯­å¥ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">begin</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> t <span class="cm-keyword">where</span> c=<span class="cm-number">5</span> <span class="cm-keyword">for</span> <span class="cm-keyword">update</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">commit</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><span>è¿ä¸ªè¯­å¥åºåæ¯æä¹å éçå¢ï¼å çéåæ¯ä»ä¹æ¶åéæ¾å¢ï¼</span></p><p><span>cæ²¡æç´¢å¼ï¼å¨è¡¨æ«æï¼ãæåå­¦çåç­ä¸­è¿è¯´æäºè¯»æäº¤éç¦»çº§å«ä¸ï¼å¨è¯­å¥æ§è¡å® æåï¼æ¯åªæè¡éçãèä¸è¯­å¥æ§è¡å®æåï¼InnoDBå°±ä¼æä¸æ»¡è¶³æ¡ä»¶çè¡è¡éå»æã å½ç¶äºï¼c=5è¿ä¸è¡ç</span><strong><span>è¡é</span></strong><span>ï¼è¿æ¯ä¼ç­å°commitçæ¶åæéæ¾çã</span></p><h1><a name="20--å¹»è¯»æ¯ä»ä¹å¹»è¯»æä»ä¹é®é¢" class="md-header-anchor"></a><span>20 | å¹»è¯»æ¯ä»ä¹ï¼å¹»è¯»æä»ä¹é®é¢ï¼</span></h1><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`t`</span> (</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) NOTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`c`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) DEFAULTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`d`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) DEFAULTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">KEY</span> <span class="cm-variable-2">`c`</span> (<span class="cm-variable-2">`c`</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> t <span class="cm-keyword">values</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>),(<span class="cm-number">5</span>,<span class="cm-number">5</span>,<span class="cm-number">5</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">10</span>,<span class="cm-number">10</span>,<span class="cm-number">10</span>),(<span class="cm-number">15</span>,<span class="cm-number">15</span>,<span class="cm-number">15</span>),(<span class="cm-number">20</span>,<span class="cm-number">20</span>,<span class="cm-number">20</span>),(<span class="cm-number">25</span>,<span class="cm-number">25</span>,<span class="cm-number">25</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p><span>è¿ä¸ªè¡¨é¤äºä¸»é®idå¤ï¼è¿æä¸ä¸ªç´¢å¼cï¼åå§åè¯­å¥å¨è¡¨ä¸­æå¥äº6è¡æ°æ®ã</span></p><h2><a name="å¹»è¯»æ¯ä»ä¹" class="md-header-anchor"></a><span>å¹»è¯»æ¯ä»ä¹ï¼</span></h2><p><span>åªå¨id=5è¿ä¸è¡å éï¼å¯¼è´binlogä¸ä¸è´</span></p><p><img src="Mysql 45è®².assets/image-20201117151241869.png" referrerpolicy="no-referrer" alt="image-20201117151241869"></p><p><img src="Mysql 45è®².assets/image-20201117151322521.png" referrerpolicy="no-referrer" alt="image-20201117151322521"></p><p><span>ä¹å°±æ¯è¯´ï¼å³ä½¿æææçè®°å½é½å ä¸éï¼è¿æ¯é»æ­¢ä¸äº</span><strong><span>æ°æå¥</span></strong><span>çè®°å½ï¼è¿ä¹æ¯ä¸ºä»ä¹âå¹»è¯»âä¼è¢«åç¬æ¿åºæ¥è§£å³çåå ã</span></p><p><span>åççInnoDBæä¹è§£å³å¹»è¯»çé®é¢ï¼</span></p><h2><a name="å¦ä½è§£å³å¹»è¯»" class="md-header-anchor"></a><span>å¦ä½è§£å³å¹»è¯»ï¼</span></h2><p><span>InnoDBåªå¥½å¼å¥æ°çéï¼ä¹å°±æ¯é´éé(Gap Lock)ã</span></p><p><img src="Mysql 45è®².assets/image-20201117151547862.png" referrerpolicy="no-referrer" alt="image-20201117151547862"></p><p><span>è¡ select *fromt where d=5 for updateçæ¶åï¼å°±ä¸æ­¢æ¯ç»æ°æ®åºä¸­å·²æç6ä¸ªè®° å½å ä¸äºè¡éï¼è¿åæ¶å äº7ä¸ªé´ééãè¿æ ·å°±ç¡®ä¿äºæ æ³åæå¥æ°çè®°å½</span></p><p><img src="Mysql 45è®².assets/image-20201117151707283.png" referrerpolicy="no-referrer" alt="image-20201117151707283"></p><p><span>è·è¡éæå²çªå³ç³»çæ¯âå¦å¤ä¸ä¸ªè¡éâã</span></p><p><strong><span>è·é´ééå­å¨å²çªå³ç³»çï¼æ¯âå¾è¿ä¸ªé´éä¸­æå¥ä¸ä¸ªè®°å½âè¿ä¸ªæ ä½</span></strong><span>ãé´ééä¹é´é½ä¸å­å¨å²çªå³ç³»ã</span></p><p><span>é´ééåè¡éåç§°</span><code>next-key lock</code><span>ï¼æ¯ä¸ªnext-key lockæ¯åå¼åé­åºé´ã</span></p><p><span>å¦æç¨select *fromt for updateè¦ææ´ä¸ªè¡¨ææè®°å½éèµ·æ¥ï¼å°±å½¢æäº7ä¸ªnext-key lockï¼åå«æ¯ (-â,0]ã(0,5]ã(5,10]ã(10,15]ã(15,20]ã(20, 25]ã(25, +supremum]ã</span></p><p><span>é´ééånext-key lockçå¼å¥ï¼å¸®æä»¬è§£å³äºå¹»è¯»çé®é¢ï¼ä½åæ¶ä¹å¸¦æ¥äºä¸äºâå°æ°âã</span></p><h2><a name="é´ééçå°æ°" class="md-header-anchor"></a><span>é´ééçå°æ°</span></h2><p><img src="Mysql 45è®².assets/image-20201117152257013.png" referrerpolicy="no-referrer" alt="image-20201117152257013"></p><p><img src="Mysql 45è®².assets/image-20201117152517463.png" referrerpolicy="no-referrer" alt="image-20201117152517463"></p><p><span>é´ééçå¼å¥ï¼å¯è½ä¼å¯¼è´åæ ·çè¯­å¥éä½æ´å¤§çèå´ï¼è¿å¶å®æ¯å½±åäºå¹¶ååº¦çã</span></p><p><span>é´ééæ¯å¨</span><strong><span>å¯éå¤è¯»éç¦»çº§å«</span></strong><span>ä¸æä¼çæçï¼ä½ å¦ææéç¦»çº§å«è®¾ç½®ä¸ºè¯»æäº¤çè¯ï¼ å°±æ²¡æé´ééäºãä½åæ¶ï¼ä½ è¦è§£å³å¯è½åºç°çæ°æ®åæ¥å¿ä¸ä¸è´é®é¢ï¼éè¦æbinlogæ ¼å¼è®¾ç½® ä¸º</span><code>row</code><span>ã</span></p><p><span>ä¸å¡ä¸éè¦å¯éå¤è¯»çä¿è¯ï¼è¿æ ·èèå°è¯»æäº¤ä¸æä½æ°æ®çéèå´æ´å°ï¼æ²¡æé´ééï¼ï¼è¿ä¸ªéæ©æ¯åçç</span></p><h2><a name="é®é¢-n995" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201117153418630.png" referrerpolicy="no-referrer" alt="image-20201117153418630"></p><p><span>è¿ésession Båsession Cçinsert è¯­å¥é½ä¼è¿å¥éç­å¾ç¶æã</span></p><h1><a name="21--ä¸ºä»ä¹æåªæ¹ä¸è¡çè¯­å¥éè¿ä¹å¤" class="md-header-anchor"></a><span>21 | ä¸ºä»ä¹æåªæ¹ä¸è¡çè¯­å¥ï¼éè¿ä¹å¤ï¼</span></h1><p><span>ææ»ç»çå éè§åéé¢ï¼åå«äºä¸¤ä¸ªâååâãä¸¤ä¸ªâä¼åâåä¸ä¸ªâbugâã</span></p><ol start='' ><li><p><span>åå1ï¼å éçåºæ¬åä½æ¯next-key lockãå¸æä½ è¿è®°å¾ï¼next-key lockæ¯åå¼åé­åºé´ã </span></p></li><li><p><span>åå2ï¼æ¥æ¾è¿ç¨ä¸­è®¿é®å°çå¯¹è±¡æä¼å éã</span></p></li><li><p><span>ä¼å1ï¼ç´¢å¼ä¸ç</span><strong><span>ç­å¼</span></strong><span>æ¥è¯¢ï¼ç»</span><strong><span>å¯ä¸</span></strong><span>ç´¢å¼å éçæ¶åï¼next-key lockéåä¸ºè¡éã </span></p><p><span>ä¼å2ï¼ç´¢å¼ä¸ç</span><strong><span>ç­å¼</span></strong><span>æ¥è¯¢ï¼åå³éåæ¶ä¸æåä¸ä¸ªå¼</span><strong><span>ä¸</span></strong><span>æ»¡è¶³ç­å¼æ¡ä»¶çæ¶åï¼next-key lockéåä¸º</span><strong><span>é´éé</span></strong><span>ã </span></p></li><li><p><span>ä¸ä¸ªbugï¼</span><strong><span>å¯ä¸</span></strong><span>ç´¢å¼ä¸ç</span><strong><span>èå´</span></strong><span>æ¥è¯¢ä¼è®¿é®å°ä¸æ»¡è¶³æ¡ä»¶çç¬¬ä¸ä¸ªå¼ä¸ºæ­¢ã</span></p></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`t`</span> (</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) NOTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`c`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) DEFAULTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`d`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) DEFAULTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">KEY</span> <span class="cm-variable-2">`c`</span> (<span class="cm-variable-2">`c`</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> t <span class="cm-keyword">values</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>),(<span class="cm-number">5</span>,<span class="cm-number">5</span>,<span class="cm-number">5</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">10</span>,<span class="cm-number">10</span>,<span class="cm-number">10</span>),(<span class="cm-number">15</span>,<span class="cm-number">15</span>,<span class="cm-number">15</span>),(<span class="cm-number">20</span>,<span class="cm-number">20</span>,<span class="cm-number">20</span>),(<span class="cm-number">25</span>,<span class="cm-number">25</span>,<span class="cm-number">25</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><h2><a name="æ¡ä¾ä¸ç­å¼æ¥è¯¢é´éé" class="md-header-anchor"></a><span>æ¡ä¾ä¸ï¼ç­å¼æ¥è¯¢é´éé</span></h2><p><img src="Mysql 45è®².assets/image-20201117160316772.png" referrerpolicy="no-referrer" alt="image-20201117160316772"></p><p><img src="Mysql 45è®².assets/image-20201117160714877.png" referrerpolicy="no-referrer" alt="image-20201117160714877"></p><h2><a name="æ¡ä¾äºéå¯ä¸ç´¢å¼ç­å¼é" class="md-header-anchor"></a><span>æ¡ä¾äºï¼éå¯ä¸ç´¢å¼ç­å¼é</span></h2><p><img src="Mysql 45è®².assets/image-20201117160958408.png" referrerpolicy="no-referrer" alt="image-20201117160958408"></p><ul><li><span>(0,5]å ä¸next-key lock</span></li><li><span>è¦ç»(5,10]å next-key lock</span></li><li><span>éåæé´éé(5,10)ã</span></li><li><span>è¿ä¸ªæ¥è¯¢ä½¿ç¨è¦çç´¢å¼ï¼å¹¶ä¸éè¦è®¿é®ä¸»é®ç´¢ å¼ï¼æä»¥ä¸»é®ç´¢å¼ä¸æ²¡æå ä»»ä½éï¼è¿å°±æ¯ä¸ºä»ä¹session Bçupdateè¯­å¥å¯ä»¥æ§è¡å®æ</span></li></ul><p><span>Lock in share modeåªéè¦çç´¢å¼ï¼ä½æ¯å¦ææ¯</span><strong><span>for update</span></strong><span>å°±ä¸ä¸æ · äºã æ§è¡ for updateæ¶ï¼ç³»ç»ä¼è®¤ä¸ºä½ æ¥ä¸æ¥è¦æ´æ°æ°æ®ï¼å æ­¤ä¼</span><strong><span>é¡ºä¾¿ç»ä¸»é®ç´¢å¼ä¸æ»¡è¶³æ¡ä»¶ç è¡å ä¸è¡éã</span></strong></p><h2><a name="æ¡ä¾ä¸ä¸»é®ç´¢å¼èå´é" class="md-header-anchor"></a><span>æ¡ä¾ä¸ï¼ä¸»é®ç´¢å¼èå´é</span></h2><p><img src="Mysql 45è®².assets/image-20201117162150463.png" referrerpolicy="no-referrer" alt="image-20201117162150463"></p><p><img src="Mysql 45è®².assets/image-20201117162201523.png" referrerpolicy="no-referrer" alt="image-20201117162201523"></p><p><span>è¡éid=10ånext-key lock(10,15]ã</span></p><p><span>å¤ä¸ªbug</span></p><h2><a name="æ¡ä¾åéå¯ä¸ç´¢å¼èå´é" class="md-header-anchor"></a><span>æ¡ä¾åï¼éå¯ä¸ç´¢å¼èå´é</span></h2><p><img src="Mysql 45è®².assets/image-20201117162834346.png" referrerpolicy="no-referrer" alt="image-20201117162834346"></p><p><span>ç´¢å¼cä¸ç(5,10] å(10,15] è¿ä¸¤ä¸ªnext-key lockãå ä¸ºæ¯for update æä»¥ä¸»é®ç´¢å¼ä¹å </span></p><p><span>c&lt; 11 çéå°±å¨(10,15]</span></p><p><span>å ä¸ºInnoDBè¦æ«å°c=15ï¼æç¥éä¸éè¦ç»§ç»­å¾åæ¾äºã</span></p><h2><a name="æ¡ä¾äºå¯ä¸ç´¢å¼èå´ébug" class="md-header-anchor"></a><span>æ¡ä¾äºï¼å¯ä¸ç´¢å¼èå´ébug</span></h2><p><img src="Mysql 45è®².assets/image-20201117173013001.png" referrerpolicy="no-referrer" alt="image-20201117173013001"></p><p><span>(10,15],(15,20]è¿ä¸ªnext-key lockä¹ä¼è¢«éä¸</span></p><h2><a name="æ¡ä¾å­éå¯ä¸ç´¢å¼ä¸å­å¨ç­å¼çä¾å­" class="md-header-anchor"></a><span>æ¡ä¾å­ï¼éå¯ä¸ç´¢å¼ä¸å­å¨&quot;ç­å¼&quot;çä¾å­</span></h2><p><span>æç»è¡¨tæå¥ä¸æ¡æ°è®°å½ã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> t <span class="cm-keyword">values</span>(<span class="cm-number">30</span>,<span class="cm-number">10</span>,<span class="cm-number">30</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201117173142612.png" referrerpolicy="no-referrer" alt="image-20201117173142612"></p><p><img src="Mysql 45è®².assets/image-20201117173201885.png" referrerpolicy="no-referrer" alt="image-20201117173201885"></p><p>&nbsp;</p><p><img src="Mysql 45è®².assets/image-20201117173444126.png" referrerpolicy="no-referrer" alt="image-20201117173444126"></p><h2><a name="æ¡ä¾ä¸limit-è¯­å¥å é" class="md-header-anchor"></a><span>æ¡ä¾ä¸ï¼limit è¯­å¥å é</span></h2><p><img src="Mysql 45è®².assets/image-20201117173515332.png" referrerpolicy="no-referrer" alt="image-20201117173515332"></p><p><img src="Mysql 45è®².assets/image-20201117173525114.png" referrerpolicy="no-referrer" alt="image-20201117173525114"></p><p><span>å æ­¤å¨éåå°(c=10, id=30)è¿ä¸è¡ä¹ åï¼æ»¡è¶³æ¡ä»¶çè¯­å¥å·²ç»æä¸¤æ¡ï¼å¾ªç¯å°±ç»æäºã</span></p><p><strong><span>å¨å é¤æ°æ®çæ¶åå°½éå limit</span></strong></p><h2><a name="æ¡ä¾å«ä¸ä¸ªæ­»éçä¾å­" class="md-header-anchor"></a><span>æ¡ä¾å«ï¼ä¸ä¸ªæ­»éçä¾å­</span></h2><p><img src="Mysql 45è®².assets/image-20201117173651912.png" referrerpolicy="no-referrer" alt="image-20201117173651912"></p><p><img src="Mysql 45è®².assets/image-20201117173757939.png" referrerpolicy="no-referrer" alt="image-20201117173757939"></p><p><span>session Bçâå next-key lock(5,10] âæä½ï¼å®éä¸åæäºä¸¤æ­¥ï¼åæ¯å (5,10)çé´ ééï¼å éæåï¼ç¶åå c=10çè¡é</span></p><p><span>æä»¬å¨åæå éè§åçæ¶åå¯ä»¥ç¨next-key lockæ¥åæãä½æ¯è¦ç¥éï¼å·ä½æ§è¡çæ¶ åï¼æ¯è¦åæ</span><strong><span>é´ééåè¡éä¸¤æ®µæ¥æ§è¡</span></strong><span>çã</span></p><h2><a name="å°ç»-n1056" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>limit çå¥½å¤</span></p><p><span>next-key lockå®éä¸æ¯ç±é´ééå è¡éå®ç°</span></p><h2><a name="é®é¢-n1059" class="md-header-anchor"></a><span>é®é¢</span></h2><p><img src="Mysql 45è®².assets/image-20201118173252263.png" referrerpolicy="no-referrer" alt="image-20201118173252263"></p><p><img src="Mysql 45è®².assets/image-20201120115125826.png" referrerpolicy="no-referrer" alt="image-20201120115125826"></p><p><span>select *fromâ¦for update è¯­å¥ï¼ä¼åå¨å³å®ä½¿ç¨å¨è¡¨æ«æï¼é£ä¹å°±ä¼æä¸»é®ç´¢å¼ä¸next-key lockå¨å ä¸ã</span></p><p><span>&lt;=å°åºæ¯é´ééè¿æ¯è¡éï¼å¶å®ï¼è¿ä¸ªé®é¢ï¼ä½ è¦è·âæ§è¡è¿ ç¨âéåèµ·æ¥åæãå¨InnoDBè¦å»æ¾âç¬¬ä¸ä¸ªå¼âçæ¶åï¼æ¯æç§ç­å¼å»æ¾çï¼ç¨çæ¯ç­å¼å¤æ­ çè§åï¼æ¾å°ç¬¬ä¸ä¸ªå¼ä»¥åï¼è¦å¨ç´¢å¼åæ¾âä¸ä¸ä¸ªå¼âï¼å¯¹åºäºæä»¬è§åä¸­è¯´çèå´æ¥æ¾ã</span></p><p><img src="Mysql 45è®².assets/image-20201120134920762.png" referrerpolicy="no-referrer" alt="image-20201120134920762"></p><h1><a name="22--mysqlæåªäºé¥®é¸©æ­¢æ¸´æé«æ§è½çæ¹æ³" class="md-header-anchor"></a><span>22 | MySQLæåªäºâé¥®é¸©æ­¢æ¸´âæé«æ§è½çæ¹æ³ï¼</span></h1><p><span>å°±å¶å°ä¼ç¢°ä¸è¿ç§åºæ¯ãç¨æ·çå¼åè´è´£äººè¯´ï¼ä¸ç®¡ä½ ç¨ä»ä¹æ¹æ¡ï¼ è®©ä¸å¡åè·èµ·æ¥åè¯´ã</span></p><h2><a name="ç­è¿æ¥é£æ´" class="md-header-anchor"></a><span>ç­è¿æ¥é£æ´</span></h2><p><span>æ­£å¸¸çç­è¿æ¥æ¨¡å¼å°±æ¯è¿æ¥å°æ°æ®åºåï¼æ§è¡å¾å°çSQLè¯­å¥å°±æ­å¼ï¼ä¸æ¬¡éè¦çæ¶ååéè¿ãå¦æä½¿ç¨çæ¯ç­è¿æ¥ï¼å¨ä¸å¡é«å³°æçæ¶åï¼å°±å¯è½åºç°è¿æ¥æ°çªç¶æ´æ¶¨çæåµã</span></p><p><span>MySQLå»ºç«è¿æ¥çè¿ ç¨ï¼ææ¬æ¯å¾é«çãé¤äºæ­£å¸¸çç½ç»è¿æ¥ä¸æ¬¡æ¡æå¤ï¼è¿éè¦å</span><strong><span>ç»å½æéå¤æ­</span></strong><span>åè·å¾è¿ä¸ª</span><strong><span>è¿æ¥ç æ°æ®è¯»åæé</span></strong><span>ã</span></p><p><code>max_connections</code><span>åæ°ï¼è¿æ¥æ°çä¸éï¼è¶è¿è¿ä¸ªå¼ï¼ç³»ç» å°±ä¼æç»æ¥ä¸æ¥çè¿æ¥è¯·æ±ï¼å¹¶æ¥éæç¤ºâToo many connectionsâã</span><strong><span>è°é«</span></strong><span>max_connectionsçå¼ï¼å¦ææä»¬æå®æ¹å¾å¤ªå¤§ï¼è®©æ´ å¤çè¿æ¥é½å¯ä»¥è¿æ¥ï¼é£ä¹ç³»ç»ç</span><strong><span>è´è½½</span></strong><span>å¯è½ä¼è¿ä¸æ­¥</span><strong><span>å å¤§</span></strong><span>ï¼å¤§éçèµæºèè´¹å¨æééªè¯ç­é»è¾ä¸ï¼ç»æå¯è½æ¯éå¾å¶åï¼å·²ç»è¿æ¥ççº¿ç¨æ¿ä¸å°CPUèµæºå»æ§è¡ä¸å¡çSQLè¯·æ±ã</span></p><h3><a name="ç¬¬ä¸ç§æ¹æ³" class="md-header-anchor"></a><span>ç¬¬ä¸ç§æ¹æ³</span></h3><p><span>åå¤çæé£äºå çè¿æ¥ä½æ¯ä¸å·¥ä½ççº¿ç¨</span></p><p><span>ç½®</span><code>wait_timeout</code><span>åæ°è¡¨ç¤ºçæ¯ï¼ä¸ä¸ªçº¿ç¨ç©ºé²wait_timeoutè¿ä¹å¤ç§ä¹åï¼å°±ä¼è¢« MySQLç´æ¥æ­å¼è¿æ¥ã</span></p><p><span>è¸¢ææ¾ç¤ºä¸ºsleepççº¿ç¨ï¼å¯è½æ¯ææçï¼ä¸é¢çä¾å­</span></p><p><img src="Mysql 45è®².assets/image-20201120112201661.png" referrerpolicy="no-referrer" alt="image-20201120112201661"></p><p><img src="Mysql 45è®².assets/image-20201120112505884.png" referrerpolicy="no-referrer" alt="image-20201120112505884"></p><p><span>èè¦çäºå¡å·ä½ç¶æçè¯ï¼ä½ å¯ä»¥æ¥ information_schemaåºçinnodb_trxè¡¨ã</span></p><p><img src="Mysql 45è®².assets/image-20201120112547095.png" referrerpolicy="no-referrer" alt="image-20201120112547095"></p><p><span>è¿ä¸ªç»æéï¼trx_mysql_thread_id=4ï¼è¡¨ç¤ºid=4ççº¿ç¨è¿å¤å¨äºå¡ä¸­ã</span></p><p><strong><span>å æ­¤ï¼å¦ææ¯è¿æ¥æ°è¿å¤ï¼ä½ å¯ä»¥ä¼åæ­å¼äºå¡å¤ç©ºé²å¤ªä¹çè¿æ¥ï¼å¦æè¿æ ·è¿ä¸å¤ï¼åèèæ­ å¼äºå¡åç©ºé²å¤ªä¹çè¿æ¥ã</span></strong></p><h3><a name="ç¬¬äºç§æ¹æ³" class="md-header-anchor"></a><span>ç¬¬äºç§æ¹æ³</span></h3><p><span>åå°è¿æ¥è¿ç¨çæ¶èã</span></p><p><span>æçä¸å¡ä»£ç ä¼å¨ç­æ¶é´ååå¤§éç³è¯·æ°æ®åºè¿æ¥åå¤ç¨ï¼å¦æç°å¨æ°æ®åºç¡®è®¤æ¯è¢«è¿æ¥è¡ä¸ºæ æäºï¼é£ä¹ä¸ç§å¯è½çåæ³ï¼æ¯è®©æ°æ®åº</span><strong><span>è·³è¿æééªè¯é¶æ®µ</span></strong><span>ã</span></p><p><span>é£é©æé«ï¼MySQL 8.0çæ¬éï¼å¦æä½ å¯ç¨</span><code>âskip-grant-tables</code><span>åæ°ï¼MySQLä¼é»è®¤æ --skip-networkingå æ°æå¼ï¼è¡¨ç¤ºè¿æ¶åæ°æ®åºåªè½è¢«</span><strong><span>æ¬å°</span></strong><span>çå®¢æ·ç«¯è¿æ¥ã</span></p><h2><a name="æ¢æ¥è¯¢æ§è½é®é¢" class="md-header-anchor"></a><span>æ¢æ¥è¯¢æ§è½é®é¢</span></h2><ol start='' ><li><span>ç´¢å¼æ²¡æè®¾è®¡å¥½ï¼</span></li><li><span>SQLè¯­å¥æ²¡åå¥½ï¼ </span></li><li><span>MySQLééäºç´¢å¼ã</span></li></ol><h3><a name="å¯¼è´æ¢æ¥è¯¢çç¬¬ä¸ç§å¯è½æ¯ç´¢å¼æ²¡æè®¾è®¡å¥½" class="md-header-anchor"></a><span>å¯¼è´æ¢æ¥è¯¢çç¬¬ä¸ç§å¯è½æ¯ï¼ç´¢å¼æ²¡æè®¾è®¡å¥½ã</span></h3><p><span>è¿ç´§æ¥åå»ºç´¢å¼æ¥è§£å³ï¼Online DDL ï¼å¯¹äºé£ç§é«å³°ææ°æ®åºå·²ç»è¢«è¿ä¸ªè¯­å¥ææäºçæåµï¼æé«æçåæ³å°±æ¯ç´æ¥æ§è¡alter table è¯­å¥ã</span></p><p><span>åè®¾ä½ ç°å¨çæå¡æ¯ä¸ä¸»ä¸å¤ï¼ä¸»åºAãå¤åºBï¼è¿ä¸ªæ¹æ¡ç å¤§è´æµç¨æ¯è¿æ ·çï¼</span></p><p><img src="Mysql 45è®².assets/image-20201120113456123.png" referrerpolicy="no-referrer" alt="image-20201120113456123"></p><p><span>gh-ostè¿æ ·çæ¹æ¡ï¼æ´å ç¨³ å¦¥ãä½æ¯å¨éè¦ç´§æ¥å¤çæ¶ï¼ä¸é¢è¿ä¸ªæ¹æ¡çæçæ¯æé«çã</span></p><h3><a name="å¯¼è´æ¢æ¥è¯¢çç¬¬äºç§å¯è½æ¯è¯­å¥æ²¡åå¥½" class="md-header-anchor"></a><span>å¯¼è´æ¢æ¥è¯¢çç¬¬äºç§å¯è½æ¯ï¼è¯­å¥æ²¡åå¥½ã</span></h3><p><span>æä»¬å¯ä»¥éè¿æ¹åSQLè¯­å¥æ¥å¤çãMySQL 5.7æä¾äºquery_rewriteåè½ï¼å¯ä»¥æè¾å¥ç ä¸ç§è¯­å¥æ¹åæå¦å¤ä¸ç§æ¨¡å¼ã</span></p><p><span>select *fromt where id + 1 = 10000ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> query_rewrite<span class="cm-variable-2">.rewrite_rules</span>(pattern, replacement, pattern_database) <span class="cm-keyword">values</span> (<span class="cm-string">"select * from t where id + 1 = ?"</span>, <span class="cm-string">"select * from t where id = ? - 1"</span>, <span class="cm-string">"db1"</span>); <span class="cm-keyword">call</span> query_rewrite<span class="cm-variable-2">.flush_rewrite_rules</span>();</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201120114319682.png" referrerpolicy="no-referrer" alt="image-20201120114319682"></p><h3><a name="mysqlééäºç´¢å¼" class="md-header-anchor"></a><span>MySQLééäºç´¢å¼</span></h3><p><span>è¿æ¶åï¼åºæ¥æ¹æ¡å°±æ¯ç»è¿ä¸ªè¯­å¥å ä¸force indexã</span></p><p><span>ææ¯æ°é¡¹ç®çè¯ï¼æèæ¯ä¿®æ¹äºåæé¡¹ç®ç è¡¨ç»æè®¾è®¡ï¼å¨éåå½æµè¯é½æ¯å¿è¦çãè¿æ¶åï¼ä½ éè¦å·¥å·å¸®ä½ æ£æ¥ææçSQLè¯­å¥çè¿åç» æãæ¯å¦ï¼ä½ å¯ä»¥ä½¿ç¨å¼æºå·¥å·pt-query-digest(</span><a href='https://www.percona.com/doc/perconatoolkit/3.0/pt-query-digest.html' target='_blank' class='url'>https://www.percona.com/doc/perconatoolkit/3.0/pt-query-digest.html</a><span>)</span></p><h2><a name="qpsçªå¢é®é¢" class="md-header-anchor"></a><span>QPSçªå¢é®é¢</span></h2><p><span>ç±ä¸ä¸ªæ°åè½çbugå¯¼è´ç</span></p><ul><li><span>ä¸ç§æ¯ç±å¨æ°ä¸å¡çbugå¯¼è´çãåè®¾ä½ çDBè¿ç»´æ¯æ¯è¾è§èçï¼ä¹å°±æ¯è¯´ç½ååæ¯ä¸ä¸ªä¸ª å çãè¿ç§æåµä¸ï¼å¦æä½ è½å¤ç¡®å®ä¸å¡æ¹ä¼ä¸æè¿ä¸ªåè½ï¼åªæ¯æ¶é´ä¸æ²¡é£ä¹å¿«ï¼é£ä¹å°± å¯ä»¥ä»æ°æ®åºç«¯ç´æ¥æç½ååå»æã</span></li><li><span>å¦æè¿ä¸ªæ°åè½ä½¿ç¨çæ¯åç¬çæ°æ®åºç¨æ·ï¼å¯ä»¥ç¨ç®¡çåè´¦å·æè¿ä¸ªç¨æ·å æï¼ç¶åæ­å¼ ç°æè¿æ¥ãè¿æ ·ï¼è¿ä¸ªæ°åè½çè¿æ¥ä¸æåï¼ç±å®å¼åçQPSå°±ä¼åæ0ã</span></li><li><span>æ¥è¯¢éååè½ï¼æååæå¤§çSQLè¯­å¥ç´æ¥éåæ&quot;select 1&quot;è¿ åã</span></li></ul><h2><a name="å°ç»-n1115" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>è¿äºå¤çææ®µä¸­ï¼æ¢åæ¬äºç²æ´å°æç»è¿æ¥åæ­å¼è¿æ¥ï¼ä¹æéè¿éåè¯­å¥æ¥ç»è¿ä¸äºåçæ¹ æ³ï¼æ¢æä¸´æ¶çé«å±æ¹æ¡ï¼ä¹ææªé¨ç»¸ç¼ªçãç¸å¯¹å®å¨çé¢æ¡ã </span></p><p><span>å¨å®éå¼åä¸­ï¼æä»¬ä¹è¦å°½éé¿åä¸äºä½æçæ¹æ³ï¼æ¯å¦é¿åå¤§éå°ä½¿ç¨ç­è¿æ¥ãåæ¶ï¼å¦æä½ åä¸å¡å¼åçè¯ï¼è¦ç¥éï¼è¿æ¥å¼å¸¸æ­å¼æ¯å¸¸æçäºï¼ä½ çä»£ç éè¦ææ­£ç¡®å°</span><strong><span>éè¿å¹¶éè¯çæºå¶</span></strong><span>ã</span></p><p><span> DBAè½ç¶å¯ä»¥éè¿è¯­å¥éåæ¥ææ¶å¤çé®é¢ï¼ä½æ¯è¿æ¬èº«æ¯ä¸ä¸ªé£é©é«çæä½ï¼åå¥½SQLå®¡è®¡ å¯ä»¥åå°éè¦è¿ç±»æä½çæºä¼ã å¶å®ï¼ä½ å¯ä»¥çå¾åºæ¥ï¼å¨è¿ç¯æç« ä¸­ææå°çè§£å³æ¹æ³ä¸»è¦éä¸­å¨</span><strong><span>serverå±ã</span></strong></p><h2><a name="é®é¢-n1119" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>ä»å¤©ï¼æçç»ä½ çè¯¾åé®é¢æ¯ï¼ä½ æ¯å¦ç¢°å°è¿ï¼å¨ä¸å¡é«å³°æéè¦ä¸´æ¶æç«çåºæ¯ï¼ä½ åæ¯æä¹ å¤ççå¢ï¼</span></p><p><img src="Mysql 45è®².assets/image-20201120153019332.png" referrerpolicy="no-referrer" alt="image-20201120153019332"></p><h1><a name="23--mysqlæ¯æä¹ä¿è¯æ°æ®ä¸ä¸¢ç" class="md-header-anchor"></a><span>23 | MySQLæ¯æä¹ä¿è¯æ°æ®ä¸ä¸¢çï¼</span></h1><p><span>åªè¦redo logåbinlogä¿è¯æä¹åå°ç£çï¼å°± è½ç¡®ä¿MySQLå¼å¸¸éå¯åï¼æ°æ®å¯ä»¥æ¢å¤ã</span></p><h2><a name="binlogçåå¥æºå¶" class="md-header-anchor"></a><span>binlogçåå¥æºå¶</span></h2><p><span>äºå¡æ§è¡è¿ç¨ä¸­ï¼åææ¥å¿åå°</span><code>binlog cache</code><span>ï¼äºå¡æäº¤ç æ¶åï¼åæbinlog cacheåå°binlogæä»¶ä¸­ã</span></p><p><span>ä¸ä¸ªäºå¡çbinlogæ¯ä¸è½è¢«æå¼çï¼</span></p><p><span> binlog_cache_sizeç¨äºæ§å¶åä¸ªçº¿ç¨ åbinlog cacheæå åå­çå¤§å°ï¼è¶è¿äºï¼å°±è¦æå­å°ç£çã</span></p><p><span>äºå¡æäº¤çæ¶åï¼æ§è¡å¨æbinlog cacheéçå®æ´äºå¡åå¥å°binlogä¸­ï¼å¹¶æ¸ç©ºbinlog cache</span></p><p><img src="Mysql 45è®².assets/image-20201120140305466.png" referrerpolicy="no-referrer" alt="image-20201120140305466"></p><ul><li><span>å¾ä¸­ç</span><strong><span>write</span></strong><span>ï¼æçå°±æ¯æææ¥å¿åå¥å°æä»¶ç³»ç»çpage cacheï¼å¹¶æ²¡æææ°æ®æä¹åå°ç£ çï¼æä»¥éåº¦æ¯è¾å¿«ã </span></li><li><span>å¾ä¸­ç</span><strong><span>fsync</span></strong><span>ï¼ææ¯å°æ°æ®æä¹åå°ç£ççæä½ãä¸è¬æåµä¸ï¼æä»¬è®¤ä¸ºfsyncæå ç£çç IOPSã</span></li></ul><p><span>write åfsyncçæ¶æºï¼æ¯ç±åæ°sync_binlogæ§å¶çï¼</span></p><ol start='' ><li><span>sync_binlog=</span><strong><span>0</span></strong><span>çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡æäº¤äºå¡é½åªwriteï¼</span><strong><span>ä¸</span></strong><span>fsyncï¼ </span></li><li><span>sync_binlog=</span><strong><span>1</span></strong><span>çæ¶åï¼è¡¨ç¤º</span><strong><span>æ¯æ¬¡</span></strong><span>æäº¤äºå¡é½ä¼æ§è¡fsyncï¼ </span></li><li><span>sync_binlog=</span><strong><span>N(N&gt;1)</span></strong><span>çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡æäº¤äºå¡é½writeï¼ä½ç´¯ç§¯Nä¸ªäºå¡åæfsyncã</span></li></ol><p><span>å¨åºç°IOç¶é¢çåºæ¯éï¼è®¾ç½®ä¸º100~1000ä¸­çæä¸ªæ°å¼ã</span></p><h2><a name="redo-logçåå¥æºå¶" class="md-header-anchor"></a><span>redo logçåå¥æºå¶</span></h2><p><span>äºå¡å¨æ§è¡è¿ç¨ä¸­ï¼çæçredo logæ¯è¦ååå°redo log bufferçã</span></p><p><img src="Mysql 45è®².assets/image-20201120140826163.png" referrerpolicy="no-referrer" alt="image-20201120140826163"></p><p><img src="Mysql 45è®².assets/image-20201120140958652.png" referrerpolicy="no-referrer" alt="image-20201120140958652"></p><p><img src="Mysql 45è®².assets/image-20201120141115292.png" referrerpolicy="no-referrer" alt="image-20201120141115292"></p><p><span>nnoDBæä¸ä¸ª</span><strong><span>åå°çº¿ç¨</span></strong><span>ï¼æ¯é1ç§ï¼å°±ä¼æredo log bufferä¸­çæ¥å¿ï¼è°ç¨writeåå°æä»¶ç³»ç»ç page cacheï¼ç¶åè°ç¨fsyncæä¹åå°ç£çã</span></p><p><span>ä¸ä¸ªæ²¡ææäº¤çäºå¡çredo logï¼ä¹æ¯å¯è½å·²ç»æä¹åå°ç£ ççã</span></p><p><span>é¤äºåå°çº¿ç¨æ¯ç§ä¸æ¬¡çè½®è¯¢æä½å¤ï¼è¿æä¸¤ç§åºæ¯ä¼è®©ä¸ä¸ªæ²¡ææäº¤çäºå¡çredo logåå¥å°ç£çä¸­ã</span></p><ul><li><span>ä¸ç§æ¯ï¼redo log bufferå ç¨çç©ºé´å³å°è¾¾å° </span><strong><span>innodb_log_buffer_sizeä¸å</span></strong><span>çæ¶åï¼ åå°çº¿ç¨ä¼ä¸»å¨åçãåçå¨ä½åªæ¯writeï¼è æ²¡æè°ç¨fsyncï¼ä¹å°±æ¯åªçå¨äºæä»¶ç³»ç»ç</span><strong><span>page cache</span></strong><span>ã</span></li></ul><ul><li><span>å¦ä¸ç§æ¯ï¼å¹¶è¡çäºå¡æäº¤çæ¶åï¼</span><strong><span>é¡ºå¸¦</span></strong><span>å°è¿ä¸ªäºå¡çredo log bufferæä¹åå°ç£ çã</span></li></ul><p><span>ä¸¤é¶æ®µæäº¤çæ¶åè¯´è¿ï¼æ¶åºä¸redo logåprepareï¼ ååbinlogï¼ æååæredo log commitã</span></p><p><span>æ</span><code>innodb_flush_log_at_trx_commit</code><span>è®¾ç½®æ1ï¼é£ä¹redo logå¨prepareé¶æ®µå°±è¦</span><strong><span>æä¹åä¸æ¬¡</span></strong><span>ï¼ å ä¸ºæä¸ä¸ªå´©æºæ¢å¤é»è¾æ¯è¦ä¾èµäºprepare çredo logï¼åå ä¸binlogæ¥æ¢å¤çã</span></p><p><span>è¯´MySQLçâå1âéç½®ï¼æçå°±æ¯</span><code>sync_binlog</code><span>å</span><code>innodb_flush_log_at_trx_commit</code><span>é½è®¾ ç½®æ 1ãä¹å°±æ¯è¯´ï¼ä¸ä¸ªäºå¡å®æ´æäº¤åï¼éè¦ç­å¾ä¸¤æ¬¡å·çï¼ä¸æ¬¡æ¯redo logï¼prepare é¶ æ®µï¼ï¼ä¸æ¬¡æ¯binlogã</span></p><h2><a name="ç»æäº¤group-commitï¼æºå¶" class="md-header-anchor"></a><span>ç»æäº¤ï¼group commitï¼æºå¶</span></h2><p><span>TPSæ¯æ¯ç§ä¸¤ä¸çè¯ï¼æ¯ç§å°±ä¼åå ä¸æ¬¡ç£çãä½æ¯ï¼æç¨å·¥å·æµè¯åºæ¥ï¼ç£çè½åä¹å°±ä¸¤ä¸å·¦å³ï¼æä¹è½å®ç°ä¸¤ä¸çTPSï¼</span></p><p><span>æ¥å¿é»è¾åºåå·ï¼log sequence numberï¼LSNï¼çæ¦å¿µãLSNæ¯åè° éå¢çï¼ç¨æ¥å¯¹åº</span><strong><span>redo log</span></strong><span>çä¸ä¸ªä¸ª</span><strong><span>åå¥ç¹</span></strong><span>ãæ¯æ¬¡åå¥é¿åº¦ä¸º</span><strong><span>length</span></strong><span>çredo logï¼ LSNçå¼å°±ä¼å  ä¸lengthã</span></p><p><span>LSNä¹ä¼åå°InnoDBçæ°æ®é¡µä¸­ï¼æ¥ç¡®ä¿æ°æ®é¡µä¸ä¼è¢«å¤æ¬¡æ§è¡éå¤çredo logã</span></p><p><span>ä¸ä¸ªå¹¶åäºå¡(trx1, trx2, trx3)å¨prepare é¶æ®µï¼é½åå®redo log bufferï¼LSNåå«æ¯50ã120 å160ã</span></p><p><img src="Mysql 45è®².assets/image-20201120151511293.png" referrerpolicy="no-referrer" alt="image-20201120151511293"></p><p><img src="Mysql 45è®².assets/image-20201120151604627.png" referrerpolicy="no-referrer" alt="image-20201120151604627"></p><p><img src="Mysql 45è®².assets/image-20201120151628120.png" referrerpolicy="no-referrer" alt="image-20201120151628120"></p><p><span>ä¸æ¬¡</span><strong><span>ç»æäº¤</span></strong><span>éé¢ï¼ç»åè¶å¤ï¼èçº¦ç£çIOPSçææè¶å¥½</span></p><p><span>ç¬¬ä¸ä¸ªäºå¡åå®redo log bufferä»¥åï¼æ¥ä¸æ¥è¿ä¸ªfsyncè¶æè°ç¨ï¼ç»åå¯è½ è¶å¤ï¼èçº¦IOPSçææå°±è¶å¥½ã</span></p><p><span>MySQLæä¸ä¸ªå¾æè¶£çä¼åï¼ææ¶é´</span></p><p><img src="Mysql 45è®².assets/image-20201120151759898.png" referrerpolicy="no-referrer" alt="image-20201120151759898"></p><p><img src="Mysql 45è®².assets/image-20201120151817839.png" referrerpolicy="no-referrer" alt="image-20201120151817839"></p><p><img src="Mysql 45è®².assets/image-20201120151835965.png" referrerpolicy="no-referrer" alt="image-20201120151835965"></p><p><span>ä¸è¿éå¸¸æåµä¸ç¬¬3æ­¥æ§è¡å¾ä¼å¾å¿«ï¼æä»¥binlogçwriteåfsyncé´çé´éæ¶é´ç­ï¼å¯¼è´è½éåå° ä¸èµ·æä¹åçbinlogæ¯è¾å°ï¼å æ­¤binlogçç»æäº¤çææéå¸¸ä¸å¦redo logçææé£ä¹å¥½ã</span></p><p><span>æ³æåbinlogç»æäº¤çææï¼å¯ä»¥éè¿è®¾ç½® binlog_group_commit_sync_delayå binlog_group_commit_sync_no_delay_countæ¥å®ç°ã</span></p><p><img src="Mysql 45è®².assets/image-20201120152110599.png" referrerpolicy="no-referrer" alt="image-20201120152110599"></p><h2><a name="walæºå¶ä¸»è¦å¾çäºä¸¤ä¸ªæ¹é¢" class="md-header-anchor"></a><span>WALæºå¶ä¸»è¦å¾çäºä¸¤ä¸ªæ¹é¢ï¼</span></h2><ol start='' ><li><span>redo log å binlogé½æ¯é¡ºåºåï¼ç£çç</span><strong><span>é¡ºåºå</span></strong><span>æ¯éæºåéåº¦è¦å¿«ï¼</span></li><li><strong><span>ç»æäº¤</span></strong><span>æºå¶ï¼å¯ä»¥å¤§å¹åº¦éä½ç£ççIOPSæ¶èã</span></li></ol><p><span>MySQLç°å¨åºç°äºæ§è½ç¶é¢ï¼èä¸ç¶é¢å¨IO ä¸ï¼å¯ä»¥éè¿åªäºæ¹æ³æ¥æåæ§è½å¢ï¼</span></p><p><span>éå¯¹è¿ä¸ªé®é¢ï¼å¯ä»¥èèä»¥ä¸ä¸ç§æ¹æ³ï¼ </span></p><ol start='' ><li><p><span>è®¾ç½® binlog_group_commit_sync_delayå binlog_group_commit_sync_no_delay_countå æ°ï¼</span><strong><span>åå°binlogçåçæ¬¡æ°</span></strong><span>ãè¿ä¸ªæ¹æ³æ¯åºäºâé¢å¤çææç­å¾âæ¥å®ç°çï¼å æ­¤å¯è½ä¼å¢å è¯­å¥ç</span><strong><span>ååºæ¶é´</span></strong><span>ï¼ä½æ²¡æä¸¢å¤±æ°æ®çé£é©ã </span></p></li><li><p><span>å°sync_binlog è®¾ç½®ä¸ºå¤§äº1çå¼ï¼æ¯è¾å¸¸è§æ¯100~1000ï¼ãè¿æ ·åçé£é©æ¯ï¼ä¸»æºæçµæ¶ ä¼ä¸¢binlogæ¥å¿ã </span></p></li><li><p><span>å°innodb_flush_log_at_trx_commitè®¾ç½®ä¸º2ãè¿æ ·åçé£é©æ¯ï¼ä¸»æºæçµçæ¶åä¼ä¸¢æ°æ®ã </span></p><p>&nbsp;</p></li></ol><p><span>æä¸å»ºè®®ä½ æinnodb_flush_log_at_trx_commit è®¾ç½®æ0ãå ä¸ºæè¿ä¸ªåæ°è®¾ç½®æ0ï¼è¡¨ç¤ºredo logåªä¿å­å¨åå­ä¸­ï¼è¿æ ·çè¯MySQLæ¬èº«å¼å¸¸éå¯ä¹ä¼ä¸¢æ°æ®ï¼é£é©å¤ªå¤§ã</span></p><p><span>èredo logåå°æ ä»¶ç³»ç»çpage cacheçéåº¦ä¹æ¯å¾å¿«çï¼æä»¥å°è¿ä¸ªåæ°è®¾ç½®æ2è·è®¾ç½®æ0å¶å®æ§è½å·®ä¸å¤ï¼ ä½è¿æ ·åMySQLå¼å¸¸éå¯æ¶å°±ä¸ä¼ä¸¢æ°æ®äºï¼ç¸æ¯ä¹ä¸é£é©ä¼æ´å°ã</span></p><h2><a name="å°ç»-n1197" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>updateè¯­å¥æ§è¡å®æåï¼InnoDBåªä¿è¯åå®äºredo logãåå­ï¼å¯è½è¿æ²¡æ¥å¾åå°æ°æ®åå°ç£çã</span></p><p><span>ä¸ºä»ä¹binlog cacheæ¯æ¯ä¸ªçº¿ç¨èªå·±ç»´æ¤çï¼èredo log bufferæ¯å¨å±å±ç¨çï¼</span></p><p><span>binlogæ¯ä¸è½âè¢«ææ­çâãä¸ä¸ªäºå¡çbinlogå¿é¡»è¿ç»­ åï¼å æ­¤è¦æ´ä¸ªäºå¡å®æåï¼åä¸èµ·åå°æä»¶éãredoæ¯æ°æ®pageï¼æä»¥å¯ä»¥ä¸èµ·</span></p><h2><a name="é®é¢-n1201" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>ä½ ççäº§åºè®¾ç½®çæ¯âå1âåï¼ å¦æå¹³æ¶æ¯çè¯ï¼ä½ æå¨ä»ä¹åºæ¯ä¸ æ¹æè¿âéå1âåï¼ä½ çè¿ä¸ªæä½åæ¯åºäºä»ä¹å³å®çï¼</span></p><p><img src="Mysql 45è®².assets/image-20201123104307632.png" referrerpolicy="no-referrer" alt="image-20201123104307632"></p><h1><a name="24--mysqlæ¯æä¹ä¿è¯ä¸»å¤ä¸è´ç" class="md-header-anchor"></a><span>24 | MySQLæ¯æä¹ä¿è¯ä¸»å¤ä¸è´çï¼</span></h1><h2><a name="mysqlä¸»å¤çåºæ¬åç" class="md-header-anchor"></a><span>MySQLä¸»å¤çåºæ¬åç</span></h2><p><img src="Mysql 45è®².assets/image-20201120153114454.png" referrerpolicy="no-referrer" alt="image-20201120153114454"></p><p><span>å¨ç¶æ1ä¸­ï¼è½ç¶èç¹Bæ²¡æè¢«ç´æ¥è®¿é®ï¼ä½æ¯æä¾ç¶å»ºè®®ä½ æèç¹Bï¼ä¹å°±æ¯å¤åºï¼è®¾ç½®æåªè¯» ï¼readonlyï¼æ¨¡å¼</span></p><p><img src="Mysql 45è®².assets/image-20201120153209068.png" referrerpolicy="no-referrer" alt="image-20201120153209068"></p><h3><a name="èç¹aå°bè¿æ¡çº¿çåé¨æµç¨æ¯ä»ä¹æ ·ç" class="md-header-anchor"></a><span>èç¹Aå°Bè¿æ¡çº¿çåé¨æµç¨æ¯ä»ä¹æ ·çã</span></h3><p><img src="Mysql 45è®².assets/image-20201120153314981.png" referrerpolicy="no-referrer" alt="image-20201120153314981"></p><p><span>ä¸»åºAåé¨æä¸ä¸ªçº¿ç¨ï¼ä¸é¨ç¨äºæå¡å¤åºBçè¿ä¸ªé¿è¿æ¥ãä¸ä¸ªäºå¡æ¥å¿åæ­¥çå®æ´è¿ç¨æ¯è¿æ ·çï¼</span></p><p><img src="Mysql 45è®².assets/image-20201120153502325.png" referrerpolicy="no-referrer" alt="image-20201120153502325"></p><p><span>åæ¥ç±äºå¤çº¿ç¨å¤å¶æ¹æ¡çå¼å¥ï¼sql_threadæ¼åæä¸ºäºå¤ä¸ªçº¿ç¨</span></p><h2><a name="binlogçä¸ç§æ ¼å¼å¯¹æ¯" class="md-header-anchor"></a><span>binlogçä¸ç§æ ¼å¼å¯¹æ¯</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">show</span> <span class="cm-keyword">binlog</span> <span class="cm-keyword">events</span> <span class="cm-keyword">in</span> <span class="cm-string">'master.000001'</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>æ¥çbinlog</span></p><h3><a name="statement" class="md-header-anchor"></a><span>statement</span></h3><p><span>binlogéé¢è®°å½çå°±æ¯SQLè¯­å¥çåæ</span></p><p><img src="Mysql 45è®².assets/image-20201120162850122.png" referrerpolicy="no-referrer" alt="image-20201120162850122"></p><p><img src="Mysql 45è®².assets/image-20201120163313419.png" referrerpolicy="no-referrer" alt="image-20201120163313419"></p><p><span>ä¸ºäºè¯´æstatement å rowæ ¼å¼çåºå«ï¼æä»¬æ¥çä¸ä¸è¿æ¡deleteå½ä»¤çæ§è¡ææå¾ï¼</span></p><p><img src="Mysql 45è®².assets/image-20201120163417791.png" referrerpolicy="no-referrer" alt="image-20201120163417791"></p><p><span>è¿è¡è¿æ¡deleteå½ä»¤äº§çäºä¸ä¸ªwarningï¼åå æ¯å½åbinlogè®¾ç½®çæ¯</span><code>statement</code><span>æ ¼ å¼ï¼å¹¶ä¸è¯­å¥ä¸­ælimitï¼æä»¥è¿ä¸ªå½ä»¤å¯è½æ¯unsafeçã</span></p><p><span>å¨</span><strong><span>ä¸»åº</span></strong><span> æ§è¡è¿æ¡SQLè¯­å¥çæ¶åï¼ç¨çæ¯</span><strong><span>ç´¢å¼a</span></strong><span>ï¼èå¨</span><strong><span>å¤åº</span></strong><span>æ§è¡è¿æ¡SQLè¯­å¥çæ¶åï¼å´ä½¿ç¨äº</span><strong><span>ç´¢å¼ t_modified</span></strong><span>ãå æ­¤ï¼MySQLè®¤ä¸ºè¿æ ·åæ¯æé£é©çã</span></p><h3><a name="row" class="md-header-anchor"></a><span>row</span></h3><p><img src="Mysql 45è®².assets/image-20201120163732376.png" referrerpolicy="no-referrer" alt="image-20201120163732376"></p><p><span>rowæ ¼å¼ çbinlogéæ²¡æäºSQLè¯­å¥çåæï¼èæ¯æ¿æ¢æäºä¸¤ä¸ªeventï¼Table_mapåDelete_rowsã</span></p><ol start='' ><li><span>Table_map eventï¼ç¨äºè¯´ææ¥ä¸æ¥è¦æä½çè¡¨æ¯teståºçè¡¨t; </span></li><li><span>Delete_rows eventï¼ç¨äºå®ä¹å é¤çè¡ä¸ºã</span></li></ol><p><span>è¿éè¦åå©</span><code>mysqlbinlog</code><span>å·¥å·ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysqlbinlog -vvdata/master<span class="cm-number">.000001</span> --<span class="cm-keyword">start</span>-position=<span class="cm-number">8900</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201120163925563.png" referrerpolicy="no-referrer" alt="image-20201120163925563"></p><p><img src="Mysql 45è®².assets/image-20201123102420185.png" referrerpolicy="no-referrer" alt="image-20201123102420185"></p><h3><a name="mixed" class="md-header-anchor"></a><span>mixed</span></h3><ul><li><span>statementæ ¼å¼çbinlogå¯è½ä¼å¯¼è´ä¸»å¤ä¸ä¸è´ï¼</span></li><li><span>rowæ ¼å¼çç¼ºç¹æ¯ï¼å¾å ç©ºé´</span></li><li><span>MySQLèªå·±ä¼å¤æ­è¿æ¡SQLè¯­å¥æ¯å¦å¯è½å¼èµ·ä¸»å¤ä¸ä¸è´</span></li></ul><p><span>ç°å¨è¶æ¥è¶å¤çåºæ¯è¦æ±æMySQLçbinlogæ ¼å¼è®¾ç½®ærowã</span></p><p><span>å¥½å¤ï¼</span><strong><span>æ¢å¤æ°æ®</span></strong><span>ã</span></p><p><img src="Mysql 45è®².assets/image-20201123103019184.png" referrerpolicy="no-referrer" alt="image-20201123103019184"></p><p><span>MariaDBç</span><code>Flashback</code><span>å·¥å·å°±æ¯åºäºä¸é¢ä»ç»çåçæ¥åæ»æ°æ®çã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; <span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> t <span class="cm-keyword">values</span>(<span class="cm-number">10</span>,<span class="cm-number">10</span>, now());</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201123103044983.png" referrerpolicy="no-referrer" alt="image-20201123103044983"></p><p><span>å±ç¶æ¯statementæ ¼å¼</span></p><p><span>åç¨mysqlbinlogå·¥å·æ¥ççï¼</span></p><p><img src="Mysql 45è®².assets/image-20201123103232389.png" referrerpolicy="no-referrer" alt="image-20201123103232389"></p><p><span>å¤è®°äºä¸æ¡å½ä»¤ï¼SET TIMESTAMP=1546103491ãä¸è®ºè¿ä¸ªbinlogæ¯1åéä¹åè¢«å¤åºæ§è¡ï¼è¿æ¯3å¤©åç¨æ¥æ¢å¤è¿ä¸ªåºçå¤ä»½ï¼è¿ä¸ªinsert è¯­å¥æå¥çè¡ï¼å¼é½æ¯åºå®çã</span></p><p><span>æä»¥ï¼ç¨binlogæ¥æ¢å¤æ°æ®çæ ååæ³æ¯ï¼ç¨ mysqlbinlogå·¥å·è§£æåºæ¥ï¼ç¶åæè§£æç»ææ´ä¸ªå ç»MySQLæ§è¡ã</span></p><h2><a name="å¾ªç¯å¤å¶é®é¢" class="md-header-anchor"></a><span>å¾ªç¯å¤å¶é®é¢</span></h2><p><span>å¾1ä¸­æç»çæ¯M-Sç»æï¼ä½å®éçäº§ä¸ä½¿ç¨æ¯è¾å¤çæ¯åMç»æ</span></p><p><img src="Mysql 45è®².assets/image-20201123103613634.png" referrerpolicy="no-referrer" alt="image-20201123103613634"></p><p><span>å¶å®åºå«åªæ¯å¤äºä¸æ¡çº¿ï¼å³ï¼èç¹AåB ä¹é´æ»æ¯äºä¸ºä¸»å¤å³ç³»ãè¿æ ·å¨åæ¢çæ¶åå°±ä¸ç¨åä¿®æ¹ä¸»å¤å³ç³»ã</span></p><p><img src="Mysql 45è®².assets/image-20201123104111000.png" referrerpolicy="no-referrer" alt="image-20201123104111000"></p><p><img src="Mysql 45è®².assets/image-20201123104118197.png" referrerpolicy="no-referrer" alt="image-20201123104118197"></p><h2><a name="å°ç»-n1262" class="md-header-anchor"></a><span>å°ç»</span></h2><h2><a name="é®é¢-n1263" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>æä»¬è¯´MySQLéè¿å¤æ­server idçæ¹å¼ï¼æ­ææ­»å¾ªç¯ãä½æ¯ï¼è¿ä¸ªæº å¶å¶å®å¹¶ä¸å®å¤ï¼å¨æäºåºæ¯ä¸ï¼è¿æ¯æå¯è½åºç°æ­»å¾ªç¯ã</span></p><ul><li><span>å¨ä¸ä¸ªä¸»åºæ´æ°äºå¡åï¼ç¨å½ä»¤set global server_id=xä¿®æ¹äºserver_idãç­æ¥å¿åä¼ åæ¥çæ¶åï¼åç°server_idè·èªå·±çserver_idä¸åï¼å°±åªè½æ§è¡äºã</span></li><li><span>trx1æ¯å¨èç¹ Bæ§è¡çï¼å æ­¤binlogä¸ç server_idå°±æ¯Bï¼binlogä¼ ç»èç¹ Aï¼ç¶åAåAâæ­å»ºäºåMç»æï¼å°±ä¼åºç°å¾ªç¯å¤å¶</span></li></ul><p><img src="Mysql 45è®².assets/image-20201124153727905.png" referrerpolicy="no-referrer" alt="image-20201124153727905"></p><p>&nbsp;</p><h1><a name="25--mysqlæ¯æä¹ä¿è¯é«å¯ç¨ç" class="md-header-anchor"></a><span>25 | MySQLæ¯æä¹ä¿è¯é«å¯ç¨çï¼</span></h1><p><img src="Mysql 45è®².assets/image-20201123104455618.png" referrerpolicy="no-referrer" alt="image-20201123104455618"></p><h2><a name="ä¸»å¤å»¶è¿" class="md-header-anchor"></a><span>ä¸»å¤å»¶è¿</span></h2><p><span>å¤åºBæ§è¡å®æ - Aåå¥binlog =ä¸»å¤å»¶è¿</span></p><p><code>show slave status</code><span>, seconds_behind_masterï¼ç¨äºè¡¨ç¤ºå½åå¤åºå»¶è¿äºå¤å°ç§</span></p><p><span>è®¡ç®æ¹æ³:</span></p><p><img src="Mysql 45è®².assets/image-20201123104734322.png" referrerpolicy="no-referrer" alt="image-20201123104734322"></p><p><span>ä¸»å¤å»¶è¿æç´æ¥çè¡¨ç°æ¯ï¼å¤åºæ¶è´¹ä¸­è½¬æ¥å¿ï¼relay logï¼çéåº¦ï¼æ¯ä¸»åºçäº§binlog çéåº¦è¦æ¢ã</span></p><h2><a name="ä¸»å¤å»¶è¿çæ¥" class="md-header-anchor"></a><span>ä¸»å¤å»¶è¿çæ¥</span></h2><p><strong><span>å¤åºæå¨æºå¨çæ§è½è¦æ¯ä¸»åºæå¨çæºå¨æ§è½å·®ã</span></strong></p><p><span>æä»¥ï¼åè¿ç§é¨ç½² æ¶ï¼ä¸è¬é½ä¼å°å¤åºè®¾ç½®ä¸ºâéå1âçæ¨¡å¼ã</span></p><p><span>è¿ç§é¨ç½²ç°å¨æ¯è¾å°äºãå ä¸ºä¸»å¤å¯è½åçåæ¢ï¼å¤åºéæ¶å¯è½åæä¸»åºï¼æä»¥ä¸»å¤åºé ç¨ç¸åè§æ ¼çæºå¨ï¼å¹¶ä¸å</span><strong><span>å¯¹ç§°é¨ç½²</span></strong><span>ï¼æ¯ç°å¨æ¯è¾å¸¸è§çæåµã</span></p><h3><a name="åäºå¯¹ç§°é¨ç½²ä»¥åè¿å¯è½ä¼æå»¶è¿è¿æ¯ä¸ºä»ä¹å¢" class="md-header-anchor"></a><span>åäºå¯¹ç§°é¨ç½²ä»¥åï¼è¿å¯è½ä¼æå»¶è¿ãè¿æ¯ä¸ºä»ä¹å¢ï¼</span></h3><p><strong><span>ç¬¬äºç§å¸¸è§çå¯è½äºï¼å³å¤åºçååå¤§</span></strong></p><ul><li><strong><span>ä¸ä¸»å¤ä»</span></strong><span>ãé¤äºå¤åºå¤ï¼å¯ä»¥å¤æ¥å ä¸ªä»åºï¼è®©è¿äºä»åºæ¥åæè¯»çåå</span></li><li><span>éè¿binlogè¾åºå°å¤é¨ç³»ç»ï¼æ¯å¦Hadoopè¿ç±»ç³»ç»ï¼è®©å¤é¨ç³»ç»æä¾ç»è®¡ç±»æ¥è¯¢çè½å</span></li></ul><h3><a name="è¿å°±æ¯ç¬¬ä¸ç§å¯è½äºå³å¤§äºå¡" class="md-header-anchor"></a><span>è¿å°±æ¯ç¬¬ä¸ç§å¯è½äºï¼å³å¤§äºå¡ã</span></h3><p><span>å ä¸ºä¸»åºä¸å¿é¡»ç­äºå¡æ§è¡å®ææä¼åå¥binlogï¼åä¼ ç»å¤åº</span></p><p><span>ä¸è¦</span><strong><span>ä¸æ¬¡æ§</span></strong><span>å°ç¨deleteè¯­å¥å é¤å¤ªå¤æ°æ®</span></p><p><span>ä¸äºå½æ¡£ç±»çæ°æ®ï¼å¹³æ¶æ²¡ææ³¨æå é¤åå²æ°æ®ï¼æä»¥ä¼å¨æä¸æ§è¡è¿äºå¤§éæ°æ®çå é¤æä½ã</span></p><p><span>å¦ä¸ç§å¸åçå¤§äºå¡åºæ¯ï¼å°±æ¯</span><strong><span>å¤§è¡¨DDL</span></strong></p><p><span>å¤çæ¹æ¡ å°±æ¯ï¼è®¡ååçDDLï¼å»ºè®®ä½¿ç¨gh-ostæ¹æ¡</span></p><h3><a name="å¦æä¸»åºä¸ä¹ä¸åå¤§äºå¡äºè¿æä»ä¹åå ä¼å¯¼è´ä¸»å¤å»¶è¿å" class="md-header-anchor"></a><span>å¦æä¸»åºä¸ä¹ä¸åå¤§äºå¡äºï¼è¿æä»ä¹åå ä¼å¯¼è´ä¸»å¤å»¶è¿åï¼</span></h3><p><strong><span>å¤åºçå¹¶è¡å¤å¶è½å</span></strong></p><p><span>ç±äºä¸»å¤å»¶è¿çå­å¨ï¼æä»¥å¨ä¸»å¤åæ¢çæ¶åï¼å°±ç¸åºçæä¸åçç­ç¥ã</span></p><h2><a name="ä¸»å¤åæ¢ç­ç¥" class="md-header-anchor"></a><span>ä¸»å¤åæ¢ç­ç¥</span></h2><h3><a name="å¯é æ§ä¼åç­ç¥" class="md-header-anchor"></a><span>å¯é æ§ä¼åç­ç¥</span></h3><p><img src="Mysql 45è®².assets/image-20201124145237761.png" referrerpolicy="no-referrer" alt="image-20201124145237761"></p><p><img src="Mysql 45è®².assets/image-20201124145519284.png" referrerpolicy="no-referrer" alt="image-20201124145519284"></p><p><span>æ­¥éª¤2ä¹å---&gt;æ­¥éª¤5 æ¯ä¸å¯åçç¶æ</span></p><h3><a name="å¯ç¨æ§ä¼åç­ç¥" class="md-header-anchor"></a><span>å¯ç¨æ§ä¼åç­ç¥</span></h3><p><span>å¯ç¨æ§ä¼åç­ç¥ï¼ä¸binlog_format=mixedæ¶</span></p><p><img src="Mysql 45è®².assets/image-20201124145654622.png" referrerpolicy="no-referrer" alt="image-20201124145654622"></p><p><span>ä¸»åºAåå¤åºBä¸åºç°äºä¸¤è¡ä¸ä¸è´çæ°æ®ã</span></p><p><span>å¯ç¨æ§ä¼åç­ç¥ï¼ä½è®¾ç½®</span><code>binlog_format=rowï¼</code></p><p><img src="Mysql 45è®².assets/image-20201124150128371.png" referrerpolicy="no-referrer" alt="image-20201124150128371"></p><ol start='' ><li><span>ä½¿ç¨rowæ ¼å¼çbinlogæ¶ï¼æ°æ®ä¸ä¸è´çé®é¢æ´å®¹æè¢«åç°</span></li><li><span>ä¸»å¤åæ¢çå¯ç¨æ§ä¼åç­ç¥ä¼å¯¼è´æ°æ®ä¸ä¸è´</span></li></ol><p><span>ææ²¡æåªç§æåµæ°æ®çå¯ç¨æ§ä¼åçº§æ´é«å¢ï¼</span></p><p><span>è®°å½æä½æ¥å¿</span></p><p><img src="Mysql 45è®².assets/image-20201124152241315.png" referrerpolicy="no-referrer" alt="image-20201124152241315"></p><h3><a name="å¯é æ§å¼å¸¸åæ¢" class="md-header-anchor"></a><span>å¯é æ§ï¼å¼å¸¸åæ¢</span></h3><p><span>ä¸»åºAåå¤åºBé´çä¸»å¤å»¶è¿æ¯30åéï¼è¿æ¶åä¸»åºAæçµäºï¼HAç³»ç»è¦åæ¢Bä½ä¸ºä¸» åºãæä»¬å¨ä¸»å¨åæ¢çæ¶åï¼å¯ä»¥ç­å°ä¸»å¤å»¶è¿å°äº5ç§çæ¶ååå¯å¨åæ¢ï¼ä½è¿æ¶åå·²ç»å«æ  éæ©äºã</span></p><p><img src="Mysql 45è®².assets/image-20201124152721597.png" referrerpolicy="no-referrer" alt="image-20201124152721597"></p><p><span>éç¨å¯é æ§ä¼åç­ç¥çè¯ï¼ä½ å°±å¿é¡»å¾ç­å°å¤åºBçseconds_behind_master=0ä¹åï¼æè½å æ¢ããä½ç°å¨çæåµæ¯ååæ´ä¸¥éï¼å¹¶ä¸æ¯ç³»ç»åªè¯»ãä¸å¯åçé®é¢äºï¼èæ¯ç³»ç»å¤äºå®å¨ä¸å¯ç¨ çç¶æãå ä¸ºï¼ä¸»åºAæçµåï¼æä»¬çè¿æ¥è¿æ²¡æåå°å¤åºBã</span></p><p><img src="Mysql 45è®².assets/image-20201124153048411.png" referrerpolicy="no-referrer" alt="image-20201124153048411"></p><h2><a name="å°ç»-n1325" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>ä»ç»äºMySQLé«å¯ç¨ç³»ç»çåºç¡ï¼å°±æ¯ä¸»å¤åæ¢é»è¾ãå ç§ä¼å¯¼è´ä¸»å¤å»¶è¿çæåµï¼ä»¥åç¸åºçæ¹è¿æ¹åã</span></p><h2><a name="é®é¢-n1327" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>ä¸è¬ç°å¨çæ°æ®åºè¿ç»´ç³»ç»é½æå¤åºå»¶è¿çæ§ï¼å¶å®å°±æ¯å¨å¤åºä¸æ§è¡ show slave statusï¼éé seconds_behind_masterçå¼ã</span></p><p><img src="Mysql 45è®².assets/image-20201124153204803.png" referrerpolicy="no-referrer" alt="image-20201124153204803"></p><p><span>ä»ä¹æåµï¼</span></p><p><img src="Mysql 45è®².assets/image-20201124155903802.png" referrerpolicy="no-referrer" alt="image-20201124155903802"></p><h1><a name="26--å¤åºä¸ºä»ä¹ä¼å»¶è¿å¥½å ä¸ªå°æ¶" class="md-header-anchor"></a><span>26 | å¤åºä¸ºä»ä¹ä¼å»¶è¿å¥½å ä¸ªå°æ¶ï¼</span></h1><p><span>å¤åºå¹¶è¡å¤å¶è½åã</span></p><p><img src="Mysql 45è®².assets/image-20201124154229280.png" referrerpolicy="no-referrer" alt="image-20201124154229280"></p><p><span>æä»¬è¦å³æ³¨çæ¯å¾ä¸­é»è²çä¸¤ä¸ªç®­å¤´ãä¸ä¸ªç®­å¤´ä»£è¡¨äºå®¢æ·ç«¯åå¥ä¸» åºï¼å¦ä¸ç®­å¤´ä»£è¡¨çæ¯å¤åºä¸sql_threadæ§è¡ä¸­è½¬æ¥å¿ï¼relay logï¼ã</span></p><p><span>å¨å®æ¹ç5.6çæ¬ä¹åï¼MySQLåªæ¯æ</span><strong><span>åçº¿ç¨å¤å¶</span></strong><span>ï¼ç±æ­¤å¨ä¸»åºå¹¶åé«ãTPSé«æ¶å°±ä¼åºç°ä¸¥é çä¸»å¤å»¶è¿é®é¢ã</span></p><p><span>å¶å®è¯´å°åºï¼ææç</span><strong><span>å¤çº¿ç¨å¤å¶</span></strong><span>æºå¶ï¼é½æ¯è¦æå¾1ä¸­åªæä¸ä¸ªçº¿ç¨çsql_threadï¼ææå¤ä¸ªçº¿ ç¨ï¼ä¹å°±æ¯é½ç¬¦åä¸é¢çè¿ä¸ªæ¨¡åï¼</span></p><p><img src="Mysql 45è®².assets/image-20201124154332370.png" referrerpolicy="no-referrer" alt="image-20201124154332370"></p><p><span>workçº¿ç¨çä¸ªæ°ï¼å°±æ¯ç±åæ° slave_parallel_workerså³å®çãæ ¹æ®æçç»éªï¼æè¿ä¸ªå¼è®¾ç½®ä¸º8~16ä¹é´æå¥½ï¼ï¼32æ ¸ç©çæºç æåµï¼ï¼æ¯ç«å¤åºè¿æå¯è½è¦æä¾è¯»æ¥è¯¢ï¼ä¸è½æCPUé½ååäºã</span></p><p><span>coordinatorå¨ååçæ¶åï¼éè¦æ»¡è¶³ä»¥ä¸è¿</span><strong><span>ä¸¤ä¸ªåºæ¬è¦æ±</span></strong><span>ï¼</span></p><ol start='' ><li><span>ä¸è½é ææ´æ°è¦çãè¿å°±è¦æ±æ´æ°åä¸è¡çä¸¤ä¸ªäºå¡ï¼å¿é¡»è¢«ååå°åä¸ä¸ªworkerä¸­ã</span></li><li><span>åä¸ä¸ªäºå¡ä¸è½è¢«æå¼ï¼å¿é¡»æ¾å°åä¸ä¸ªworkerä¸­ã</span></li></ol><p><strong><span>æ²¡åå®</span></strong></p><p><img src="Mysql 45è®².assets/image-20201130171755445.png" referrerpolicy="no-referrer" alt="image-20201130171755445"></p><h1><a name="27--ä¸»åºåºé®é¢äºä»åºæä¹å" class="md-header-anchor"></a><span>27 | ä¸»åºåºé®é¢äºï¼ä»åºæä¹åï¼</span></h1><p><img src="Mysql 45è®².assets/image-20201126164914926.png" referrerpolicy="no-referrer" alt="image-20201126164914926"></p><p><span>èçº¿ç®­å¤´è¡¨ç¤ºçæ¯ä¸»å¤å³ç³»ï¼ä¹å°±æ¯AåAâäºä¸ºä¸»å¤ï¼ ä»åºBãCãDæåçæ¯ä¸»åºAãä¸ ä¸»å¤ä»çè®¾ç½®</span></p><h2><a name="åºäºä½ç¹çä¸»å¤åæ¢ä¸»å" class="md-header-anchor"></a><span>åºäºä½ç¹çä¸»å¤åæ¢(ä¸»å)</span></h2><p><span>èç¹Bè®¾ç½®æèç¹Aâçä»åºï¼éè¦æ§è¡ä¸æ¡change masterå½ä»¤</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CHANGE</span> <span class="cm-keyword">MASTER</span> <span class="cm-keyword">TO</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_HOST=$host_name</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_PORT=$port</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_USER=$user_name</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_PASSWORD=$password</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_LOG_FILE=$master_log_name</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_LOG_POS=$master_log_pos</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><p><span>æåä¸¤ä¸ªåæ°</span><strong><span>ä¸»åº</span></strong><span>å¯¹åºç</span><strong><span>æä»¶å</span></strong><span>å</span><strong><span>æ¥å¿åç§»é</span></strong><span>ã</span></p><p><img src="Mysql 45è®².assets/image-20201126171908819.png" referrerpolicy="no-referrer" alt="image-20201126171908819"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysqlbinlog File --stop-<span class="cm-builtin">datetime</span>=T --<span class="cm-keyword">start</span>-<span class="cm-builtin">datetime</span>=T</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201126171940238.png" referrerpolicy="no-referrer" alt="image-20201126171940238"></p><p><span>end_log_posåé¢çå¼â123âï¼è¡¨ç¤ºçå°±æ¯Aâè¿ä¸ªå®ä¾ï¼å¨Tæ¶å»åå¥æ°çbinlogçä½ç½®ã ç¶åï¼æä»¬å°±å¯ä»¥æ123è¿ä¸ªå¼ä½ä¸º$master_log_pos ï¼ç¨å¨èç¹Bçchange masterå½ä»¤éã</span></p><p><img src="Mysql 45è®².assets/image-20201126172041100.png" referrerpolicy="no-referrer" alt="image-20201126172041100"></p><p><span>ä¸¤ä¸ªé½æ§è¡äºï¼åçä¸»é®å²çª</span></p><h3><a name="ä¸ç§åæ³æ¯" class="md-header-anchor"></a><span>ä¸ç§åæ³æ¯</span></h3><p><span>ä¸»å¨è·³è¿ä¸ä¸ªäºå¡ãè·³è¿å½ä»¤çåæ³æ¯ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">set</span> <span class="cm-keyword">global</span> sql_slave_skip_counter=<span class="cm-number">1</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">start</span> <span class="cm-keyword">slave</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><h3><a name="å¦å¤ä¸ç§æ¹å¼æ¯" class="md-header-anchor"></a><span>å¦å¤ä¸ç§æ¹å¼æ¯</span></h3><p><span>éè¿è®¾ç½®slave_skip_errorsåæ°ï¼ç´æ¥è®¾ç½®è·³è¿æå®çéè¯¯ã</span></p><p><img src="Mysql 45è®².assets/image-20201126172153898.png" referrerpolicy="no-referrer" alt="image-20201126172153898"></p><h2><a name="gtid" class="md-header-anchor"></a><span>GTID</span></h2><p><span>MySQL 5.6 çæ¬å¼å¥äºGTIDï¼å½»åºè§£å³äºè¿ä¸¤ç§æä½é½å¾å¤æï¼èä¸å®¹æåºé</span></p><p><span>GTIDçå¨ç§°æ¯Global Transaction Identifierï¼ä¹å°±æ¯å¨å±äºå¡IDDï¼æ¯ä¸ä¸ªäºå¡å¨</span><strong><span>æäº¤</span></strong><span>çæ¶åçæ çï¼æ¯è¿ä¸ªäºå¡çå¯ä¸æ è¯ãå®ç±ä¸¤é¨åç»æï¼æ ¼å¼æ¯ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GTID=source_id:transaction_id</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>å®ä¾ç¬¬ä¸æ¬¡å¯å¨æ¶èªå¨çæçï¼æ¯ä¸ä¸ªå¨å±å¯ä¸çå¼</span></p><p><span>gnoæ¯ä¸ä¸ªæ´æ°ï¼åå§å¼æ¯1ï¼æ¯æ¬¡æäº¤äºå¡çæ¶ååéç»è¿ä¸ªäºå¡ï¼å¹¶å 1ã</span></p><p><span>MySQLéé¢æä»¬è¯´transaction_idå°±æ¯æäºå¡idï¼äºå¡idæ¯å¨äºå¡</span><strong><span>æ§è¡è¿ç¨</span></strong><span>ä¸­åéçï¼å¦ æè¿ä¸ªäºå¡åæ»äºï¼äºå¡idä¹ä¼éå¢ï¼èè¿ä¸ªæ¯å¨äºå¡</span><strong><span>æäº¤</span></strong><span>çæ¶åæä¼åéã</span></p><h3><a name="gtidæ¨¡å¼çå¯å¨" class="md-header-anchor"></a><span>GTIDæ¨¡å¼çå¯å¨</span></h3><p><span>å¯å¨ä¸ä¸ªMySQLå®ä¾çæ¶åï¼å ä¸åæ°gtid_mode=on åenforce_gtid_consistency=on</span></p><h3><a name="gtidæä¸¤ç§çææ¹å¼" class="md-header-anchor"></a><span>GTIDæä¸¤ç§çææ¹å¼</span></h3><p><span>åå³äºsessionåégtid_nextçå¼</span></p><p><img src="Mysql 45è®².assets/image-20201130162217063.png" referrerpolicy="no-referrer" alt="image-20201130162217063"></p><p><span>æ¯ä¸ªMySQLå®ä¾é½ç»´æ¤äº</span><strong><span>ä¸ä¸ªGTIDéå</span></strong><span>ï¼ç¨æ¥å¯¹åºâè¿ä¸ªå®ä¾æ§è¡è¿çææäºå¡âã</span></p><p><img src="Mysql 45è®².assets/image-20201130162852068.png" referrerpolicy="no-referrer" alt="image-20201130162852068"></p><p><span>å®ä¾Xæ¯å¦å¤ä¸ä¸ªå®ä¾Yçä»åºï¼å¹¶ä¸æ­¤æ¶å¨å®ä¾Yä¸æ§è¡äºä¸é¢è¿æ¡æå¥è¯­å¥ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> t <span class="cm-keyword">values</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>å¨å®ä¾Yä¸çGTIDæ¯ âaaaaaaaa-cccc-dddd-eeee-ffffffffffff:10â</span></p><p><span>å®ä¾Xä½ä¸ºYçä»åºï¼å°±è¦åæ­¥è¿ä¸ªäºå¡è¿æ¥æ§è¡ï¼æ¾ç¶ä¼åºç°</span><strong><span>ä¸»é®å²çª</span></strong><span>ï¼å¯¼è´å®ä¾Xçå æ­¥çº¿ç¨åæ­¢ãè¿æ¶ï¼æä»¬åºè¯¥æä¹å¤çå¢ï¼</span></p><p><img src="Mysql 45è®².assets/image-20201130163059203.png" referrerpolicy="no-referrer" alt="image-20201130163059203"></p><p><img src="Mysql 45è®².assets/image-20201130163117106.png" referrerpolicy="no-referrer" alt="image-20201130163117106"></p><p><span>å¯ä»¥çå°å®ä¾XçExecuted_Gtid_setéé¢ï¼å·²ç»å å¥äºè¿ä¸ªGTIDã</span></p><h2><a name="åºäºgtidçä¸»å¤åæ¢å¤å" class="md-header-anchor"></a><span>åºäºGTIDçä¸»å¤åæ¢(å¤å)</span></h2><h3><a name="ä¸»å¤åºæ¯" class="md-header-anchor"></a><span>ä¸»å¤åºæ¯</span></h3><p><strong><span>å¤åºB</span></strong><span>è¦è®¾ç½®ä¸º</span><strong><span>æ°ä¸»åºAâ</span></strong><span>çä»åºçè¯­æ³å¦ä¸ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CHANGE</span> <span class="cm-keyword">MASTER</span> <span class="cm-keyword">TO</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_HOST=$host_name</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_PORT=$port</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_USER=$user_name</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MASTER_PASSWORD=$password</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">master_auto_position=<span class="cm-number">1</span> // GTIDåè®®</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201130165542498.png" referrerpolicy="no-referrer" alt="image-20201130165542498"></p><p><strong><span>å¿é¡»ä¿è¯ä¸»åºåç»å¤åºçæ¥å¿æ¯å®æ´ç</span></strong></p><p><span>è¿è·åºäºä½ç¹çä¸»å¤åè®®ä¸åãåºäºä½ç¹çåè®®ï¼æ¯ç±å¤åºå³å®çï¼å¤åºæå®åªä¸ªä½ç¹ï¼ä¸»åºå°± ååªä¸ªä½ç¹ï¼</span><strong><span>ä¸åæ¥å¿çå®æ´æ§å¤æ­</span></strong><span>ã</span></p><h3><a name="ä¸ä¸»å¤ä»çåæ¢åºæ¯ä¸" class="md-header-anchor"></a><span>ä¸ä¸»å¤ä»çåæ¢åºæ¯ä¸</span></h3><p><span>ç±äºä¸éè¦æ¾ä½ç¹äºï¼æä»¥ä»åºBãCãDåªéè¦</span><strong><span>åå«æ§è¡</span></strong><span>change masterå½ä»¤æåå®ä¾Aâå³å¯ã</span></p><p><span>ä¸»åºAâçèªå·±çæçbinlogä¸­çGTIDéåæ ¼å¼æ¯ï¼ server_uuid_of_Aâ:1-Mã</span></p><p><span>ä¹åä»åºBçGTIDéåæ ¼å¼æ¯ server_uuid_of_A:1-Nï¼åæ¢ä¹åï¼å æäºserver_uuid_of_A:1-N, server_uuid_of_Aâ:1-M</span></p><h2><a name="gtidåå¨çº¿ddl" class="md-header-anchor"></a><span>GTIDåå¨çº¿DDL</span></h2><p><span>å½åä¸»åºæ¯Xï¼å¹¶ä¸é½æå¼äºGTIDæ¨¡ å¼ãè¿æ¶çä¸»å¤åæ¢æµç¨å¯ä»¥åæä¸é¢è¿æ ·ï¼</span></p><ul><li><span>å¨å®ä¾Xä¸æ§è¡stop slaveã</span></li><li><span>å¨å®ä¾Yä¸æ§è¡DDLè¯­å¥ãæ³¨æï¼è¿éå¹¶ä¸éè¦å³é­binlogã </span></li><li><span>æ§è¡å®æåï¼æ¥åºè¿ä¸ªDDLè¯­å¥å¯¹åºçGTIDï¼å¹¶è®°ä¸º server_uuid_of_Y:gnoã</span></li><li><span>å°å®ä¾Xä¸æ§è¡ä»¥ä¸è¯­å¥åºåï¼</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">set</span> GTID_NEXT=<span class="cm-string">"server_uuid_of_Y:gno"</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">begin</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">commit</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">set</span> gtid_next=automatic;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">start</span> <span class="cm-keyword">slave</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ul><li><span>å®ä¾Yçæ´æ°æbinlogè®°å½ï¼åæ¶ä¹å¯ä»¥ç¡®ä¿ä¸ä¼å¨å®ä¾Xä¸æ§è¡è¿</span>
<span>æ¡æ´æ°ã</span></li></ul><p><img src="Mysql 45è®².assets/image-20201130171250648.png" referrerpolicy="no-referrer" alt="image-20201130171250648"></p><p><span>å®ä¾Yçæ´æ°æbinlogè®°å½ï¼åæ¶ä¹å¯ä»¥ç¡®ä¿ä¸ä¼å¨å®ä¾Xä¸æ§è¡è¿ æ¡æ´æ°ã</span></p><h2><a name="å°ç»-n1416" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>ä½ ä»ç»äºä¸ä¸»å¤ä»çä¸»å¤åæ¢æµç¨ï¼ä»ç»äºGTIDçåºæ¬æ¦å¿µ åç¨æ³ã</span></p><h2><a name="é®é¢-n1418" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>ä½ å¨GTIDæ¨¡å¼ä¸è®¾ç½®ä¸»ä»å³ç³»çæ¶åï¼ä»åºæ§è¡start slaveå½ä»¤åï¼ä¸»åºåç°</span><strong><span>éè¦çbinlogå·²ç» è¢«å é¤æ</span></strong><span>äºï¼å¯¼è´ä¸»å¤åå»ºä¸æåãè¿ç§æåµä¸ï¼ä½ è§å¾å¯ä»¥æä¹å¤çå¢ï¼</span></p><h1><a name="28--è¯»ååç¦»æåªäºå" class="md-header-anchor"></a><span>28 | è¯»ååç¦»æåªäºåï¼</span></h1><p><img src="Mysql 45è®².assets/image-20201125113447147.png" referrerpolicy="no-referrer" alt="image-20201125113447147"></p><p><img src="Mysql 45è®².assets/image-20201125113527022.png" referrerpolicy="no-referrer" alt="image-20201125113527022"></p><h2><a name="æä¹å¤çè¿æè¯»" class="md-header-anchor"></a><span>æä¹å¤çè¿æè¯»</span></h2><ul><li><span>å¼ºå¶èµ°ä¸»åºæ¹æ¡ï¼ </span></li><li><span>sleepæ¹æ¡ï¼ </span></li><li><span>å¤æ­ä¸»å¤æ å»¶è¿æ¹æ¡ï¼</span></li><li><span>éåsemi-syncæ¹æ¡ï¼ </span></li><li><span>ç­ä¸»åºä½ç¹æ¹æ¡ï¼</span></li><li><span>ç­GTIDæ¹æ¡ã</span></li></ul><h3><a name="å¼ºå¶èµ°ä¸»åºæ¹æ¡" class="md-header-anchor"></a><span>å¼ºå¶èµ°ä¸»åºæ¹æ¡</span></h3><p><span>âæææ¥è¯¢é½ä¸è½æ¯è¿æè¯»âçéæ±ï¼æ¯å¦ä¸äº éèç±»çä¸å¡ãè¿æ ·çè¯ï¼ä½ å°±è¦æ¾å¼è¯»ååç¦»</span></p><h3><a name="sleep-æ¹æ¡" class="md-header-anchor"></a><span>Sleep æ¹æ¡</span></h3><p><span>ä¸»åºæ´æ°åï¼è¯»ä»åºä¹ååsleepä¸ä¸ãç±»ä¼¼äºæ§è¡ä¸æ¡select sleep(1)å½ä»¤ã</span></p><p><span>ä¸ºäºçèµ·æ¥æ´é è°±å¿ï¼æä»¬å¯ä»¥æ¢ä¸ç§æ¹å¼ã</span></p><p><span>åååå¸åï¼ç¨Ajaxï¼Asynchronous JavaScript +XMLï¼å¼æ­¥JavaScript åXMLï¼ç´æ¥æå®¢æ·ç«¯è¾å¥çåå®¹ä½ä¸ºâæ°çååâæ¾</span><strong><span>ç¤ºå¨é¡µé¢ä¸</span></strong><span>ï¼èä¸æ¯çæ­£å°å»æ°æ®åºåæ¥ è¯¢ã</span></p><h3><a name="å¤æ­ä¸»å¤æ å»¶è¿æ¹æ¡" class="md-header-anchor"></a><span>å¤æ­ä¸»å¤æ å»¶è¿æ¹æ¡</span></h3><p><span>æä»¬ç¥é</span><code>show slave status</code><span>ç»æéçseconds_behind_masteråæ°ç å¼ï¼å¯ä»¥ç¨æ¥è¡¡éä¸»å¤å»¶è¿æ¶é´çé¿ç­ã</span></p><p><img src="Mysql 45è®².assets/image-20201125114525179.png" referrerpolicy="no-referrer" alt="image-20201125114525179"></p><h4><a name="ç¬¬ä¸ç§ç¡®ä¿ä¸»å¤æ å»¶è¿çæ¹æ³æ¯" class="md-header-anchor"></a><strong><span>ç¬¬ä¸ç§ç¡®ä¿ä¸»å¤æ å»¶è¿çæ¹æ³æ¯</span></strong><span>ï¼</span></h4><p><span>æ¯æ¬¡ä»åºæ§è¡æ¥è¯¢è¯·æ±åï¼åå¤æ­ </span><strong><span>seconds_behind_master</span></strong><span>==</span><strong><span>ç­äº0</span></strong><span>ãå¦æè¿ä¸ç­äº0 ï¼é£å°±å¿é¡»ç­å°è¿ä¸ªåæ°åä¸º0æè½æ§è¡æ¥è¯¢è¯·æ±ã</span></p><h4><a name="ç¬¬äºç§æ¹æ³å¯¹æ¯ä½ç¹ç¡®ä¿ä¸»å¤æ å»¶è¿" class="md-header-anchor"></a><strong><span>ç¬¬äºç§æ¹æ³ï¼å¯¹æ¯ä½ç¹ç¡®ä¿ä¸»å¤æ å»¶è¿</span></strong><span>ï¼</span></h4><p><img src="Mysql 45è®².assets/image-20201125114425441.png" referrerpolicy="no-referrer" alt="image-20201125114425441"></p><h4><a name="ç¬¬ä¸ç§æ¹æ³å¯¹æ¯gtidéåç¡®ä¿ä¸»å¤æ å»¶è¿" class="md-header-anchor"></a><span>ç¬¬ä¸ç§æ¹æ³ï¼å¯¹æ¯GTIDéåç¡®ä¿ä¸»å¤æ å»¶è¿ï¼</span></h4><p><img src="Mysql 45è®².assets/image-20201125114454290.png" referrerpolicy="no-referrer" alt="image-20201125114454290"></p><p><span>å¯¹æ¯ä½ç¹åå¯¹æ¯GTIDè¿ä¸¤ç§æ¹æ³ï¼é½è¦æ¯å¤æ­seconds_behind_masteræ¯å¦ä¸º0æ´åç¡®ã</span></p><p><span>å¨æ§è¡æ¥è¯¢è¯·æ±ä¹åï¼åå¤æ­ä»åºæ¯å¦åæ­¥å®æçæ¹æ³ï¼ç¸æ¯äºsleepæ¹æ¡ï¼åç¡®åº¦ç¡®å®æåäº ä¸å°ï¼ä½è¿æ¯æ²¡æè¾¾å°âç²¾ç¡®âçç¨åº¦ãä¸ºä»ä¹è¿ä¹è¯´å¢ï¼</span></p><p><img src="Mysql 45è®².assets/image-20201125140402385.png" referrerpolicy="no-referrer" alt="image-20201125140402385"></p><p><span>å¦æè¿æ¶åä½ å¨ä»åºBä¸æ§è¡æ¥è¯¢è¯·æ±ï¼æç§æä»¬ä¸é¢çé»è¾ï¼ä»åºè®¤ä¸ºå·²ç»</span><strong><span>æ²¡æåæ­¥å»¶è¿</span></strong><span>ï¼ä½ è¿æ¯</span><strong><span>æ¥ä¸å°trx3</span></strong><span>çãä¸¥æ ¼å°è¯´ï¼å°±æ¯åºç°äºè¿æè¯»ã</span></p><h3><a name="éåsemi-sync" class="md-header-anchor"></a><span>éåsemi-sync</span></h3><p><img src="Mysql 45è®².assets/image-20201125140127635.png" referrerpolicy="no-referrer" alt="image-20201125140127635"></p><p><span>æåå­¦é®å°ï¼å¦æä¸»åºæçµçæ¶åï¼æäºbinlogè¿æ¥ä¸ååç»ä»åºï¼ä¼ ä¸ä¼å¯¼è´ç³»ç»æ°æ®ä¸¢å¤±ï¼</span></p><p><span>semi-syncéååé¢å³äºä½ç¹çå¤æ­</span></p><p><span>ä½æ¯ï¼semi-sync+ä½ç¹å¤æ­çæ¹æ¡ï¼åªå¯¹</span><strong><span>ä¸ä¸»ä¸å¤</span></strong><span>çåºæ¯æ¯æç«çã</span></p><p><span>å¦å¤ä¸ä¸ªæ½å¨çé®é¢ï¼ä¸å¡æ´æ°çé«å³°æï¼ä¸»åºçä½ ç¹æèGTIDéåæ´æ°å¾å¿«ï¼é£ä¹ä¸é¢çä¸¤ä¸ªä½ç¹ç­å¼å¤æ­å°±ä¼ä¸ç´ä¸æç«ï¼å¾å¯è½åºç°ä»åºä¸ è¿è¿æ æ³ååºæ¥è¯¢è¯·æ±çæåµã</span></p><p><img src="Mysql 45è®².assets/image-20201125140649638.png" referrerpolicy="no-referrer" alt="image-20201125140649638"></p><p><span>å¶å® å¹¶ä¸éè¦ç­å°âä¸»å¤å®å¨åæ­¥âã</span></p><p><span>semi-syncéåå¤æ­ä¸»å¤æ å»¶è¿çæ¹æ¡ï¼å­å¨ä¸¤ä¸ªé®é¢ï¼</span></p><ul><li><span>ä¸ä¸»å¤ä»çæ¶åï¼å¨æäºä»åºæ§è¡æ¥è¯¢è¯·æ±ä¼å­å¨è¿æè¯»çç°è±¡ï¼</span></li><li><span>å¨æç»­å»¶è¿çæåµä¸ï¼å¯è½åºç°è¿åº¦ç­å¾çé®é¢ã</span></li></ul><h3><a name="ç­ä¸»åºä½ç¹æ¹æ¡" class="md-header-anchor"></a><span>ç­ä¸»åºä½ç¹æ¹æ¡</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> master_pos_wait(file, pos[, timeout]);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><span>å®æ¯å¨ä»åºæ§è¡çï¼</span></li><li><span>åæ°fileåposæçæ¯ä¸»åºä¸çæä»¶ååä½ç½®ï¼</span></li><li><span>timeoutå¯éï¼è®¾ç½®ä¸ºæ­£æ´æ°Nè¡¨ç¤ºè¿ä¸ªå½æ°æå¤ç­å¾Nç§ã</span></li></ol><p><img src="Mysql 45è®².assets/image-20201125141002417.png" referrerpolicy="no-referrer" alt="image-20201125141002417"></p><p><img src="Mysql 45è®².assets/image-20201125141026062.png" referrerpolicy="no-referrer" alt="image-20201125141026062"></p><p><span>æç§æä»¬è®¾å®ä¸åè®¸è¿æè¯»çè¦æ±ï¼å°±åªæä¸¤ç§éæ©ï¼ä¸ç§æ¯è¶æ¶æ¾å¼ï¼ä¸ç§æ¯è½¬å°ä¸»åº æ¥è¯¢ãå·ä½æä¹éæ©ï¼å°±éè¦ä¸å¡å¼ååå­¦åå¥½</span><strong><span>éæµç­ç¥äº</span></strong><span>ã</span></p><h3><a name="gtidæ¹æ¡" class="md-header-anchor"></a><span>GTIDæ¹æ¡</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> wait_for_executed_gtid_set(gtid_set, <span class="cm-number">1</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201125141145033.png" referrerpolicy="no-referrer" alt="image-20201125141145033"></p><p><span>å¨åé¢ç­ä½ç¹çæ¹æ¡ä¸­ï¼æä»¬æ§è¡å®äºå¡åï¼è¿è¦</span><strong><span>ä¸»å¨å»ä¸»åº</span></strong><span>æ§è¡show master statusãè MySQL 5.7.6çæ¬å¼å§ï¼åè®¸å¨æ§è¡å®æ´æ°ç±»äºå¡åï¼æè¿ä¸ªäºå¡çGTIDè¿åç»å®¢æ·ç«¯ï¼è¿æ · ç­GTIDçæ¹æ¡å°±å¯ä»¥</span><strong><span>åå°ä¸æ¬¡æ¥è¯¢</span></strong><span>ã</span></p><p><img src="Mysql 45è®².assets/image-20201125141304875.png" referrerpolicy="no-referrer" alt="image-20201125141304875"></p><p><span>trx1äºå¡æ´æ°å®æåï¼ä»è¿ååç´æ¥è·åè¿ä¸ªäºå¡çGTID</span></p><p><span>å°åæ°</span><code>session_track_gtids</code><span>è®¾ç½®ä¸º</span><strong><span>OWN_GTID</span></strong><span>ï¼ç¶åéè¿APIæ¥å£ </span><code>mysql_session_track_get_first</code><span>ä»è¿ååè§£æåºGTIDçå¼å³å¯ã</span></p><p><span>MySQLå¹¶æ²¡ææä¾è¿ç±»æ¥å£çSQLç¨æ³ï¼æ¯æä¾ç»ç¨åºç API</span></p><p><span>ä¸ºäºè®©å®¢æ·ç«¯å¨äºå¡æäº¤åï¼è¿åçGITDè½å¤å¨å®¢æ·ç«¯æ¾ç¤ºåºæ¥ï¼æå¯¹MySQLå®¢æ·ç«¯ä»£ ç åäºç¹ä¿®æ¹ï¼</span></p><p><img src="Mysql 45è®².assets/image-20201125141535704.png" referrerpolicy="no-referrer" alt="image-20201125141535704"></p><h2><a name="å°ç»-n1492" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>å³ä½¿æ¯æåç­å¾ä½ç¹åç­å¾GTIDè¿ä¸¤ä¸ªæ¹æ¡ï¼è½ç¶çä¸å»æ¯è¾é è°±å¿ï¼ä½ä»ç¶å­å¨éè¦æè¡¡ç æåµãå¦æææçä»åºé½å»¶è¿ï¼é£ä¹è¯·æ±å°±ä¼å¨é¨è½å°ä¸»åºä¸ï¼è¿æ¶åä¼ä¸ä¼ç±äºååçªç¶å¢ å¤§ï¼æä¸»åºææäºå¢ï¼</span></p><p><span>ä½è¯è¯´åæ¥ï¼è¿æè¯»å¨æ¬è´¨ä¸æ¯ç±ä¸åå¤è¯»å¯¼è´çãå¨å®éåºç¨ä¸­ï¼å¯è½ä¼æå«çä¸éè¦ç­å¾å°±å¯ä»¥æ°´å¹³æ©å±çæ°æ®åºæ¹æ¡ï¼ä½è¿å¾å¾æ¯ç¨çºç²åæ§è½æ¢æ¥çï¼ä¹å°±æ¯éè¦å¨è¯»æ§è½ååæ§è½ä¸­åæè¡¡ã</span></p><h2><a name="é®é¢-n1495" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>GTIDçæ¹æ¡ï¼ç°å¨ä½ è¦å¯¹ä¸»åºç ä¸å¼ å¤§è¡¨åDDLï¼å¯è½ä¼åºç°ä»ä¹æåµå¢ï¼ä¸ºäºé¿åè¿ç§æåµï¼ä½ ä¼æä¹åå¢ï¼</span></p><p><span>è¿æ¡è¯­å¥å¨ä¸»åºä¸è¦æ§è¡10åéï¼æäº¤åä¼ å°å¤åºå°±è¦10åéï¼å¸åçå¤§äºå¡ï¼ã</span></p><p><span>é£ ä¹ï¼å¨ä¸»åºDDLä¹ååæäº¤çäºå¡çGTIDï¼å»å¤åºæ¥çæ¶åï¼å°±ä¼ç­10åéæåºç°ã è¿æ ·ï¼è¿ä¸ªè¯»ååç¦»æºå¶å¨è¿10åéä¹åé½ä¼è¶æ¶ï¼ç¶åèµ°ä¸»åºã </span></p><p><span>è¿ç§é¢æåçæä½ï¼åºè¯¥å¨ä¸å¡</span><strong><span>ä½å³°æ</span></strong><span>çæ¶åï¼ç¡®ä¿ä¸»åºè½å¤æ¯æææä¸å¡æ¥è¯¢ï¼ç¶åæè¯»è¯·æ±é½åå°ä¸»åºï¼åå¨ä¸»åºä¸åDDLãç­å¤åºå»¶è¿è¿½ä¸ä»¥åï¼åæè¯»è¯·æ±ååå¤åºã</span></p><p><span>ä½¿ç¨gh-ostæ¹æ¡æ¥è§£å³è¿ä¸ªé®é¢ä¹æ¯ä¸éçéæ©ã</span></p><h1><a name="29--å¦ä½å¤æ­ä¸ä¸ªæ°æ®åºæ¯ä¸æ¯åºé®é¢äº" class="md-header-anchor"></a><span>29 | å¦ä½å¤æ­ä¸ä¸ªæ°æ®åºæ¯ä¸æ¯åºé®é¢äºï¼</span></h1><p><span>æ§è¡ä¸ªselect 1å°±å¥½äº</span></p><h2><a name="select-1å¤æ­" class="md-header-anchor"></a><span>select 1å¤æ­</span></h2><p><span>åªè½è¯´æè¿ä¸ªåºçè¿ç¨è¿å¨ï¼å¹¶ä¸è½è¯´æä¸»åºæ²¡é®é¢ã</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">set</span> <span class="cm-keyword">global</span> innodb_thread_concurrency=<span class="cm-number">3</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201125142828306.png" referrerpolicy="no-referrer" alt="image-20201125142828306"></p><p><span>æ§å¶InnoDBçå¹¶åçº¿ç¨ä¸éã</span></p><p><span>session Déé¢ï¼select 1æ¯è½æ§è¡æåçï¼ä½æ¯æ¥è¯¢è¡¨tçè¯­å¥ä¼è¢«å µä½ãä¹å°±æ¯ è¯´ï¼å¦æè¿æ¶åæä»¬ç¨select 1æ¥æ£æµå®ä¾æ¯å¦æ­£å¸¸çè¯ï¼æ¯æ£æµä¸åºé®é¢çã</span></p><p><span>innodb_thread_concurrencyè®¾ç½®ä¸º64~128ä¹é´çå¼ãè¿æ¶ï¼ä½  ä¸å®ä¼æçé®ï¼å¹¶åçº¿ç¨ä¸éæ°è®¾ç½®ä¸º128å¤å¹²å¥ï¼çº¿ä¸çå¹¶åè¿æ¥æ°å¨ä¸å¨å°±ä¸åäºã</span></p><p><strong><span>å¹¶åè¿æ¥åå¹¶åæ¥è¯¢ã</span></strong><span>showprocesslistçç»æéï¼çå°çå åä¸ªè¿ æ¥ï¼æçå°±æ¯å¹¶åè¿æ¥ãèâ</span><strong><span>å½åæ­£å¨æ§è¡</span></strong><span>âçè¯­å¥ï¼ææ¯æä»¬æè¯´çå¹¶åæ¥è¯¢ã</span></p><p><span>è¿ä¹æ¯ä¸ºä»ä¹æä»¬éè¦è®¾ç½®innodb_thread_concurrencyåæ°çå å ã</span></p><p><strong><span>å¨çº¿ç¨è¿å¥éç­å¾ä»¥åï¼å¹¶åçº¿ç¨çè®¡æ°ä¼åä¸</span></strong><span>ï¼ä¹å°±æ¯è¯´ç­è¡éï¼ä¹åæ¬é´é éï¼ççº¿ç¨æ¯ä¸ç®å¨128éé¢çã</span></p><p><span>å ä¸ºï¼è¿å¥éç­å¾ççº¿ç¨å·²ç»ä¸åCPUäºï¼</span></p><p><img src="Mysql 45è®².assets/image-20201125143340832.png" referrerpolicy="no-referrer" alt="image-20201125143340832"></p><p><img src="Mysql 45è®².assets/image-20201125143352003.png" referrerpolicy="no-referrer" alt="image-20201125143352003"></p><p><span>ç±äºææçº¿ç¨é½å¤äºç­å¾ç¶æï¼æ­¤ æ¶å ç¨çCPUå´æ¯0ï¼èè¿ææ¾ä¸åçãæä»¥ï¼æä»¬è¯´InnoDBå¨è®¾è®¡æ¶ï¼éå°è¿ç¨è¿å¥éç­å¾ç æåµæ¶ï¼å°å¹¶åçº¿ç¨çè®¡æ°å1çè®¾è®¡ï¼æ¯åçèä¸æ¯å¿è¦çã</span></p><h2><a name="æ¥è¡¨å¤æ­" class="md-header-anchor"></a><span>æ¥è¡¨å¤æ­</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; select * from mysql.health_check;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>ä¸ä¸ä¸ªé®é¢ï¼å³ï¼ç©ºé´æ»¡äºä»¥åï¼è¿ç§æ¹æ³åä¼åå¾ä¸å¥½ä½¿ã</span></p><p><span>æ´æ°äºå¡è¦åbinlogï¼èä¸æ¦binlogæå¨ç£ççç©ºé´å ç¨çè¾¾å°100%</span></p><h2><a name="æ´æ°å¤æ­" class="md-header-anchor"></a><span>æ´æ°å¤æ­</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mysql&gt; update mysql.health_check set t_modified=now()</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>ææ°æ®åºAåBçä¸»å¤å³ç³»è®¾è®¡ä¸ºåMç»æï¼ æä»¥å¨å¤åºBä¸æ§è¡çæ£æµå½ä»¤ï¼ä¹è¦ååç»ä¸»åºA</span></p><p><span>ä¸»åºAåå¤åºBé½ç¨ç¸åçæ´æ°å½ä»¤ï¼å°±å¯è½åºç°è¡å²çª</span></p><p><span>ä¸ºäºè®©ä¸»å¤ä¹é´çæ´æ°ä¸äº§çå²çªï¼æä»¬å¯ä»¥å¨mysql.health_checkè¡¨ä¸å­å¥å¤è¡æ°æ®ï¼å¹¶ç¨ AãBçserver_idåä¸»é®ã</span></p><p><span>æ´æ°å¤æ­æ¯ä¸ä¸ªç¸å¯¹æ¯è¾å¸¸ç¨çæ¹æ¡äºï¼ä¸è¿ä¾ç¶å­å¨ä¸äºé®é¢ãå¶ä¸­ï¼âå¤å®æ¢âä¸ç´æ¯è®©DBA å¤´ç¼çé®é¢ã</span></p><p><span>IOå©ç¨ç100%è¡¨ç¤ºç³»ç»çIOæ¯å¨å·¥ä½çï¼</span><strong><span>æ¯ä¸ªè¯·æ±é½ææºä¼è·å¾IO</span></strong><span>èµæºï¼æ§è¡ èªå·±çä»»å¡ãèæä»¬çæ£æµä½¿ç¨çupdateå½ä»¤ï¼éè¦çèµæºå¾å°ï¼æä»¥å¯è½å¨æ¿å°IOèµæºçæ¶ åå°±å¯ä»¥æäº¤æåï¼å¹¶ä¸å¨è¶æ¶æ¶é´Nç§æªå°è¾¾ä¹åå°±è¿åç»äºæ£æµç³»ç»ã</span></p><h2><a name="åé¨ç»è®¡" class="md-header-anchor"></a><span>åé¨ç»è®¡</span></h2><p><span>åé¨æ¯ä¸æ¬¡IOè¯·æ±çæ¶é´ï¼é£æä»¬å¤æ­ æ°æ®åºæ¯å¦åºé®é¢çæ¹æ³å°±å¯é å¾å¤äºã</span></p><p><span>ï¼MySQL 5.6çæ¬ä»¥åæä¾çperformance_schemaåºï¼å°±å¨file_summary_by_event_name è¡¨éç»è®¡äºæ¯æ¬¡IOè¯·æ±çæ¶é´ã</span></p><p><img src="Mysql 45è®².assets/image-20201125144553933.png" referrerpolicy="no-referrer" alt="image-20201125144553933"></p><p><span>è¯¦æçåæ</span></p><h2><a name="å°ç»-n1533" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>æä¸ªäººæ¯è¾å¾åçæ¹æ¡ï¼æ¯ä¼åèèupdateç³»ç»è¡¨ï¼ç¶ååéåå¢å æ£æµperformance_schema çä¿¡æ¯ã</span></p><h2><a name="é®é¢-n1535" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>ä»å¤©ï¼ææ³é®ä½ çæ¯ï¼ä¸å¡ç³»ç»ä¸è¬ä¹æé«å¯ç¨çéæ±ï¼å¨ä½ å¼ååç»´æ¤è¿çæå¡ä¸­ï¼ä½ æ¯æä¹ å¤æ­æå¡ææ²¡æåºé®é¢çå¢</span></p><p><span>äºæå¡ç¶æåæå¡è´¨éççæ§</span></p><p><strong><span>ç¶æ</span></strong><span>ççæ§ï¼ä¸è¬é½å¯ä»¥ç¨</span><strong><span>å¤é¨ç³»ç»</span></strong><span>æ¥å®ç°ï¼èæå¡ç</span><strong><span>è´¨é</span></strong><span>ççæ§ï¼å°±è¦éè¿</span><strong><span>æ¥å£</span></strong><span>ç</span><strong><span>ååºæ¶é´</span></strong><span>æ¥ç»è®¡ã</span></p><p><span>äºhealthCheckæ¥æ£æµï¼å¶å®è·æä»¬æä¸­æå°çselect 1çæ¨¡ å¼ç±»ä¼¼ã</span></p><h1><a name="30--ç­çæç« äºï¼ç¨å¨æçè§ç¹çå é" class="md-header-anchor"></a><span>30 | ç­çæç« ï¼äºï¼ï¼ç¨å¨æçè§ç¹çå é</span></h1><h2><a name="å¤ä¹ ä¸ä¸å éè§å" class="md-header-anchor"></a><span>å¤ä¹ ä¸ä¸å éè§å</span></h2><p><img src="Mysql 45è®².assets/image-20201130172225794.png" referrerpolicy="no-referrer" alt="image-20201130172225794"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> <span class="cm-variable-2">`t`</span> (</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`id`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) NOTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`c`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) DEFAULTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">`d`</span> <span class="cm-builtin">int</span>(<span class="cm-number">11</span>) DEFAULTNULL,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">PRIMARY</span> <span class="cm-keyword">KEY</span> (<span class="cm-variable-2">`id`</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">KEY</span> <span class="cm-variable-2">`c`</span> (<span class="cm-variable-2">`c`</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) <span class="cm-keyword">ENGINE</span>=<span class="cm-keyword">InnoDB</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">â</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> t <span class="cm-keyword">values</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>),(<span class="cm-number">5</span>,<span class="cm-number">5</span>,<span class="cm-number">5</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">(<span class="cm-number">10</span>,<span class="cm-number">10</span>,<span class="cm-number">10</span>),(<span class="cm-number">15</span>,<span class="cm-number">15</span>,<span class="cm-number">15</span>),(<span class="cm-number">20</span>,<span class="cm-number">20</span>,<span class="cm-number">20</span>),(<span class="cm-number">25</span>,<span class="cm-number">25</span>,<span class="cm-number">25</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><h2><a name="ä¸ç­å·æ¡ä»¶éçç­å¼æ¥è¯¢" class="md-header-anchor"></a><span>ä¸ç­å·æ¡ä»¶éçç­å¼æ¥è¯¢</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">begin</span>; </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> t <span class="cm-keyword">where</span> id&gt;<span class="cm-number">9</span> <span class="cm-keyword">and</span> id&lt;<span class="cm-number">12</span> <span class="cm-keyword">order</span> <span class="cm-keyword">by</span> id <span class="cm-keyword">desc</span> <span class="cm-keyword">for</span> <span class="cm-keyword">update</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><span>ä¸»é®ç´¢å¼ä¸ç (0,5]ã(5,10]å(10, 15)</span></p><p><span>id=15è¿ä¸è¡ï¼å¹¶æ²¡æè¢«å ä¸è¡éï¼ä¸ºä»ä¹å¢ï¼ç¨å°äºä¼å2</span></p><p><img src="Mysql 45è®².assets/image-20201130173844592.png" referrerpolicy="no-referrer" alt="image-20201130173844592"></p><p><span>éè¿</span><strong><span>æ æç´¢çæ¹å¼</span></strong><span>å®ä½è®°å½çæ¶åï¼ç¨çæ¯âç­å¼æ¥è¯¢âçæ¹æ³ã</span></p><p><span>éè¦æ¯ï¼desc ï¼12è¦å®ä½ï¼æ¯ç­å¼</span></p><h2><a name="ç­å¼æ¥è¯¢çè¿ç¨" class="md-header-anchor"></a><span>ç­å¼æ¥è¯¢çè¿ç¨</span></h2><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">begin</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> id <span class="cm-keyword">from</span> t <span class="cm-keyword">where</span> c <span class="cm-keyword">in</span>(<span class="cm-number">5</span>,<span class="cm-number">20</span>,<span class="cm-number">10</span>) <span class="cm-keyword">lock</span> <span class="cm-keyword">in</span> <span class="cm-keyword">share</span> <span class="cm-keyword">mode</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201202102819531.png" referrerpolicy="no-referrer" alt="image-20201202102819531"></p><p><span>è¿æ¡inè¯­å¥ä½¿ç¨äºç´¢å¼cå¹¶ä¸rows=3ï¼è¯´æè¿ä¸ä¸ªå¼é½æ¯éè¿</span><strong><span>B+æ æç´¢å®ä½</span></strong><span>çã</span></p><p><img src="Mysql 45è®².assets/image-20201202103447920.png" referrerpolicy="no-referrer" alt="image-20201202103447920"></p><p><img src="Mysql 45è®².assets/image-20201202103538979.png" referrerpolicy="no-referrer" alt="image-20201202103538979"></p><p><strong><span>ä»(5,25)ä¸­å»æc=15çè¡é</span></strong></p><p><strong><span>å¼ºè°</span></strong><span>è¿ä¸ªè¿ç¨ï¼è¿äºéæ¯âå¨æ§è¡è¿ç¨ä¸­ä¸ä¸ªä¸ä¸ªå çâï¼èä¸æ¯ä¸æ¬¡æ§å ä¸å»çã</span></p><p><span>çè§£äºè¿ä¸ªå éè¿ç¨ä¹åï¼æä»¬å°±å¯ä»¥æ¥åæä¸é¢ä¾å­ä¸­çæ­»éé®é¢äº</span></p><p><span>å¦æåæ¶æå¦å¤ä¸ä¸ªè¯­å¥ï¼æ¯è¿ä¹åçï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="mysql"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="mysql"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">select</span> id <span class="cm-keyword">from</span> t <span class="cm-keyword">where</span> c <span class="cm-keyword">in</span>(<span class="cm-number">5</span>,<span class="cm-number">20</span>,<span class="cm-number">10</span>) <span class="cm-keyword">order</span> <span class="cm-keyword">by</span> c <span class="cm-keyword">desc</span> <span class="cm-keyword">for</span> <span class="cm-keyword">update</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><img src="Mysql 45è®².assets/image-20201202104425759.png" referrerpolicy="no-referrer" alt="image-20201202104425759"></p><h2><a name="æä¹çæ­»é" class="md-header-anchor"></a><span>æä¹çæ­»éï¼</span></h2><p><span>æ§è¡</span><code>show engine innodb status</code><span>å½ä»¤</span></p><p><span>æä¸èLATESTDETECTED DEADLOCKï¼å°±æ¯è®°å½çæåä¸æ¬¡æ­»éä¿¡æ¯ã</span></p><p><img src="Mysql 45è®².assets/image-20201202104809578.png" referrerpolicy="no-referrer" alt="image-20201202104809578"></p><ol start='' ><li><p><span>è¿ä¸ªç»æåæä¸é¨åï¼ </span></p><ul><li><span>(1) TRANSACTIONï¼æ¯ç¬¬ä¸ä¸ªäºå¡çä¿¡æ¯ï¼</span></li><li><span>(2) TRANSACTIONï¼æ¯ç¬¬äºä¸ªäºå¡çä¿¡æ¯ï¼</span></li><li><span>WE ROLL BACKTRANSACTION(1)ï¼æ¯æç»çå¤çç»æï¼è¡¨ç¤ºåæ»äºç¬¬ä¸ä¸ªäºå¡ã</span></li></ul></li><li><p><span>ç¬¬ä¸ä¸ªäºå¡çä¿¡æ¯ä¸­ï¼</span></p></li></ol><p><img src="Mysql 45è®².assets/image-20201202105217142.png" referrerpolicy="no-referrer" alt="image-20201202105217142"></p><p><img src="Mysql 45è®².assets/image-20201202105355441.png" referrerpolicy="no-referrer" alt="image-20201202105355441"></p><h2><a name="æä¹çéç­å¾" class="md-header-anchor"></a><span>æä¹çéç­å¾ï¼</span></h2><p><img src="Mysql 45è®².assets/image-20201202110149373.png" referrerpolicy="no-referrer" alt="image-20201202110149373"></p><p><span>æ­¤æ¶</span><code>show engine innodb status</code><span>çç»æ</span></p><p><img src="Mysql 45è®².assets/image-20201202110302688.png" referrerpolicy="no-referrer" alt="image-20201202110302688"></p><p><img src="Mysql 45è®².assets/image-20201202110729646.png" referrerpolicy="no-referrer" alt="image-20201202110729646"></p><h2><a name="updateçä¾å­" class="md-header-anchor"></a><span>updateçä¾å­</span></h2><p><img src="Mysql 45è®².assets/image-20201202114357499.png" referrerpolicy="no-referrer" alt="image-20201202114357499"></p><p><span>session Açå éèå´æ¯ç´¢å¼cä¸ç (5,10]ã(10,15]ã(15,20]ã(20,25]å (25,supremum]ã</span></p><p><img src="Mysql 45è®².assets/image-20201202151426873.png" referrerpolicy="no-referrer" alt="image-20201202151426873"></p><p><img src="Mysql 45è®².assets/image-20201202151442524.png" referrerpolicy="no-referrer" alt="image-20201202151442524"></p><p><img src="Mysql 45è®².assets/image-20201202151502286.png" referrerpolicy="no-referrer" alt="image-20201202151502286"></p><h2><a name="å°ç»-n1592" class="md-header-anchor"></a><span>å°ç»</span></h2><p><span>åæå éèå´æ¶ï¼ä¸å®è¦éåè¯­å¥æ§è¡é»è¾æ¥è¿è¡</span></p><p><span>ä»ç»äºæä¹çshowengine innodb statusè¾åºç»æ ä¸­çäºå¡ä¿¡æ¯åæ­»éä¿¡æ¯</span></p><p><span>ä¸é¢æä»¬æå°ä¸ä¸ªå¾éè¦çç¹ï¼æè°âé´éâï¼å¶å®æ ¹æ¬å°±æ¯ç±âè¿ä¸ªé´éå³è¾¹çé£ä¸ªè®°å½âå®ä¹ çã</span></p><h2><a name="é®é¢-n1596" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>ä¸ä¸ªç©ºè¡¨æé´éåï¼è¿ä¸ªé´éæ¯ç±è°å®ä¹çï¼ä½ æä¹éªè¯è¿ä¸ªç»è®ºå¢ï¼</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">begin;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">select * from t where id&gt;1 for update;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><p><span>å éçèå´å°±æ¯next-key lock (-â, supremum]ã</span></p><p><img src="Mysql 45è®².assets/image-20201203171256834.png" referrerpolicy="no-referrer" alt="image-20201203171256834"></p><p><img src="Mysql 45è®².assets/image-20201203171313802.png" referrerpolicy="no-referrer" alt="image-20201203171313802"></p><h1><a name="31--è¯¯å æ°æ®åé¤äºè·è·¯è¿è½æä¹å" class="md-header-anchor"></a><span>31 | è¯¯å æ°æ®åé¤äºè·è·¯ï¼è¿è½æä¹åï¼</span></h1><p><span>åMySQLç¸å³çè¯¯å æ°æ®ï¼åä¸åç±»ï¼</span></p><ol start='' ><li><span>ä½¿ç¨deleteè¯­å¥è¯¯å æ°æ®</span><strong><span>è¡</span></strong><span>ï¼ </span></li><li><span>ä½¿ç¨drop tableæètruncate tableè¯­å¥è¯¯å æ°æ®</span><strong><span>è¡¨</span></strong><span>ï¼</span></li><li><span>ä½¿ç¨drop databaseè¯­å¥è¯¯å æ°æ®</span><strong><span>åº</span></strong><span>ï¼</span></li><li><span>ä½¿ç¨rmå½ä»¤è¯¯å æ´ä¸ªMySQL</span><strong><span>å®ä¾</span></strong><span>ã</span></li></ol><h2><a name="è¡" class="md-header-anchor"></a><span>è¡</span></h2><p><span>Flashbackå·¥å·éè¿éª åææ°æ®æ¢å¤åæ¥ã</span></p><p><span>åçï¼ä¿®æ¹binlogçåå®¹,ç¶åéæ¾</span></p><p><span>åæï¼éè¦ç¡®ä¿binlog_format=rowå binlog_row_image=FULLã</span></p><p><strong><span>éè¦è¯´æçæ¯ï¼æä¸å»ºè®®ä½ ç´æ¥å¨ä¸»åºä¸æ§è¡è¿äºæä½ã</span></strong></p><p><span>æ°æ®ç¶æçåæ´å¾å¾æ¯æå³èçã</span></p><p><span>æä»¬ä¸æ­¢è¦è¯´è¯¯å æ°æ®çäºåå¤çåæ³ï¼æ´éè¦æ¯è¦åå°äºåé¢é²ã</span></p><ol start='' ><li><span>æ</span><code>sql_safe_updates</code><span>åæ°è®¾ç½®ä¸ºonãè¿æ ·ä¸æ¥ï¼å¦ææä»¬å¿è®°å¨deleteæèupdateè¯­å¥ä¸­å whereæ¡ä»¶ï¼æèwhereæ¡ä»¶éé¢æ²¡æåå«ç´¢å¼å­æ®µçè¯ï¼è¿æ¡è¯­å¥çæ§è¡å°±ä¼æ¥éã</span></li><li><span>. ä»£ç ä¸çº¿åï¼å¿é¡»ç»è¿SQLå®¡è®¡ã</span></li></ol><p><span>binlogéé¢å°±åªæä¸ä¸ªtruncate/drop è¯­å¥ï¼è¿äºä¿¡æ¯æ¯</span><strong><span>æ¢å¤ä¸åº</span></strong><span>æ°æ®çãæ§è¡è¿ä¸ä¸ªå½ä»¤æ¶ï¼è®°å½çbinlogè¿æ¯ statementæ ¼å¼ãç¨truncate /drop tableådrop databaseï¼ä¸é¢æä¸ªæ¹æ¡</span></p><h2><a name="è¯¯å åºè¡¨" class="md-header-anchor"></a><span>è¯¯å åº/è¡¨</span></h2><p><span>è¦æ³æ¢å¤æ°æ®ï¼å°±éè¦ä½¿ç¨å¨éå¤ä»½ï¼å å¢éæ¥å¿çæ¹å¼äºã</span></p><p><img src="Mysql 45è®².assets/image-20201203162454504.png" referrerpolicy="no-referrer" alt="image-20201203162454504"></p><p>&nbsp;</p><ol start='' ><li><p><span>å¯ä»¥å¨ä½¿ç¨mysqlbinlogå½ä»¤æ¶ï¼å  ä¸ä¸ä¸ªâdatabaseåæ°ï¼ç¨æ¥æå®è¯¯å è¡¨æå¨çåºã</span></p></li><li><p><span>å¨åºç¨æ¥å¿çæ¶åï¼éè¦è·³è¿è¯¯æä½çbinlogï¼</span></p><p><img src="Mysql 45è®².assets/image-20201203162643872.png" referrerpolicy="no-referrer" alt="image-20201203162643872"></p></li></ol><p><span>ä½¿ç¨mysqlbinlogæ¹æ³æ¢å¤æ°æ®è¿æ¯ä¸å¤å¿«ï¼ä¸»è¦åå æä¸¤ä¸ªï¼</span></p><ol start='' ><li><span>å¦ææ¯è¯¯å è¡¨ï¼æå¥½å°±æ¯åªæ¢å¤åºè¿å¼ è¡¨ï¼ä¹å°±æ¯åªéæ¾è¿å¼ è¡¨çæä½ï¼ä½æ¯mysqlbinlogå·¥ å·å¹¶</span><strong><span>ä¸è½</span></strong><span>æå®åª</span><strong><span>è§£æä¸ä¸ªè¡¨</span></strong><span>çæ¥å¿ï¼</span></li><li><span>ç¨mysqlbinlogè§£æåºæ¥å¿åºç¨ï¼åºç¨æ¥å¿çè¿ç¨å°±åªè½æ¯åçº¿ç¨ãæä»¬å¨ç¬¬26ç¯æç« ä¸­ä» ç»çé£äºå¹¶è¡å¤å¶çæ¹æ³ï¼å¨è¿éé½</span><strong><span>ç¨ä¸ä¸</span></strong><span>ã</span></li></ol><p><strong><span>ä¸ç§å éçæ¹æ³æ¯</span></strong></p><p><span>ç¨å¤ä»½æ¢å¤åºä¸´æ¶å®ä¾ï¼ä¸ªä¸´æ¶å®ä¾è®¾ç½®æçº¿ä¸å¤åºçä»åº</span></p><p><img src="Mysql 45è®².assets/image-20201203163604093.png" referrerpolicy="no-referrer" alt="image-20201203163604093"></p><p><img src="Mysql 45è®².assets/image-20201203163850618.png" referrerpolicy="no-referrer" alt="image-20201203163850618"></p><h2><a name="å»¶è¿å¤å¶å¤åº" class="md-header-anchor"></a><span>å»¶è¿å¤å¶å¤åº</span></h2><p><span>å»¶è¿å¤å¶çå¤åºæ¯ä¸ç§ç¹æ®çå¤åºï¼éè¿ CHANGE MASTER TOMASTER_DELAY =Nå½ä»¤ï¼ å¯ä»¥æå®è¿ä¸ªå¤åºæç»­ä¿æè·ä¸»åºæNç§çå»¶è¿ã</span></p><p><span>æNè®¾ç½®ä¸º3600ï¼è¿å°±ä»£è¡¨äºå¦æä¸»åºä¸ææ°æ®è¢«è¯¯å äºï¼å¹¶ä¸å¨1å°æ¶ååç°äºè¿ä¸ªè¯¯ æä½å½ä»¤ï¼è¿ä¸ªå½ä»¤å°±è¿æ²¡æå¨è¿ä¸ªå»¶è¿å¤å¶çå¤åºæ§è¡ãè¿æ¶åå°è¿ä¸ªå¤åºä¸æ§è¡stop slaveï¼åéè¿ä¹åä»ç»çæ¹æ³ï¼è·³è¿è¯¯æä½å½ä»¤ï¼å°±å¯ä»¥æ¢å¤åºéè¦çæ°æ®ã</span></p><h2><a name="é¢é²è¯¯å åºè¡¨çæ¹æ³" class="md-header-anchor"></a><span>é¢é²è¯¯å åº/è¡¨çæ¹æ³</span></h2><p><span>ç¬¬ä¸æ¡å»ºè®®æ¯ï¼è´¦å·åç¦»ã</span></p><p><span>åªç»ä¸å¡å¼ååå­¦DMLæéï¼èä¸ç»truncate/dropæéï¼æDDLé æ±çè¯ï¼ä¹å¯ä»¥éè¿å¼åç®¡çç³»ç»å¾å°æ¯æ</span></p><p><span>ç¬¬äºæ¡å»ºè®®æ¯ï¼å¶å®æä½è§è</span></p><p><span>å¨å é¤æ°æ®è¡¨ä¹åï¼å¿é¡»åå¯¹è¡¨åæ¹åæä½ãç¶åï¼è§å¯ä¸æ®µæ¶é´ï¼ç¡®ä¿å¯¹ä¸å¡æ å½±åä»¥å åå é¤è¿å¼ è¡¨ã</span></p><p><span>æ¹è¡¨åçæ¶åï¼è¦æ±ç»è¡¨åå åºå®çåç¼ï¼æ¯å¦å _to_be_deleted)ï¼ç¶åå é¤è¡¨çå¨ä½å¿é¡» éè¿ç®¡çç³»ç»æ§è¡ãå¹¶ä¸ï¼ç®¡çç³»å é¤è¡¨çæ¶åï¼åªè½å é¤åºå®åç¼çè¡¨ã</span></p><h2><a name="rmå é¤æ°æ®" class="md-header-anchor"></a><span>rmå é¤æ°æ®</span></h2><p><span>MySQLéç¾¤æ¥è¯´ï¼æä¸æçå°±æ¯rmå é¤æ°æ®äº</span></p><p><img src="Mysql 45è®².assets/image-20201203170254904.png" referrerpolicy="no-referrer" alt="image-20201203170254904"></p><h2><a name="é®é¢-n1658" class="md-header-anchor"></a><span>é®é¢</span></h2><p><span>åå¿ä¸ä½ äº²èº«ç»åè¿çè¯¯å æ°æ®äºä»¶å§ï¼ä½ ç¨äºä»ä¹æ¹æ³æ¥æ¢å¤æ°æ®å¢ï¼ä½  å¨è¿ä¸ªè¿ç¨ä¸­å¾å°çç»éªåæ¯ä»ä¹å¢ï¼</span></p><h1><a name="32--ä¸ºä»ä¹è¿ækillä¸æçè¯­å¥" class="md-header-anchor"></a><span>32 | ä¸ºä»ä¹è¿ækillä¸æçè¯­å¥ï¼</span></h1><p><span>æä¸¤ä¸ªkillå½ä»¤ï¼</span></p><p><span>ä¸ä¸ªæ¯</span><code>kill query+çº¿ç¨id</code><span>ï¼è¡¨ç¤ºç»æ­¢è¿ä¸ªçº¿ç¨ä¸­æ­£å¨æ§è¡çè¯­å¥ï¼</span></p><p><span>ä¸ ä¸ªæ¯</span><code>kill connection +çº¿ç¨id</code><span>ï¼è¿éconnectionå¯</span><strong><span>ç¼ºç</span></strong><span>ï¼è¡¨ç¤ºæ­å¼è¿ä¸ªçº¿ç¨ç</span><strong><span>è¿æ¥</span></strong><span>ï¼å½ç¶å¦æè¿ä¸ªçº¿ç¨æè¯­å¥æ­£å¨æ§è¡ï¼ä¹æ¯è¦ååæ­¢æ­£å¨æ§è¡çè¯­å¥çã</span></p><h2><a name="æ¶å°killä»¥åçº¿ç¨åä»ä¹" class="md-header-anchor"></a><span>æ¶å°killä»¥åï¼çº¿ç¨åä»ä¹ï¼</span></h2><h1><a name="mysql-åé¡µæ¥è¯¢" class="md-header-anchor"></a><span>mysql åé¡µæ¥è¯¢</span></h1><p><span>(1ï¼</span><font color=red><span>2ï¼3ï¼</span></font><span>4ï¼5ï¼6ï¼7ï¼8)    limit 1,2 </span></p><h2><a name="å½å¹¶noï¼" class="md-header-anchor"></a><span>å½å¹¶ï¼noï¼</span></h2><p><span>ææåè¡¨äº</span></p><p><span>(1ï¼2ï¼3ï¼4) limit 1,2 </span></p><p><span>						</span><span>   ==ã</span><span>		</span><span>(2ï¼3)</span><span>				</span></p><p><span>								</span><span>           (6ï¼7)   ===ã(2ï¼3ï¼6ï¼7) =&gt; (2ï¼3)  å½å¹¶</span></p><p><span>(5ï¼6ï¼7ï¼8) limit 1,2 </span></p><p><span>åºé®é¢</span></p><p><span>(1ï¼2ï¼3ï¼</span><font color=red><span>4ï¼5ï¼</span></font><span>6ï¼7ï¼8) </span></p><p><span>(1ï¼2ï¼3ï¼4) =&gt; limit 3,2 =&gt;(4)</span></p><p><span>(5ï¼6ï¼7ï¼8) =&gt; limit 3,2 =&gt;(8)</span></p><p><span>ç»ææ¯(4ï¼8) ä¸æ­£ç¡®ç»æ (4ï¼5)ç¸æ¯(éè¯¯)</span></p><h2><a name="å¨å±æ³limit-xy" class="md-header-anchor"></a><span>å¨å±æ³(limit x+y)</span></h2><p><span>è¬æåµä¸ï¼éè¦ç¨ååºåè¡¨çåºæ¯ï¼æ°æ®éå¿ç¶å¾å¤§ï¼æä»¥è¿ä¸ªæ¹æ³ï¼å®éä¸­åºæ¬ä¸æ²¡æ³ç¨</span></p><p><img src="Mysql 45è®².assets/image-20220104155539805.png" referrerpolicy="no-referrer" alt="image-20220104155539805"></p><h2><a name="äºæ¬¡æ¥è¯¢æ³" class="md-header-anchor"></a><span>äºæ¬¡æ¥è¯¢æ³</span></h2><p><span>è¿ä¸ªåæå¾éè¦ï¼ä¹å°±æ¯è¯´ä¸ä¼æä¸ä¸ªåè¡¨çæ°æ®ç¹å«å¤æç¹å«å°</span></p><p>&nbsp;</p><p><span>å°ç±³ 12  12+256 4399å 8+128 3699å</span></p><p><span>çæpro  12+256  4499    8+256 4199 å¯¹è´¦å</span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></div>
</body>
</html>